"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AbstractTopicClient = void 0;
const index_1 = require("../../../index");
class AbstractTopicClient {
    constructor(logger, pubsubStreamClients, pubsubUnaryClients, webhookClient) {
        this.nextPubsubStreamClientIndex = 0;
        this.nextPubsubUnaryClientIndex = 0;
        this.logger = logger;
        this.pubsubStreamClients = pubsubStreamClients;
        this.pubsubUnaryClients = pubsubUnaryClients;
        this.webhookClient = webhookClient;
    }
    /**
     * Publishes a value to a topic.
     *
     * @param {string} cacheName - The name of the cache to containing the topic to publish to.
     * @param {string} topicName - The name of the topic to publish to.
     * @param {string | Uint8Array} value - The value to publish.
     * @returns {Promise<TopicPublish.Response>} -
     * {@link TopicPublish.Success} on success.
     * {@link TopicPublish.Error} on failure.
     */
    async publish(cacheName, topicName, value) {
        return await this.getNextPublishClient().publish(cacheName, topicName, value);
    }
    /**
     * Subscribes to a topic.
     *
     * @param {string} cacheName - The name of the cache to containing the topic to subscribe to.
     * @param {string} topicName - The name of the topic to subscribe to.
     * @param {SubscribeCallOptions} options - The options for the subscription. Defaults to no-op handlers.
     * @param {function} options.onItem - The callback to invoke when data is received. Defaults to no-op.
     * @param {function} options.onError - The callback to invoke when an error is received. Defaults to no-op.
     * @returns {Promise<TopicSubscribe.Response>} -
     * {@link TopicSubscribe.Subscription} on success.
     * {@link TopicSubscribe.Error} on failure.
     */
    async subscribe(cacheName, topicName, options) {
        return await this.getNextSubscribeClient().subscribe(cacheName, topicName, options);
    }
    /**
     * Deletes a webhook
     *
     * @param {string} cacheName - The name of the cache associated with the webhook
     * @param {string} webhookName - The name of the webhook
     * @returns {Promise<DeleteWebhook.Response>} -
     * {@link DeleteWebhook.Success} on success.
     * {@link DeleteWebhook.Error} on failure.
     */
    async deleteWebhook(cacheName, webhookName) {
        return await this.webhookClient.deleteWebhook({ cacheName, webhookName });
    }
    /**
     * Lists webhooks associated with a cache
     *
     * @param {string} cacheName - The cache to list webhooks associated with it
     * @returns {Promise<ListWebhooks.Response>} -
     * {@link ListWebhooks.Success} on success.
     * {@link ListWebhooks.Error} on failure.
     */
    async listWebhooks(cacheName) {
        return await this.webhookClient.listWebhooks(cacheName);
    }
    /**
     * Creates a new webhook, or updates an existing one
     *
     * @param {string} cacheName - The name of the cache to associate the webhook with
     * @param {string} webhookName - The name of the webhook
     * @param {PutWebhookCallOptions} options - The options for the webhook
     * @param {string} topicName - The name of the topic for the webhook to listen to
     * @param {WebhookDestination | string} webhookDestination - The url to associate the webhook with
     * @returns {Promise<PutWebhook.Response>} -
     * {@link PutWebhook.Success} on success.
     * {@link PutWebhook.Error} on failure.
     */
    async putWebhook(cacheName, webhookName, options) {
        let _dest = options.destination;
        if (typeof _dest === 'string') {
            _dest = new index_1.PostUrlWebhookDestination(_dest);
        }
        return await this.webhookClient.putWebhook({
            topicName: options.topicName,
            id: {
                cacheName,
                webhookName,
            },
            destination: _dest,
        });
    }
    /**
     * Gets the signing secret for a webhook
     *
     * @param {string} cacheName - The name of the cache associated with the webhook
     * @param {string} webhookName - The name of the webhook
     * @returns {Promise<GetWebhookSecret.Response>} -
     * {@link GetWebhookSecret.Success} on success.
     * {@link GetWebhookSecret.Error} on failure.
     */
    async getWebhookSecret(cacheName, webhookName) {
        return await this.webhookClient.getWebhookSecret({ cacheName, webhookName });
    }
    /**
     * Rotates the signing secret for a webhook
     *
     * @param {string} cacheName - The name of the cache associated with the webhook
     * @param {string} webhookName - The name of the webhook
     * @returns {Promise<RotateWebhookSecret.Response>} -
     * {@link RotateWebhookSecret.Success} on success.
     * {@link RotateWebhookSecret.Error} on failure.
     */
    async rotateWebhookSecret(cacheName, webhookName) {
        return await this.webhookClient.rotateWebhookSecret({
            cacheName,
            webhookName,
        });
    }
    getNextPublishClient() {
        const client = this.pubsubUnaryClients[this.nextPubsubUnaryClientIndex];
        this.nextPubsubUnaryClientIndex =
            (this.nextPubsubUnaryClientIndex + 1) % this.pubsubUnaryClients.length;
        return client;
    }
    getNextSubscribeClient() {
        const client = this.pubsubStreamClients[this.nextPubsubStreamClientIndex];
        this.nextPubsubStreamClientIndex =
            (this.nextPubsubStreamClientIndex + 1) % this.pubsubStreamClients.length;
        return client;
    }
}
exports.AbstractTopicClient = AbstractTopicClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWJzdHJhY3RUb3BpY0NsaWVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9pbnRlcm5hbC9jbGllbnRzL3B1YnN1Yi9BYnN0cmFjdFRvcGljQ2xpZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLDBDQVd3QjtBQUt4QixNQUFzQixtQkFBbUI7SUFTdkMsWUFDRSxNQUFxQixFQUNyQixtQkFBb0MsRUFDcEMsa0JBQW1DLEVBQ25DLGFBQTZCO1FBUHZCLGdDQUEyQixHQUFHLENBQUMsQ0FBQztRQUNoQywrQkFBMEIsR0FBRyxDQUFDLENBQUM7UUFRckMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLG1CQUFtQixDQUFDO1FBQy9DLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxrQkFBa0IsQ0FBQztRQUM3QyxJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztJQUNyQyxDQUFDO0lBRUQ7Ozs7Ozs7OztPQVNHO0lBQ0ksS0FBSyxDQUFDLE9BQU8sQ0FDbEIsU0FBaUIsRUFDakIsU0FBaUIsRUFDakIsS0FBMEI7UUFFMUIsT0FBTyxNQUFNLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLE9BQU8sQ0FDOUMsU0FBUyxFQUNULFNBQVMsRUFDVCxLQUFLLENBQ04sQ0FBQztJQUNKLENBQUM7SUFFRDs7Ozs7Ozs7Ozs7T0FXRztJQUNJLEtBQUssQ0FBQyxTQUFTLENBQ3BCLFNBQWlCLEVBQ2pCLFNBQWlCLEVBQ2pCLE9BQTZCO1FBRTdCLE9BQU8sTUFBTSxJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQyxTQUFTLENBQ2xELFNBQVMsRUFDVCxTQUFTLEVBQ1QsT0FBTyxDQUNSLENBQUM7SUFDSixDQUFDO0lBRUQ7Ozs7Ozs7O09BUUc7SUFDSSxLQUFLLENBQUMsYUFBYSxDQUN4QixTQUFpQixFQUNqQixXQUFtQjtRQUVuQixPQUFPLE1BQU0sSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsRUFBQyxTQUFTLEVBQUUsV0FBVyxFQUFDLENBQUMsQ0FBQztJQUMxRSxDQUFDO0lBRUQ7Ozs7Ozs7T0FPRztJQUNJLEtBQUssQ0FBQyxZQUFZLENBQUMsU0FBaUI7UUFDekMsT0FBTyxNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzFELENBQUM7SUFFRDs7Ozs7Ozs7Ozs7T0FXRztJQUNJLEtBQUssQ0FBQyxVQUFVLENBQ3JCLFNBQWlCLEVBQ2pCLFdBQW1CLEVBQ25CLE9BQThCO1FBRTlCLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUM7UUFDaEMsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7WUFDN0IsS0FBSyxHQUFHLElBQUksaUNBQXlCLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDOUM7UUFDRCxPQUFPLE1BQU0sSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUM7WUFDekMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTO1lBQzVCLEVBQUUsRUFBRTtnQkFDRixTQUFTO2dCQUNULFdBQVc7YUFDWjtZQUNELFdBQVcsRUFBRSxLQUFLO1NBQ25CLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7Ozs7Ozs7T0FRRztJQUNJLEtBQUssQ0FBQyxnQkFBZ0IsQ0FDM0IsU0FBaUIsRUFDakIsV0FBbUI7UUFFbkIsT0FBTyxNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQUMsRUFBQyxTQUFTLEVBQUUsV0FBVyxFQUFDLENBQUMsQ0FBQztJQUM3RSxDQUFDO0lBRUQ7Ozs7Ozs7O09BUUc7SUFDSSxLQUFLLENBQUMsbUJBQW1CLENBQzlCLFNBQWlCLEVBQ2pCLFdBQW1CO1FBRW5CLE9BQU8sTUFBTSxJQUFJLENBQUMsYUFBYSxDQUFDLG1CQUFtQixDQUFDO1lBQ2xELFNBQVM7WUFDVCxXQUFXO1NBQ1osQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVTLG9CQUFvQjtRQUM1QixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDeEUsSUFBSSxDQUFDLDBCQUEwQjtZQUM3QixDQUFDLElBQUksQ0FBQywwQkFBMEIsR0FBRyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDO1FBQ3pFLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFFUyxzQkFBc0I7UUFDOUIsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO1FBQzFFLElBQUksQ0FBQywyQkFBMkI7WUFDOUIsQ0FBQyxJQUFJLENBQUMsMkJBQTJCLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQztRQUMzRSxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0NBQ0Y7QUE5S0Qsa0RBOEtDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtJVG9waWNDbGllbnR9IGZyb20gJy4uLy4uLy4uL2NsaWVudHMvSVRvcGljQ2xpZW50JztcbmltcG9ydCB7XG4gIE1vbWVudG9Mb2dnZXIsXG4gIFN1YnNjcmliZUNhbGxPcHRpb25zLFxuICBUb3BpY1B1Ymxpc2gsXG4gIFRvcGljU3Vic2NyaWJlLFxuICBMaXN0V2ViaG9va3MsXG4gIFB1dFdlYmhvb2ssXG4gIERlbGV0ZVdlYmhvb2ssXG4gIEdldFdlYmhvb2tTZWNyZXQsXG4gIFBvc3RVcmxXZWJob29rRGVzdGluYXRpb24sXG4gIFJvdGF0ZVdlYmhvb2tTZWNyZXQsXG59IGZyb20gJy4uLy4uLy4uL2luZGV4JztcbmltcG9ydCB7SVB1YnN1YkNsaWVudH0gZnJvbSAnLi9JUHVic3ViQ2xpZW50JztcbmltcG9ydCB7SVdlYmhvb2tDbGllbnR9IGZyb20gJy4vSVdlYmhvb2tDbGllbnQnO1xuaW1wb3J0IHtQdXRXZWJob29rQ2FsbE9wdGlvbnN9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3dlYmhvb2stY2FsbC1vcHRpb25zJztcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFic3RyYWN0VG9waWNDbGllbnQgaW1wbGVtZW50cyBJVG9waWNDbGllbnQge1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgbG9nZ2VyOiBNb21lbnRvTG9nZ2VyO1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgcHVic3ViQ2xpZW50czogSVB1YnN1YkNsaWVudFtdO1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgcHVic3ViU3RyZWFtQ2xpZW50czogSVB1YnN1YkNsaWVudFtdO1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgcHVic3ViVW5hcnlDbGllbnRzOiBJUHVic3ViQ2xpZW50W107XG4gIHByb3RlY3RlZCByZWFkb25seSB3ZWJob29rQ2xpZW50OiBJV2ViaG9va0NsaWVudDtcbiAgcHJpdmF0ZSBuZXh0UHVic3ViU3RyZWFtQ2xpZW50SW5kZXggPSAwO1xuICBwcml2YXRlIG5leHRQdWJzdWJVbmFyeUNsaWVudEluZGV4ID0gMDtcblxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoXG4gICAgbG9nZ2VyOiBNb21lbnRvTG9nZ2VyLFxuICAgIHB1YnN1YlN0cmVhbUNsaWVudHM6IElQdWJzdWJDbGllbnRbXSxcbiAgICBwdWJzdWJVbmFyeUNsaWVudHM6IElQdWJzdWJDbGllbnRbXSxcbiAgICB3ZWJob29rQ2xpZW50OiBJV2ViaG9va0NsaWVudFxuICApIHtcbiAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlcjtcbiAgICB0aGlzLnB1YnN1YlN0cmVhbUNsaWVudHMgPSBwdWJzdWJTdHJlYW1DbGllbnRzO1xuICAgIHRoaXMucHVic3ViVW5hcnlDbGllbnRzID0gcHVic3ViVW5hcnlDbGllbnRzO1xuICAgIHRoaXMud2ViaG9va0NsaWVudCA9IHdlYmhvb2tDbGllbnQ7XG4gIH1cblxuICAvKipcbiAgICogUHVibGlzaGVzIGEgdmFsdWUgdG8gYSB0b3BpYy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNhY2hlTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBjYWNoZSB0byBjb250YWluaW5nIHRoZSB0b3BpYyB0byBwdWJsaXNoIHRvLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdG9waWNOYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHRvcGljIHRvIHB1Ymxpc2ggdG8uXG4gICAqIEBwYXJhbSB7c3RyaW5nIHwgVWludDhBcnJheX0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gcHVibGlzaC5cbiAgICogQHJldHVybnMge1Byb21pc2U8VG9waWNQdWJsaXNoLlJlc3BvbnNlPn0gLVxuICAgKiB7QGxpbmsgVG9waWNQdWJsaXNoLlN1Y2Nlc3N9IG9uIHN1Y2Nlc3MuXG4gICAqIHtAbGluayBUb3BpY1B1Ymxpc2guRXJyb3J9IG9uIGZhaWx1cmUuXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgcHVibGlzaChcbiAgICBjYWNoZU5hbWU6IHN0cmluZyxcbiAgICB0b3BpY05hbWU6IHN0cmluZyxcbiAgICB2YWx1ZTogc3RyaW5nIHwgVWludDhBcnJheVxuICApOiBQcm9taXNlPFRvcGljUHVibGlzaC5SZXNwb25zZT4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmdldE5leHRQdWJsaXNoQ2xpZW50KCkucHVibGlzaChcbiAgICAgIGNhY2hlTmFtZSxcbiAgICAgIHRvcGljTmFtZSxcbiAgICAgIHZhbHVlXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdWJzY3JpYmVzIHRvIGEgdG9waWMuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjYWNoZU5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgY2FjaGUgdG8gY29udGFpbmluZyB0aGUgdG9waWMgdG8gc3Vic2NyaWJlIHRvLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdG9waWNOYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHRvcGljIHRvIHN1YnNjcmliZSB0by5cbiAgICogQHBhcmFtIHtTdWJzY3JpYmVDYWxsT3B0aW9uc30gb3B0aW9ucyAtIFRoZSBvcHRpb25zIGZvciB0aGUgc3Vic2NyaXB0aW9uLiBEZWZhdWx0cyB0byBuby1vcCBoYW5kbGVycy5cbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gb3B0aW9ucy5vbkl0ZW0gLSBUaGUgY2FsbGJhY2sgdG8gaW52b2tlIHdoZW4gZGF0YSBpcyByZWNlaXZlZC4gRGVmYXVsdHMgdG8gbm8tb3AuXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IG9wdGlvbnMub25FcnJvciAtIFRoZSBjYWxsYmFjayB0byBpbnZva2Ugd2hlbiBhbiBlcnJvciBpcyByZWNlaXZlZC4gRGVmYXVsdHMgdG8gbm8tb3AuXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFRvcGljU3Vic2NyaWJlLlJlc3BvbnNlPn0gLVxuICAgKiB7QGxpbmsgVG9waWNTdWJzY3JpYmUuU3Vic2NyaXB0aW9ufSBvbiBzdWNjZXNzLlxuICAgKiB7QGxpbmsgVG9waWNTdWJzY3JpYmUuRXJyb3J9IG9uIGZhaWx1cmUuXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgc3Vic2NyaWJlKFxuICAgIGNhY2hlTmFtZTogc3RyaW5nLFxuICAgIHRvcGljTmFtZTogc3RyaW5nLFxuICAgIG9wdGlvbnM6IFN1YnNjcmliZUNhbGxPcHRpb25zXG4gICk6IFByb21pc2U8VG9waWNTdWJzY3JpYmUuUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXROZXh0U3Vic2NyaWJlQ2xpZW50KCkuc3Vic2NyaWJlKFxuICAgICAgY2FjaGVOYW1lLFxuICAgICAgdG9waWNOYW1lLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlcyBhIHdlYmhvb2tcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNhY2hlTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBjYWNoZSBhc3NvY2lhdGVkIHdpdGggdGhlIHdlYmhvb2tcbiAgICogQHBhcmFtIHtzdHJpbmd9IHdlYmhvb2tOYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHdlYmhvb2tcbiAgICogQHJldHVybnMge1Byb21pc2U8RGVsZXRlV2ViaG9vay5SZXNwb25zZT59IC1cbiAgICoge0BsaW5rIERlbGV0ZVdlYmhvb2suU3VjY2Vzc30gb24gc3VjY2Vzcy5cbiAgICoge0BsaW5rIERlbGV0ZVdlYmhvb2suRXJyb3J9IG9uIGZhaWx1cmUuXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZGVsZXRlV2ViaG9vayhcbiAgICBjYWNoZU5hbWU6IHN0cmluZyxcbiAgICB3ZWJob29rTmFtZTogc3RyaW5nXG4gICk6IFByb21pc2U8RGVsZXRlV2ViaG9vay5SZXNwb25zZT4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLndlYmhvb2tDbGllbnQuZGVsZXRlV2ViaG9vayh7Y2FjaGVOYW1lLCB3ZWJob29rTmFtZX0pO1xuICB9XG5cbiAgLyoqXG4gICAqIExpc3RzIHdlYmhvb2tzIGFzc29jaWF0ZWQgd2l0aCBhIGNhY2hlXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjYWNoZU5hbWUgLSBUaGUgY2FjaGUgdG8gbGlzdCB3ZWJob29rcyBhc3NvY2lhdGVkIHdpdGggaXRcbiAgICogQHJldHVybnMge1Byb21pc2U8TGlzdFdlYmhvb2tzLlJlc3BvbnNlPn0gLVxuICAgKiB7QGxpbmsgTGlzdFdlYmhvb2tzLlN1Y2Nlc3N9IG9uIHN1Y2Nlc3MuXG4gICAqIHtAbGluayBMaXN0V2ViaG9va3MuRXJyb3J9IG9uIGZhaWx1cmUuXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgbGlzdFdlYmhvb2tzKGNhY2hlTmFtZTogc3RyaW5nKTogUHJvbWlzZTxMaXN0V2ViaG9va3MuUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy53ZWJob29rQ2xpZW50Lmxpc3RXZWJob29rcyhjYWNoZU5hbWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgd2ViaG9vaywgb3IgdXBkYXRlcyBhbiBleGlzdGluZyBvbmVcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNhY2hlTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBjYWNoZSB0byBhc3NvY2lhdGUgdGhlIHdlYmhvb2sgd2l0aFxuICAgKiBAcGFyYW0ge3N0cmluZ30gd2ViaG9va05hbWUgLSBUaGUgbmFtZSBvZiB0aGUgd2ViaG9va1xuICAgKiBAcGFyYW0ge1B1dFdlYmhvb2tDYWxsT3B0aW9uc30gb3B0aW9ucyAtIFRoZSBvcHRpb25zIGZvciB0aGUgd2ViaG9va1xuICAgKiBAcGFyYW0ge3N0cmluZ30gdG9waWNOYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHRvcGljIGZvciB0aGUgd2ViaG9vayB0byBsaXN0ZW4gdG9cbiAgICogQHBhcmFtIHtXZWJob29rRGVzdGluYXRpb24gfCBzdHJpbmd9IHdlYmhvb2tEZXN0aW5hdGlvbiAtIFRoZSB1cmwgdG8gYXNzb2NpYXRlIHRoZSB3ZWJob29rIHdpdGhcbiAgICogQHJldHVybnMge1Byb21pc2U8UHV0V2ViaG9vay5SZXNwb25zZT59IC1cbiAgICoge0BsaW5rIFB1dFdlYmhvb2suU3VjY2Vzc30gb24gc3VjY2Vzcy5cbiAgICoge0BsaW5rIFB1dFdlYmhvb2suRXJyb3J9IG9uIGZhaWx1cmUuXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgcHV0V2ViaG9vayhcbiAgICBjYWNoZU5hbWU6IHN0cmluZyxcbiAgICB3ZWJob29rTmFtZTogc3RyaW5nLFxuICAgIG9wdGlvbnM6IFB1dFdlYmhvb2tDYWxsT3B0aW9uc1xuICApOiBQcm9taXNlPFB1dFdlYmhvb2suUmVzcG9uc2U+IHtcbiAgICBsZXQgX2Rlc3QgPSBvcHRpb25zLmRlc3RpbmF0aW9uO1xuICAgIGlmICh0eXBlb2YgX2Rlc3QgPT09ICdzdHJpbmcnKSB7XG4gICAgICBfZGVzdCA9IG5ldyBQb3N0VXJsV2ViaG9va0Rlc3RpbmF0aW9uKF9kZXN0KTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMud2ViaG9va0NsaWVudC5wdXRXZWJob29rKHtcbiAgICAgIHRvcGljTmFtZTogb3B0aW9ucy50b3BpY05hbWUsXG4gICAgICBpZDoge1xuICAgICAgICBjYWNoZU5hbWUsXG4gICAgICAgIHdlYmhvb2tOYW1lLFxuICAgICAgfSxcbiAgICAgIGRlc3RpbmF0aW9uOiBfZGVzdCxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBzaWduaW5nIHNlY3JldCBmb3IgYSB3ZWJob29rXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjYWNoZU5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgY2FjaGUgYXNzb2NpYXRlZCB3aXRoIHRoZSB3ZWJob29rXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB3ZWJob29rTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSB3ZWJob29rXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPEdldFdlYmhvb2tTZWNyZXQuUmVzcG9uc2U+fSAtXG4gICAqIHtAbGluayBHZXRXZWJob29rU2VjcmV0LlN1Y2Nlc3N9IG9uIHN1Y2Nlc3MuXG4gICAqIHtAbGluayBHZXRXZWJob29rU2VjcmV0LkVycm9yfSBvbiBmYWlsdXJlLlxuICAgKi9cbiAgcHVibGljIGFzeW5jIGdldFdlYmhvb2tTZWNyZXQoXG4gICAgY2FjaGVOYW1lOiBzdHJpbmcsXG4gICAgd2ViaG9va05hbWU6IHN0cmluZ1xuICApOiBQcm9taXNlPEdldFdlYmhvb2tTZWNyZXQuUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy53ZWJob29rQ2xpZW50LmdldFdlYmhvb2tTZWNyZXQoe2NhY2hlTmFtZSwgd2ViaG9va05hbWV9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSb3RhdGVzIHRoZSBzaWduaW5nIHNlY3JldCBmb3IgYSB3ZWJob29rXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBjYWNoZU5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgY2FjaGUgYXNzb2NpYXRlZCB3aXRoIHRoZSB3ZWJob29rXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB3ZWJob29rTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSB3ZWJob29rXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFJvdGF0ZVdlYmhvb2tTZWNyZXQuUmVzcG9uc2U+fSAtXG4gICAqIHtAbGluayBSb3RhdGVXZWJob29rU2VjcmV0LlN1Y2Nlc3N9IG9uIHN1Y2Nlc3MuXG4gICAqIHtAbGluayBSb3RhdGVXZWJob29rU2VjcmV0LkVycm9yfSBvbiBmYWlsdXJlLlxuICAgKi9cbiAgcHVibGljIGFzeW5jIHJvdGF0ZVdlYmhvb2tTZWNyZXQoXG4gICAgY2FjaGVOYW1lOiBzdHJpbmcsXG4gICAgd2ViaG9va05hbWU6IHN0cmluZ1xuICApOiBQcm9taXNlPFJvdGF0ZVdlYmhvb2tTZWNyZXQuUmVzcG9uc2U+IHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy53ZWJob29rQ2xpZW50LnJvdGF0ZVdlYmhvb2tTZWNyZXQoe1xuICAgICAgY2FjaGVOYW1lLFxuICAgICAgd2ViaG9va05hbWUsXG4gICAgfSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0TmV4dFB1Ymxpc2hDbGllbnQoKTogSVB1YnN1YkNsaWVudCB7XG4gICAgY29uc3QgY2xpZW50ID0gdGhpcy5wdWJzdWJVbmFyeUNsaWVudHNbdGhpcy5uZXh0UHVic3ViVW5hcnlDbGllbnRJbmRleF07XG4gICAgdGhpcy5uZXh0UHVic3ViVW5hcnlDbGllbnRJbmRleCA9XG4gICAgICAodGhpcy5uZXh0UHVic3ViVW5hcnlDbGllbnRJbmRleCArIDEpICUgdGhpcy5wdWJzdWJVbmFyeUNsaWVudHMubGVuZ3RoO1xuICAgIHJldHVybiBjbGllbnQ7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0TmV4dFN1YnNjcmliZUNsaWVudCgpOiBJUHVic3ViQ2xpZW50IHtcbiAgICBjb25zdCBjbGllbnQgPSB0aGlzLnB1YnN1YlN0cmVhbUNsaWVudHNbdGhpcy5uZXh0UHVic3ViU3RyZWFtQ2xpZW50SW5kZXhdO1xuICAgIHRoaXMubmV4dFB1YnN1YlN0cmVhbUNsaWVudEluZGV4ID1cbiAgICAgICh0aGlzLm5leHRQdWJzdWJTdHJlYW1DbGllbnRJbmRleCArIDEpICUgdGhpcy5wdWJzdWJTdHJlYW1DbGllbnRzLmxlbmd0aDtcbiAgICByZXR1cm4gY2xpZW50O1xuICB9XG59XG4iXX0=