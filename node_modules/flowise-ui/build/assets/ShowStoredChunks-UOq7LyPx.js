import{t as ae,M as A,R as se,u as oe,o as ne,a as re,b as ie,Q as ce,p as de,c as le,ak as pe,r,j as e,S as he,aj as y,a8 as $,B as ue,ag as me,ah as xe,l as W,n as C,E as j,J as ge,K as fe}from"./index-B1XR3Coy.js";import{R as ke}from"./main-BBsr8sqY.js";import{c as Ce}from"./chunks_empty-fFmvGjOz.js";import{B as je}from"./BackdropLoader-C982mQas.js";import{u as ye,C as we}from"./ConfirmDialog-Bksga_et.js";import{E as be}from"./ExpandedChunkDialog-C2wgrYw6.js";import{V as Se}from"./ViewHeader-jo2V0q71.js";import{E as ve}from"./ErrorBoundary-WOMkE_83.js";import{d as w}from"./documentstore-GQ_lrBF1.js";import{I as De}from"./IconChevronLeft-Dkfa8829.js";import{I as Ie}from"./IconChevronRight-C7SE20Y-.js";import{I as Re}from"./IconLanguage-Dreb5nKM.js";import"./CodeEditor-BjDzi2Vy.js";import"./index-DhL3T6x0.js";import"./IconSearch-BzBgax5m.js";import"./IconTrash-BvhWIQ6v.js";import"./StyledFab-BqTal21_.js";import"./IconCopy-BBl1XuSo.js";const Ee=ae(A)(({theme:d})=>({background:d.palette.card.main,color:d.darkTextPrimary,overflow:"auto",position:"relative",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)",cursor:"pointer","&:hover":{background:d.palette.card.hover,boxShadow:"0 2px 14px 0 rgb(32 40 45 / 20%)"},maxHeight:"250px",minHeight:"250px",maxWidth:"100%",overflowWrap:"break-word",whiteSpace:"pre-line",padding:1})),_e=()=>{var N,P,T,M,F,q,z,L;const d=se(t=>t.customization),b=oe(),S=ne(),V=re(),{confirm:G}=ye(),{error:v}=ie(),{hasAssignedWorkspace:H}=ce();de();const u=(...t)=>S(ge(...t)),m=(...t)=>S(fe(...t)),n=le(w.getFileChunks),{storeId:x,fileId:g}=pe(),[p,J]=r.useState([]),[h,K]=r.useState(0),[l,D]=r.useState(1),[I,O]=r.useState(1),[f,_]=r.useState(50),[R,c]=r.useState(!1),[Q,k]=r.useState(!1),[X,U]=r.useState({}),[E,Y]=r.useState([]),Z=t=>{const a=p.find(o=>o.id===t),i=p.findIndex(o=>o.id===t)+I;U({data:{selectedChunk:a,selectedChunkNumber:i}}),k(!0)},ee=async(t,a,i)=>{c(!0),k(!1);try{(await w.editChunkFromStore(i.storeId,i.docId,i.id,{pageContent:t,metadata:a},!0)).data&&(u({message:"Document chunk successfully edited!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:o=>e.jsx(C,{style:{color:"white"},onClick:()=>m(o),children:e.jsx(j,{})})}}),n.request(x,g,l)),c(!1)}catch(s){c(!1),u({message:`Failed to edit chunk: ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:o=>e.jsx(C,{style:{color:"white"},onClick:()=>m(o),children:e.jsx(j,{})})}})}},te=async t=>{const a={title:"Delete",description:`Delete chunk ${t.id} ? This action cannot be undone.`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await G(a)){c(!0),k(!1);try{(await w.deleteChunkFromStore(t.storeId,t.docId,t.id)).data&&(u({message:"Document chunk successfully deleted!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:o=>e.jsx(C,{style:{color:"white"},onClick:()=>m(o),children:e.jsx(j,{})})}}),n.request(x,g,l)),c(!1)}catch(s){c(!1),u({message:`Failed to delete chunk: ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:o=>e.jsx(C,{style:{color:"white"},onClick:()=>m(o),children:e.jsx(j,{})})}})}}};r.useEffect(()=>{c(!0),n.request(x,g,l)},[]);const B=t=>{c(!0),D(t),n.request(x,g,t)};return r.useEffect(()=>{var t;if(n.data){const a=n.data,i=a.workspaceId;if(!H(i)){b("/unauthorized");return}if(K(a.count),J(a.chunks),c(!1),D(a.currentPage),O(a.currentPage*50-49),_(a.currentPage*50>a.count?a.count:a.currentPage*50),(t=a.file)!=null&&t.files&&a.file.files.length>0){const s=[];for(const o of a.file.files)s.push(o.name);Y(s)}}},[n.data]),e.jsxs(e.Fragment,{children:[e.jsx(A,{style:{position:"relative"},children:v?e.jsx(ve,{error:v}):e.jsxs(he,{flexDirection:"column",sx:{gap:1},children:[e.jsx(Se,{isBackButton:!0,search:!1,title:((P=(N=n.data)==null?void 0:N.file)==null?void 0:P.loaderName)||((T=n.data)==null?void 0:T.storeName),description:((F=(M=n.data)==null?void 0:M.file)==null?void 0:F.splitterName)||((q=n.data)==null?void 0:q.description),onBack:()=>b(-1)}),e.jsxs("div",{style:{width:"100%"},children:[E.length>0&&e.jsx(y,{sx:{mt:1},container:!0,children:E.map((t,a)=>e.jsx("div",{style:{paddingLeft:"15px",paddingRight:"15px",paddingTop:"10px",paddingBottom:"10px",fontSize:"0.9rem",width:"max-content",borderRadius:"25px",boxShadow:d.isDarkMode?"0 2px 14px 0 rgb(255 255 255 / 20%)":"0 2px 14px 0 rgb(32 40 45 / 20%)",display:"flex",flexDirection:"row",alignItems:"center",marginRight:"10px"},children:t},a))}),e.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",alignContent:"center",overflow:"hidden",marginTop:15,marginBottom:10},children:[e.jsxs("div",{style:{marginRight:20,display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx($,{size:"small",onClick:()=>B(l-1),style:{marginRight:10},variant:"outlined",disabled:l===1,children:e.jsx(De,{color:d.isDarkMode?l===1?"#616161":"white":l===1?"#e0e0e0":"black"})}),"Showing ",Math.min(I,h),"-",f," of ",h," chunks",e.jsx($,{size:"small",onClick:()=>B(l+1),style:{marginLeft:10},variant:"outlined",disabled:f>=h,children:e.jsx(Ie,{color:d.isDarkMode?f>=h?"#616161":"white":f>=h?"#e0e0e0":"black"})})]}),e.jsxs("div",{style:{marginRight:20,display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Re,{style:{marginRight:10},size:20}),(L=(z=n.data)==null?void 0:z.characters)==null?void 0:L.toLocaleString()," characters"]})]})]}),e.jsx("div",{children:e.jsxs(y,{container:!0,spacing:2,children:[!p.length&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[e.jsx(ue,{sx:{mt:5,p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"16vh",width:"auto"},src:Ce,alt:"chunks_emptySVG"})}),e.jsx("div",{children:"No Chunks"})]}),p.length>0&&p.map((t,a)=>e.jsx(y,{item:!0,lg:4,md:4,sm:6,xs:6,children:e.jsx(Ee,{content:!1,onClick:()=>Z(t.id),sx:{border:1,borderColor:V.palette.grey[900]+25,borderRadius:2},children:e.jsx(me,{children:e.jsxs(xe,{sx:{p:2},children:[e.jsx(W,{sx:{wordWrap:"break-word",mb:1},variant:"h5",children:`#${t.chunkNo}. Characters: ${t.pageContent.length}`}),e.jsx(W,{sx:{wordWrap:"break-word"},variant:"body2",children:t.pageContent}),e.jsx(ke,{theme:d.isDarkMode?"ocean":"rjv-default",style:{paddingTop:10},src:t.metadata?JSON.parse(t.metadata):{},name:null,quotesOnKeys:!1,enableClipboard:!1,displayDataTypes:!1,collapsed:1})]})})})},a))]})})]})}),e.jsx(we,{}),e.jsx(be,{show:Q,dialogProps:X,onCancel:()=>k(!1),onChunkEdit:(t,a,i)=>ee(t,a,i),onDeleteChunk:t=>te(t)}),R&&e.jsx(je,{open:R})]})};export{_e as default};
