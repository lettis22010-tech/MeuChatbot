import{a as X,p as _,b7 as ee,db as se,r,c as D,u as re,bi as ie,cT as te,j as e,B as u,S as k,aA as ae,a4 as ne,l as t,Z as oe,a1 as le,aa as ce,z as de,n as I,bh as he}from"./index-B1XR3Coy.js";import{z as l,p as N}from"./validation-DNbaeON5.js";import{I as b}from"./Input-C2v4FwXn.js";import{B as me}from"./BackdropLoader-C982mQas.js";import{A as ue,G as pe,a as ge,l as fe}from"./auth0-C7knQvrB.js";import{s as xe}from"./sso-Crogm5cK.js";import{G as je}from"./github-BtlA98as.js";import{A as B,I as ye}from"./IconExclamationCircle-BsAK4qbB.js";import{I as we}from"./IconCircleCheck-CKqsC1lm.js";import{I as C}from"./Icon-BOcLJSmQ.js";import"./ListItem-C9nlU6HX.js";import"./FormControl-Cb0ROeST.js";import"./Close-CA_iFeNy.js";const ve=l.object({username:l.string().min(1,"Name is required"),email:l.string().min(1,"Email is required").email("Invalid email address"),password:N,confirmPassword:l.string().min(1,"Confirm Password is required"),token:l.string().min(1,"Invite Code is required")}).refine(c=>c.password===c.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),Se=l.object({username:l.string().min(1,"Name is required"),email:l.string().min(1,"Email is required").email("Invalid email address"),password:N,confirmPassword:l.string().min(1,"Confirm Password is required")}).refine(c=>c.password===c.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),Me=()=>{const c=X();_();const{isEnterpriseLicensed:j,isCloud:P,isOpenSource:H}=ee(),z={label:"Username",name:"username",type:"text",placeholder:"John Doe"},F={label:"Password",name:"password",type:"password",placeholder:"********"},Y={label:"Confirm Password",name:"confirmPassword",type:"password",placeholder:"********"},$={label:"EMail",name:"email",type:"email",placeholder:"user@company.com"},J={label:"Invite Code",name:"inviteCode",type:"text"},[K]=se(),[p,R]=r.useState(""),[g,G]=r.useState(""),[E,L]=r.useState(""),[A,O]=r.useState(K.get("token")??""),[f,q]=r.useState(""),[n,Z]=r.useState([]),[M,y]=r.useState(!1),[w,m]=r.useState(""),[T,U]=r.useState(void 0),d=D(he.registerAccount),o=D(xe.ssoLogin),x=D(fe.getDefaultLoginMethods),W=re(),Q=async s=>{if(s.preventDefault(),j){const a=ve.safeParse({username:f,email:p,token:A,password:g,confirmPassword:E});if(a.success){y(!0);const i={user:{name:f,email:p,credential:g,tempToken:A}};await d.request(i)}else{const i=a.error.errors.map(h=>h.message);m(i.join(", "))}}else if(P){const i=new FormData(s.target).get("referral"),h=Se.safeParse({username:f,email:p,password:g,confirmPassword:E});if(h.success){y(!0);const S={user:{name:f,email:p,credential:g}};i&&(S.user.referral=i),await d.request(S)}else{const S=h.error.errors.map(V=>V.message);m(S.join(", "))}}},v=s=>{window.location.href=`/api/v1/${s}/login`};return r.useEffect(()=>{var s,a,i;d.error&&(j?m(`Error in registering user. Please contact your administrator. (${(i=(a=(s=d.error)==null?void 0:s.response)==null?void 0:a.data)==null?void 0:i.message})`):P&&m("Error in registering user. Please try again."),y(!1))},[d.error]),r.useEffect(()=>{H||x.request()},[]),r.useEffect(()=>{var s;o.data&&(ie.dispatch(te(o.data)),W(((s=location.state)==null?void 0:s.path)||"/chatflows"))},[o.data]),r.useEffect(()=>{var s,a,i,h;o.error&&(((a=(s=o.error)==null?void 0:s.response)==null?void 0:a.status)===401&&((h=(i=o.error)==null?void 0:i.response)!=null&&h.data.redirectUrl)?window.location.href=o.error.response.data.redirectUrl:m(o.error.message))},[o.error]),r.useEffect(()=>{x.data&&x.data.providers&&Z(x.data.providers.map(s=>s))},[x.data]),r.useEffect(()=>{d.data&&(y(!1),m(void 0),L(""),G(""),O(""),q(""),R(""),j?U("Registration Successful. You will be redirected to the sign in page shortly."):P&&U("To complete your registration, please click on the verification link we sent to your email address"),setTimeout(()=>{W("/signin")},3e3))},[d.data]),e.jsxs(e.Fragment,{children:[e.jsx(u,{sx:{width:"100%",maxHeight:"100vh",overflowY:"auto",display:"flex",flexDirection:"column",alignItems:"center",padding:"24px"},children:e.jsxs(k,{flexDirection:"column",sx:{width:"480px",gap:3},children:[w&&e.jsx(B,{icon:e.jsx(ye,{}),variant:"filled",severity:"error",children:w.split(", ").length>0?e.jsx(ae,{dense:!0,sx:{py:0},children:w.split(", ").map((s,a)=>e.jsx(ne,{primary:s,primaryTypographyProps:{color:"#fff !important"}},a))}):w}),T&&e.jsx(B,{icon:e.jsx(we,{}),variant:"filled",severity:"success",children:T}),e.jsxs(k,{sx:{gap:1},children:[e.jsx(t,{variant:"h1",children:"Sign Up"}),e.jsxs(t,{variant:"body2",sx:{color:c.palette.grey[600]},children:["Already have an account?"," ",e.jsx(oe,{style:{color:c.palette.primary.main},to:"/signin",children:"Sign In"}),"."]})]}),e.jsx("form",{onSubmit:Q,"data-rewardful":!0,children:e.jsxs(k,{sx:{width:"100%",flexDirection:"column",alignItems:"left",justifyContent:"center",gap:2},children:[e.jsxs(u,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Full Name",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(b,{inputParam:z,placeholder:"Display Name",onChange:s=>q(s),value:f,showDialog:!1}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Is used for display purposes only."})})]}),e.jsxs(u,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Email",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(b,{inputParam:$,onChange:s=>R(s),value:p,showDialog:!1}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Kindly use a valid email address. Will be used as login id."})})]}),j&&e.jsxs(u,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Invite Code",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(le,{fullWidth:!0,type:"string",placeholder:"Paste in the invite code.",multiline:!1,inputParam:J,onChange:s=>O(s.target.value),value:A}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Please copy the token you would have received in your email."})})]}),e.jsxs(u,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Password",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(b,{inputParam:F,onChange:s=>G(s),value:g}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Password must be at least 8 characters long and contain at least one lowercase letter, one uppercase letter, one digit, and one special character."})})]}),e.jsxs(u,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Confirm Password",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(b,{inputParam:Y,onChange:s=>L(s),value:E}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Confirm your password. Must match the password typed above."})})]}),e.jsx(ce,{variant:"contained",style:{borderRadius:12,height:40,marginRight:5},type:"submit",children:"Create Account"}),n.length>0&&e.jsx(de,{sx:{width:"100%"},children:"OR"}),n&&n.map(s=>s==="azure"&&e.jsx(I,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>v(s),startIcon:e.jsx(C,{children:e.jsx("img",{src:ue,alt:"MicrosoftSSO",width:20,height:20})}),children:"Sign In With Microsoft"},s)),n&&n.map(s=>s==="google"&&e.jsx(I,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>v(s),startIcon:e.jsx(C,{children:e.jsx("img",{src:pe,alt:"GoogleSSO",width:20,height:20})}),children:"Sign In With Google"},s)),n&&n.map(s=>s==="auth0"&&e.jsx(I,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>v(s),startIcon:e.jsx(C,{children:e.jsx("img",{src:ge,alt:"Auth0SSO",width:20,height:20})}),children:"Sign In With Auth0 by Okta"},s)),n&&n.map(s=>s==="github"&&e.jsx(I,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>v(s),startIcon:e.jsx(C,{children:e.jsx("img",{src:je,alt:"GithubSSO",width:20,height:20})}),children:"Sign In With Github"},s))]})})]})}),M&&e.jsx(me,{open:M})]})};export{Me as default};
