import{t as ie,L as fe,N as se,O as ce,P as M,a as de,R as ue,r as o,j as e,U as Se,V as Ie,W as Ee,X as be,a3 as ae,Y as ye,B as J,_ as ne,c as q,aq as re,M as Ce,S as W,aj as C,a0 as Te,a2 as S,n as L,a6 as ke,a8 as ve,D as Oe,h as Me,k as Ne,m as we}from"./index-B1XR3Coy.js";import{e as oe}from"./react-datepicker-CbT3l_H_.js";import{E as Ae}from"./ErrorBoundary-WOMkE_83.js";import{V as Pe}from"./ViewHeader-jo2V0q71.js";import{d as Re,a as Fe,e as U}from"./NodeExecutionDetails-DAbNicF8.js";import{d as ze,I as Le}from"./StopCircle-i-Eq3mUR.js";import{T as H}from"./TableSortLabel-DZVq0i6E.js";import{S as p}from"./Skeleton-BQAmmov-.js";import{I as Be}from"./IconCircleXFilled-eMwzVwFM.js";import{E as Ye}from"./ExecutionDetails-Cn2bJoQa.js";import{D as le,T as _e}from"./TablePagination-Dfhg7VLc.js";import{F as $e}from"./FormControl-Cb0ROeST.js";import{I as qe}from"./InputLabel-HPVYUEFn.js";import{T as G}from"./TextField-BEeUeVUl.js";import{T as We}from"./Tooltip-9ICsuaYn.js";import{I as Ue}from"./IconTrash-BvhWIQ6v.js";import{D as He}from"./DialogContentText-DvhtFVvn.js";import"./IconCopy-BBl1XuSo.js";import"./StyledFab-BqTal21_.js";import"./IconSearch-BzBgax5m.js";import"./createStyled-BzRwilhm.js";import"./MemoizedReactMarkdown-CNH2mkE4.js";import"./toPropertyKey-hKuLU48H.js";import"./index-D--Rb2MU.js";import"./main-BBsr8sqY.js";import"./CodeEditor-BjDzi2Vy.js";import"./index-DhL3T6x0.js";import"./IconClock-eC9b3RM9.js";import"./ToggleButtonGroup-D1WH89Fe.js";import"./CardMedia-DxratGiC.js";import"./IconShare-DiLHmK0B.js";import"./IconRefresh-B2aTlEaU.js";import"./Pagination-DyTukyc1.js";import"./LastPage-CMvObEkB.js";const Ge="/assets/executions_empty-DFi9-LFe.svg",r=ie(fe)(({theme:c})=>({borderColor:c.palette.grey[900]+25,[`&.${se.head}`]:{color:c.palette.grey[900]},[`&.${se.body}`]:{fontSize:14,height:64}})),V=ie(ce)(()=>({"&:last-child td, &:last-child th":{border:0}})),Ve=(c,I)=>{switch(c){case"FINISHED":return Fe;case"ERROR":case"TIMEOUT":return Re;case"TERMINATED":return u=>{const n=x=>e.jsx(Be,{...x,color:I.palette.error.main});return n.displayName="TerminatedIcon",e.jsx(n,{...u})};case"STOPPED":return ze;case"INPROGRESS":return u=>{const n=x=>e.jsx(Le,{...x,color:I.palette.warning.dark,className:`spin-animation ${x.className||""}`});return n.displayName="InProgressIcon",e.jsx(n,{...u})}}},Je=c=>{switch(c){case"FINISHED":return"success.dark";case"ERROR":case"TIMEOUT":return"error.main";case"TERMINATED":case"STOPPED":return"error.main";case"INPROGRESS":return"warning.main"}},K=({data:c,isLoading:I,onExecutionRowClick:u,onSelectionChange:n})=>{const x=de(),E=ue(s=>s.customization),T="executions_order",N="executions_orderBy",[g,w]=o.useState(localStorage.getItem(T)||"desc"),[m,B]=o.useState(localStorage.getItem(N)||"updatedDate"),[h,j]=o.useState([]),k=s=>{const l=m===s&&g==="asc"?"desc":"asc";w(l),B(s),localStorage.setItem(T,l),localStorage.setItem(N,s)},A=s=>{if(s.target.checked){const i=c.map(l=>l.id);j(i),n&&n(i)}else j([]),n&&n([])},P=(s,i)=>{s.stopPropagation();const l=h.indexOf(i);let a=[];l===-1?a=a.concat(h,i):l===0?a=a.concat(h.slice(1)):l===h.length-1?a=a.concat(h.slice(0,-1)):l>0&&(a=a.concat(h.slice(0,l),h.slice(l+1))),j(a),n&&n(a)},R=s=>h.indexOf(s)!==-1,D=c?[...c].sort((s,i)=>m==="name"?g==="asc"?(s.name||"").localeCompare(i.name||""):(i.name||"").localeCompare(s.name||""):m==="updatedDate"?g==="asc"?new Date(s.updatedDate)-new Date(i.updatedDate):new Date(i.updatedDate)-new Date(s.updatedDate):0):[];return e.jsx(e.Fragment,{children:e.jsx(Se,{sx:{border:1,borderColor:x.palette.grey[900]+25,borderRadius:2},component:Ie,children:e.jsxs(Ee,{sx:{minWidth:650},size:"small","aria-label":"a dense table",children:[e.jsx(be,{sx:{backgroundColor:E.isDarkMode?x.palette.common.black:x.palette.grey[100],height:56},children:e.jsxs(ce,{children:[e.jsx(r,{padding:"checkbox",children:e.jsx(ae,{color:"primary",indeterminate:h.length>0&&h.length<c.length,checked:c.length>0&&h.length===c.length,onChange:A,inputProps:{"aria-label":"select all executions"}})}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:e.jsx(H,{active:m==="updatedDate",direction:g,onClick:()=>k("updatedDate"),children:"Last Updated"})}),e.jsx(r,{component:"th",scope:"row",children:e.jsx(H,{active:m==="name",direction:g,onClick:()=>k("name"),children:"Agentflow"})}),e.jsx(r,{children:"Session"}),e.jsx(r,{children:e.jsx(H,{active:m==="createdDate",direction:g,onClick:()=>k("createdDate"),children:"Created"})})]})}),e.jsx(ye,{children:I?e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(r,{padding:"checkbox",children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})})]}),e.jsxs(V,{children:[e.jsx(r,{padding:"checkbox",children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})}),e.jsx(r,{children:e.jsx(p,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:D.map((s,i)=>{var b;const l=R(s.id),a=`enhanced-table-checkbox-${i}`;return e.jsxs(V,{hover:!0,sx:{cursor:"pointer","&:last-child td, &:last-child th":{border:0}},children:[e.jsx(r,{padding:"checkbox",children:e.jsx(ae,{color:"primary",checked:l,onClick:F=>P(F,s.id),inputProps:{"aria-labelledby":a}})}),e.jsx(r,{onClick:()=>u(s),children:e.jsx(J,{component:Ve(s.state,x),className:"labelIcon",color:Je(s.state)})}),e.jsx(r,{onClick:()=>u(s),children:ne(s.updatedDate).format("MMM D, YYYY h:mm A")}),e.jsx(r,{onClick:()=>u(s),children:(b=s.agentflow)==null?void 0:b.name}),e.jsx(r,{onClick:()=>u(s),children:s.sessionId}),e.jsx(r,{onClick:()=>u(s),children:ne(s.createdDate).format("MMM D, YYYY h:mm A")})]},i)})})})]})})})};K.propTypes={data:M.array,isLoading:M.bool,onExecutionRowClick:M.func,onSelectionChange:M.func,className:M.string};K.displayName="ExecutionsListTable";const Nt=()=>{const c=de(),I=ue(t=>t.customization),u=c.palette.grey[900]+25,n=q(U.getAllExecutions),x=q(U.deleteExecutions),E=q(U.getExecutionById),[T,N]=o.useState(null),[g,w]=o.useState(!0),[m,B]=o.useState([]),[h,j]=o.useState(!1),[k,A]=o.useState([]),[P,R]=o.useState({}),[D,s]=o.useState([]),[i,l]=o.useState(!1),[a,b]=o.useState({state:"",startDate:null,endDate:null,agentflowId:"",sessionId:""}),F=(t,d)=>{b({...a,[t]:d})},X=(t,d)=>{const O=new Date(d);O.setHours(0,0,0,0),b({...a,[t]:O})},[z,Z]=o.useState(1),[v,xe]=o.useState(le),[Q,me]=o.useState(0),he=(t,d)=>{Z(t),xe(d),ee(t,d)},ee=(t,d)=>{w(!0);const y={page:typeof t=="number"?t:z,limit:typeof d=="number"?d:v};if(a.state&&(y.state=a.state),a.startDate){const f=new Date(a.startDate),Y=f.getFullYear(),_=String(f.getMonth()+1).padStart(2,"0"),$=String(f.getDate()).padStart(2,"0");y.startDate=`${Y}-${_}-${$}T00:00:00.000Z`}if(a.endDate){const f=new Date(a.endDate),Y=f.getFullYear(),_=String(f.getMonth()+1).padStart(2,"0"),$=String(f.getDate()).padStart(2,"0");y.endDate=`${Y}-${_}-${$}T23:59:59.999Z`}a.agentflowId&&(y.agentflowId=a.agentflowId),a.sessionId&&(y.sessionId=a.sessionId),n.request(y)},pe=()=>{b({state:"",startDate:null,endDate:null,agentflowId:"",sessionId:""}),Z(1),n.request({page:1,limit:v})},ge=t=>{s(t)},je=()=>{D.length>0&&l(!0)},te=()=>{l(!1)},De=()=>{x.request(D),l(!1)};return o.useEffect(()=>{n.request({page:1,limit:le})},[]),o.useEffect(()=>{if(n.data)try{const{data:t,total:d}=n.data;if(!Array.isArray(t))return;B(t),me(d)}catch(t){console.error(t)}},[n.data]),o.useEffect(()=>{w(n.loading)},[n.loading]),o.useEffect(()=>{N(n.error)},[n.error]),o.useEffect(()=>{x.data&&(n.request({page:z,limit:v}),s([]))},[x.data]),o.useEffect(()=>{if(E.data){const t=E.data,d=typeof t.executionData=="string"?JSON.parse(t.executionData):t.executionData;A(d);const O={...re.omit(t,["executionData"]),agentflow:{...P.agentflow}};R(O)}},[E.data]),e.jsx(Ce,{children:T?e.jsx(Ae,{error:T}):e.jsxs(W,{flexDirection:"column",sx:{gap:3},children:[e.jsx(Pe,{title:"Agent Executions",description:"Monitor and manage agentflows executions"}),e.jsx(J,{sx:{mb:2,width:"100%"},children:e.jsxs(C,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(C,{item:!0,xs:12,md:2,children:e.jsxs($e,{fullWidth:!0,size:"small",children:[e.jsx(qe,{id:"state-select-label",children:"State"}),e.jsxs(Te,{labelId:"state-select-label",value:a.state,label:"State",onChange:t=>F("state",t.target.value),size:"small",sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:u},"& .MuiSvgIcon-root":{color:I.isDarkMode?"#fff":"inherit"}},children:[e.jsx(S,{value:"",children:"All"}),e.jsx(S,{value:"INPROGRESS",children:"In Progress"}),e.jsx(S,{value:"FINISHED",children:"Finished"}),e.jsx(S,{value:"ERROR",children:"Error"}),e.jsx(S,{value:"TERMINATED",children:"Terminated"}),e.jsx(S,{value:"TIMEOUT",children:"Timeout"}),e.jsx(S,{value:"STOPPED",children:"Stopped"})]})]})}),e.jsx(C,{item:!0,xs:12,md:2,children:e.jsx(oe,{selected:a.startDate,onChange:t=>X("startDate",t),selectsStart:!0,startDate:a.startDate,className:"form-control",wrapperClassName:"datePicker",maxDate:new Date,customInput:e.jsx(G,{size:"small",label:"Start date",fullWidth:!0,sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:u}}})})}),e.jsx(C,{sx:{ml:-1},item:!0,xs:12,md:2,children:e.jsx(oe,{selected:a.endDate,onChange:t=>X("endDate",t),selectsEnd:!0,endDate:a.endDate,className:"form-control",wrapperClassName:"datePicker",minDate:a.startDate,maxDate:new Date,customInput:e.jsx(G,{size:"small",label:"End date",fullWidth:!0,sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:u}}})})}),e.jsx(C,{sx:{ml:-1},item:!0,xs:12,md:2,children:e.jsx(G,{fullWidth:!0,label:"Session ID",value:a.sessionId,onChange:t=>F("sessionId",t.target.value),size:"small",sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:u}}})}),e.jsx(C,{item:!0,xs:12,md:4,children:e.jsxs(W,{direction:"row",spacing:1,children:[e.jsx(L,{variant:"contained",color:"primary",onClick:()=>ee(z,v),size:"small",children:"Apply"}),e.jsx(L,{variant:"outlined",onClick:pe,size:"small",children:"Reset"}),e.jsx(ke,{permissions:["executions:delete"],children:e.jsx(We,{title:"Delete selected executions",children:e.jsx("span",{children:e.jsx(ve,{sx:{height:30,width:30},size:"small",color:"error",onClick:je,edge:"end",disabled:D.length===0,children:e.jsx(Ue,{})})})})})]})})]})}),(m==null?void 0:m.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx(K,{data:m,isLoading:g,onSelectionChange:ge,onExecutionRowClick:t=>{j(!0);const d=typeof t.executionData=="string"?JSON.parse(t.executionData):t.executionData;A(d),R(re.omit(t,["executionData"]))}}),!g&&Q>0&&e.jsx(_e,{currentPage:z,limit:v,total:Q,onChange:he}),e.jsx(Ye,{open:h,execution:k,metadata:P,onClose:()=>j(!1),onProceedSuccess:()=>{j(!1),n.request()},onUpdateSharing:()=>{n.request()},onRefresh:t=>{n.request(),E.request(t)}})]}),e.jsxs(Oe,{open:i,onClose:te,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Me,{id:"alert-dialog-title",children:"Confirm Deletion"}),e.jsx(Ne,{children:e.jsxs(He,{id:"alert-dialog-description",children:["Are you sure you want to delete ",D.length," execution",D.length!==1?"s":"","? This action cannot be undone."]})}),e.jsxs(we,{children:[e.jsx(L,{onClick:te,color:"primary",children:"Cancel"}),e.jsx(L,{onClick:De,color:"error",children:"Delete"})]})]}),!g&&(!m||m.length===0)&&e.jsxs(W,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(J,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:Ge,alt:"execution_empty"})}),e.jsx("div",{children:"No Executions Yet"})]})]})})};export{Nt as default};
