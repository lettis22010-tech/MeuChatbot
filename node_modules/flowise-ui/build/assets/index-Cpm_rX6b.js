import{P as w,a as q,o as G,p as H,r as o,j as e,D as ae,h as ie,k as oe,B as F,l as E,S as O,a8 as B,a9 as ne,a1 as Oe,m as re,aa as le,s as ce,n as b,E as K,J,K as X,q as Re,H as Z,ab as de,t as he,L as $e,N as ee,O as M,ac as x,R as _e,b as Ue,c as ze,M as Ye,ad as Le,e as Ve,U as We,V as qe,W as pe,X as me,a6 as v,Y as xe,ae as Ge,C as He}from"./index-B1XR3Coy.js";import{m as te}from"./moment-9Y6NtRWJ.js";import{a as $}from"./apikey-DdsPjp8B.js";import{I as ye}from"./IconCopy-BBl1XuSo.js";import{C as ue,u as Je}from"./ConfirmDialog-Bksga_et.js";import{V as Xe}from"./ViewHeader-jo2V0q71.js";import{E as Qe}from"./ErrorBoundary-WOMkE_83.js";import{F as Ze}from"./File-B2PWlg1I.js";import{D as et}from"./Dropdown-BH_BuIwh.js";import{D as tt,T as st}from"./TablePagination-Dfhg7VLc.js";import{I as at}from"./IconPlus-DpyX5kZB.js";import{S as A}from"./Skeleton-BQAmmov-.js";import{I as it}from"./IconEyeOff-BOYq-4iX.js";import{I as ot}from"./IconEye-5BEWSVYC.js";import{I as nt,a as rt}from"./IconChevronsUp-iPfKij1q.js";import{I as lt}from"./IconSearch-BzBgax5m.js";import{I as ct}from"./IconTrash-BvhWIQ6v.js";import"./StyledFab-BqTal21_.js";import"./FormControl-Cb0ROeST.js";import"./Autocomplete-2B99MXTa.js";import"./Close-CA_iFeNy.js";import"./TextField-BEeUeVUl.js";import"./InputLabel-HPVYUEFn.js";import"./Pagination-DyTukyc1.js";import"./LastPage-CMvObEkB.js";const je=({show:t,dialogProps:i,onCancel:p,onConfirm:k,setError:l})=>{const c=document.getElementById("portal"),y=q(),u=G();H();const j=(...n)=>u(J(...n)),C=(...n)=>u(X(...n)),[d,D]=o.useState(""),[S,m]=o.useState(null),r=!!S;o.useEffect(()=>{i.type==="EDIT"&&i.key?D(i.key.keyName):i.type==="ADD"&&D("")},[i]);const g=()=>{m(null)},T=async()=>{try{(await $.createNewAPI({keyName:d})).data&&(j({message:"New API key added",options:{key:new Date().getTime()+Math.random(),variant:"success",action:f=>e.jsx(b,{style:{color:"white"},onClick:()=>C(f),children:e.jsx(K,{})})}}),k())}catch(n){l&&l(n),j({message:`Failed to add new API key: ${typeof n.response.data=="object"?n.response.data.message:n.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:f=>e.jsx(b,{style:{color:"white"},onClick:()=>C(f),children:e.jsx(K,{})})}}),p()}},R=async()=>{try{(await $.updateAPI(i.key.id,{keyName:d})).data&&(j({message:"API Key saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:f=>e.jsx(b,{style:{color:"white"},onClick:()=>C(f),children:e.jsx(K,{})})}}),k())}catch(n){l&&l(n),j({message:`Failed to save API key: ${typeof n.response.data=="object"?n.response.data.message:n.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:f=>e.jsx(b,{style:{color:"white"},onClick:()=>C(f),children:e.jsx(K,{})})}}),p()}},_=t?e.jsxs(ae,{fullWidth:!0,maxWidth:"sm",open:t,onClose:p,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ie,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:i.title}),e.jsxs(oe,{children:[i.type==="EDIT"&&e.jsxs(F,{sx:{p:2},children:[e.jsx(E,{variant:"overline",children:"API Key"}),e.jsxs(O,{direction:"row",sx:{mb:1},children:[e.jsx(E,{sx:{p:1,borderRadius:10,backgroundColor:y.palette.primary.light,width:"max-content",height:"max-content"},variant:"h5",children:i.key.apiKey}),e.jsx(B,{title:"Copy API Key",color:"success",onClick:n=>{navigator.clipboard.writeText(i.key.apiKey),m(n.currentTarget),setTimeout(()=>{g()},1500)},children:e.jsx(ye,{})}),e.jsx(ne,{open:r,anchorEl:S,onClose:g,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsx(E,{variant:"h6",sx:{pl:1,pr:1,color:"white",background:y.palette.success.dark},children:"Copied!"})})]})]}),e.jsxs(F,{sx:{p:2},children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsx(E,{variant:"overline",children:"Key Name"})}),e.jsx(Oe,{id:"keyName",type:"string",fullWidth:!0,placeholder:"My New Key",value:d,name:"keyName",onChange:n=>D(n.target.value)})]})]}),e.jsx(re,{children:e.jsx(le,{variant:"contained",onClick:()=>i.type==="ADD"?T():R(),id:i.customBtnId,children:i.confirmButtonName})})]}):null;return ce.createPortal(_,c)};je.propTypes={show:w.bool,dialogProps:w.object,onCancel:w.func,onConfirm:w.func,setError:w.func};const dt=[{label:"Add & Overwrite",name:"overwriteIfExist",description:"Add keys and overwrite existing keys with the same name"},{label:"Add & Ignore",name:"ignoreIfExist",description:"Add keys and ignore existing keys with the same name"},{label:"Add & Verify",name:"errorIfExist",description:"Add Keys and throw error if key with same name exists"},{label:"Replace All",name:"replaceAll",description:"Replace all keys with the imported keys"}],ge=({show:t,dialogProps:i,onCancel:p,onConfirm:k})=>{const l=document.getElementById("portal"),c=G();H();const y=(...r)=>c(J(...r)),u=(...r)=>c(X(...r)),[j,C]=o.useState(),[d,D]=o.useState("overwrite");o.useEffect(()=>()=>{C()},[i]),o.useEffect(()=>(c(t?{type:Re}:{type:Z}),()=>c({type:Z})),[t,c]);const S=async()=>{try{const r={importMode:d,jsonFile:j},g=await $.importAPI(r);g.data&&(y({message:"Imported keys successfully!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:T=>e.jsx(b,{style:{color:"white"},onClick:()=>u(T),children:e.jsx(K,{})})}}),k(g.data.id))}catch(r){y({message:`Failed to import keys: ${typeof r.response.data=="object"?r.response.data.message:r.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:g=>e.jsx(b,{style:{color:"white"},onClick:()=>u(g),children:e.jsx(K,{})})}}),p()}},m=t?e.jsxs(ae,{fullWidth:!0,maxWidth:"sm",open:t,onClose:p,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ie,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(de,{style:{marginRight:"10px"}}),"Import API Keys"]})}),e.jsxs(oe,{children:[e.jsxs(F,{sx:{p:2},children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsxs(E,{variant:"overline",children:["Import api.json file",e.jsx("span",{style:{color:"red"},children:" *"})]})}),e.jsx(Ze,{disabled:!1,fileType:".json",onChange:r=>C(r),value:j??"Choose a file to upload"})]}),e.jsxs(F,{sx:{p:2},children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsxs(E,{variant:"overline",children:["Import Mode",e.jsx("span",{style:{color:"red"},children:" *"})]})}),e.jsx(et,{name:d,options:dt,onSelect:r=>D(r),value:d??"choose an option"},d)]})]}),e.jsxs(re,{children:[e.jsx(b,{onClick:()=>p(),children:i.cancelButtonName}),e.jsx(le,{disabled:!j,variant:"contained",onClick:S,children:i.confirmButtonName})]}),e.jsx(ue,{})]}):null;return ce.createPortal(m,l)};ge.propTypes={show:w.bool,dialogProps:w.object,onCancel:w.func,onConfirm:w.func};const ht="/assets/api_empty-CBGH5wg8.svg",a=he($e)(({theme:t})=>({borderColor:t.palette.grey[900]+25,padding:"6px 16px",[`&.${ee.head}`]:{color:t.palette.grey[900]},[`&.${ee.body}`]:{fontSize:14,height:64}})),se=he(M)(()=>({"&:last-child td, &:last-child th":{border:0}}));function fe(t){const[i,p]=o.useState(!1),k=q();return e.jsxs(e.Fragment,{children:[e.jsxs(M,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{scope:"row",style:{width:"15%"},children:t.apiKey.keyName}),e.jsxs(a,{style:{width:"40%"},children:[t.showApiKeys.includes(t.apiKey.apiKey)?t.apiKey.apiKey:`${t.apiKey.apiKey.substring(0,2)}${"•".repeat(18)}${t.apiKey.apiKey.substring(t.apiKey.apiKey.length-5)}`,e.jsx(B,{title:"Copy",color:"success",onClick:t.onCopyClick,children:e.jsx(ye,{})}),e.jsx(B,{title:"Show",color:"inherit",onClick:t.onShowAPIClick,children:t.showApiKeys.includes(t.apiKey.apiKey)?e.jsx(it,{}):e.jsx(ot,{})}),e.jsx(ne,{open:t.open,anchorEl:t.anchorEl,onClose:t.onClose,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsx(E,{variant:"h6",sx:{pl:1,pr:1,color:"white",background:t.theme.palette.success.dark},children:"Copied!"})})]}),e.jsxs(a,{children:[t.apiKey.chatFlows.length," ",t.apiKey.chatFlows.length>0&&e.jsx(B,{"aria-label":"expand row",size:"small",color:"inherit",onClick:()=>p(!i),children:t.apiKey.chatFlows.length>0&&i?e.jsx(nt,{}):e.jsx(rt,{})})]}),e.jsx(a,{children:te(t.apiKey.createdAt).format("MMMM Do, YYYY")}),e.jsx(v,{permission:"apikeys:update,apikeys:create",children:e.jsx(a,{children:e.jsx(B,{title:"Edit",color:"primary",onClick:t.onEditClick,children:e.jsx(lt,{})})})}),e.jsx(v,{permission:"apikeys:delete",children:e.jsx(a,{children:e.jsx(B,{title:"Delete",color:"error",onClick:t.onDeleteClick,children:e.jsx(ct,{})})})})]}),i&&e.jsx(M,{sx:{"& td":{border:0}},children:e.jsx(a,{sx:{p:2},colSpan:6,children:e.jsx(Ge,{in:i,timeout:"auto",unmountOnExit:!0,children:e.jsx(F,{sx:{borderRadius:2,border:1,borderColor:k.palette.grey[900]+25,overflow:"hidden"},children:e.jsxs(pe,{"aria-label":"chatflow table",children:[e.jsx(me,{sx:{height:48},children:e.jsxs(M,{children:[e.jsx(a,{sx:{width:"30%"},children:"Chatflow Name"}),e.jsx(a,{sx:{width:"20%"},children:"Modified On"}),e.jsx(a,{sx:{width:"50%"},children:"Category"})]})}),e.jsx(xe,{children:t.apiKey.chatFlows.map((l,c)=>e.jsxs(M,{children:[e.jsx(a,{children:l.flowName}),e.jsx(a,{children:te(l.updatedDate).format("MMMM Do, YYYY")}),e.jsxs(a,{children:[" ",l.category&&l.category.split(";").map((y,u)=>e.jsx(He,{label:y,style:{marginRight:5,marginBottom:5}},u))]})]},c))})]})})})})})]})}fe.propTypes={apiKey:x.any,showApiKeys:x.arrayOf(x.any),onCopyClick:x.func,onShowAPIClick:x.func,open:x.bool,anchorEl:x.any,onClose:x.func,theme:x.any,onEditClick:x.func,onDeleteClick:x.func};const Ot=()=>{const t=q(),i=_e(s=>s.customization),p=G();H();const{error:k,setError:l}=Ue(),c=(...s)=>p(J(...s)),y=(...s)=>p(X(...s)),[u,j]=o.useState(!0),[C,d]=o.useState(!1),[D,S]=o.useState({}),[m,r]=o.useState([]),[g,T]=o.useState(null),[R,_]=o.useState([]),n=!!g,[f,Y]=o.useState(!1),[ke,Ce]=o.useState({}),[we,be]=o.useState(""),[U,Ie]=o.useState(1),[z,Ae]=o.useState(tt),[ve,Ke]=o.useState(0),De=(s,h)=>{Ie(s),Ae(h),L(s,h)},L=(s,h)=>{const I={page:s||U,limit:h||z};P.request(I)},Se=s=>{be(s.target.value)};function Pe(s){return s.keyName.toLowerCase().indexOf(we.toLowerCase())>-1}const{confirm:Ee}=Je(),P=ze($.getAllAPIKeys),Te=s=>{if(R.indexOf(s)>-1){const I=R.filter(function(N){return N!==s});_(I)}else _(I=>[...I,s])},Q=()=>{T(null)},Ne=()=>{S({title:"Add New API Key",type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",customBtnId:"btn_confirmAddingApiKey"}),d(!0)},Be=s=>{S({title:"Edit API Key",type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Save",customBtnId:"btn_confirmEditingApiKey",key:s}),d(!0)},Me=()=>{Ce({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Upload",data:{}}),Y(!0)},Fe=async s=>{const h={title:"Delete",description:s.chatFlows.length===0?`Delete key [${s.keyName}] ? `:`Delete key [${s.keyName}] ?
 There are ${s.chatFlows.length} chatflows using this key.`,confirmButtonName:"Delete",cancelButtonName:"Cancel",customBtnId:"btn_initiateDeleteApiKey"};if(await Ee(h))try{(await $.deleteAPI(s.id)).data&&(c({message:"API key deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:W=>e.jsx(b,{style:{color:"white"},onClick:()=>y(W),children:e.jsx(K,{})})}}),V())}catch(N){c({message:`Failed to delete API key: ${typeof N.response.data=="object"?N.response.data.message:N.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:W=>e.jsx(b,{style:{color:"white"},onClick:()=>y(W),children:e.jsx(K,{})})}}),onCancel()}},V=()=>{d(!1),Y(!1),L(U,z)};return o.useEffect(()=>{L(U,z)},[]),o.useEffect(()=>{j(P.loading)},[P.loading]),o.useEffect(()=>{var s,h;P.data&&(r((s=P.data)==null?void 0:s.data),Ke((h=P.data)==null?void 0:h.total))},[P.data]),e.jsxs(e.Fragment,{children:[e.jsx(Ye,{children:k?e.jsx(Qe,{error:k}):e.jsxs(O,{flexDirection:"column",sx:{gap:3},children:[e.jsxs(Xe,{onSearchChange:Se,search:!0,searchPlaceholder:"Search API Keys",title:"API Keys",description:"Flowise API & SDK authentication keys",children:[e.jsx(Le,{permissionId:"apikeys:import",variant:"outlined",sx:{borderRadius:2,height:"100%"},onClick:Me,startIcon:e.jsx(de,{}),id:"btn_importApiKeys",children:"Import"}),e.jsx(Ve,{permissionId:"apikeys:create",variant:"contained",sx:{borderRadius:2,height:"100%"},onClick:Ne,startIcon:e.jsx(at,{}),id:"btn_createApiKey",children:"Create Key"})]}),!u&&(m==null?void 0:m.length)<=0?e.jsxs(O,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(F,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:ht,alt:"APIEmptySVG"})}),e.jsx("div",{children:"No API Keys Yet"})]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{sx:{border:1,borderColor:t.palette.grey[900]+25,borderRadius:2},component:qe,children:e.jsxs(pe,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(me,{sx:{backgroundColor:i.isDarkMode?t.palette.common.black:t.palette.grey[100],height:56},children:e.jsxs(M,{children:[e.jsx(a,{children:"Key Name"}),e.jsx(a,{children:"API Key"}),e.jsx(a,{children:"Usage"}),e.jsx(a,{children:"Updated"}),e.jsx(v,{permission:"apikeys:update,apikeys:create",children:e.jsx(a,{children:" "})}),e.jsx(v,{permission:"apikeys:delete",children:e.jsx(a,{children:" "})})]})}),e.jsx(xe,{children:u?e.jsxs(e.Fragment,{children:[e.jsxs(se,{children:[e.jsx(a,{children:e.jsx(A,{variant:"text"})}),e.jsx(a,{children:e.jsx(A,{variant:"text"})}),e.jsx(a,{children:e.jsx(A,{variant:"text"})}),e.jsx(a,{children:e.jsx(A,{variant:"text"})}),e.jsx(v,{permission:"apikeys:update,apikeys:create",children:e.jsx(a,{children:" "})}),e.jsx(v,{permission:"apikeys:delete",children:e.jsx(a,{children:" "})})]}),e.jsxs(se,{children:[e.jsx(a,{children:e.jsx(A,{variant:"text"})}),e.jsx(a,{children:e.jsx(A,{variant:"text"})}),e.jsx(a,{children:e.jsx(A,{variant:"text"})}),e.jsx(a,{children:e.jsx(A,{variant:"text"})}),e.jsx(v,{permission:"apikeys:update,apikeys:create",children:e.jsx(a,{children:" "})}),e.jsx(v,{permission:"apikeys:delete",children:e.jsx(a,{children:" "})})]})]}):e.jsx(e.Fragment,{children:m==null?void 0:m.filter(Pe).map((s,h)=>e.jsx(fe,{apiKey:s,showApiKeys:R,onCopyClick:I=>{navigator.clipboard.writeText(s.apiKey),T(I.currentTarget),setTimeout(()=>{Q()},1500)},onShowAPIClick:()=>Te(s.apiKey),open:n,anchorEl:g,onClose:Q,theme:t,onEditClick:()=>Be(s),onDeleteClick:()=>Fe(s)},h))})})]})}),e.jsx(st,{currentPage:U,limit:z,total:ve,onChange:De})]})]})}),e.jsx(je,{show:C,dialogProps:D,onCancel:()=>d(!1),onConfirm:V,setError:l}),f&&e.jsx(ge,{show:f,dialogProps:ke,onCancel:()=>Y(!1),onConfirm:V}),e.jsx(ue,{})]})};export{Ot as default};
