import{af as we,r as l,az as U,s as Ye,f as ht,i as gt,j as t,t as oe,M as Ce,P as E,a as ge,R as ne,bI as le,a8 as V,cU as ke,ao as J,d1 as Se,B as O,d as se,l as ie,w as Z,ba as ee,c8 as te,A as Ue,o as Ke,E as Je,cV as xt,q as mt,H as Xe,D as ft,k as yt,S as fe,an as ye,as as bt}from"./index-B1XR3Coy.js";import{N as Qe,I as jt}from"./NodeInfoDialog-BBny0-Sx.js";import{I as Ze,d as et}from"./StopCircle-i-Eq3mUR.js";import{B as Ie}from"./ButtonGroup-glLVEjXK.js";import{I as Ee}from"./IconCopy-BBl1XuSo.js";import{I as Ne}from"./IconTrash-BvhWIQ6v.js";import{T as be}from"./Tooltip-9ICsuaYn.js";import{r as tt,e as je,o as vt,t as ve,h as ot,j as X,s as wt,d as Ct,v as kt,l as St,w as It,x as qe,i as Te,H as he,g as Et,q as Nt,N as Tt}from"./DocStoreInputHandler-9-EYgHTZ.js";import{B as At}from"./style-BgWmVXbp.js";import{I as Mt}from"./Input-C2v4FwXn.js";import{T as Dt}from"./TextField-BEeUeVUl.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var rt=we("outline","exclamation-mark","IconExclamationMark",[["path",{d:"M12 19v.01",key:"svg-0"}],["path",{d:"M12 15v-10",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Pt=we("filled","alert-circle-filled","IconAlertCircleFilled",[["path",{d:"M12 2c5.523 0 10 4.477 10 10a10 10 0 0 1 -19.995 .324l-.005 -.324l.004 -.28c.148 -5.393 4.566 -9.72 9.996 -9.72zm.01 13l-.127 .007a1 1 0 0 0 0 1.986l.117 .007l.127 -.007a1 1 0 0 0 0 -1.986l-.117 -.007zm-.01 -8a1 1 0 0 0 -.993 .883l-.007 .117v4l.007 .117a1 1 0 0 0 1.986 0l.007 -.117v-4l-.007 -.117a1 1 0 0 0 -.993 -.883z",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var st=we("filled","circle-chevron-right-filled","IconCircleChevronRightFilled",[["path",{d:"M12 2c5.523 0 10 4.477 10 10a10 10 0 0 1 -20 0c0 -5.523 4.477 -10 10 -10m-.293 6.293a1 1 0 0 0 -1.414 0l-.083 .094a1 1 0 0 0 .083 1.32l2.292 2.293l-2.292 2.293a1 1 0 0 0 1.414 1.414l3 -3a1 1 0 0 0 0 -1.414z",key:"svg-0"}]]);const Rt=e=>{var o;return(o=e.domNode)==null?void 0:o.querySelector(".react-flow__renderer")};function $t({children:e}){const o=je(Rt);return o?Ye.createPortal(e,o):null}const zt=(e,o)=>{var a,c,d,n,x,r;return((a=e==null?void 0:e.positionAbsolute)==null?void 0:a.x)===((c=o==null?void 0:o.positionAbsolute)==null?void 0:c.x)&&((d=e==null?void 0:e.positionAbsolute)==null?void 0:d.y)===((n=o==null?void 0:o.positionAbsolute)==null?void 0:n.y)&&(e==null?void 0:e.width)===(o==null?void 0:o.width)&&(e==null?void 0:e.height)===(o==null?void 0:o.height)&&(e==null?void 0:e.selected)===(o==null?void 0:o.selected)&&((x=e==null?void 0:e[ve])==null?void 0:x.z)===((r=o==null?void 0:o[ve])==null?void 0:r.z)},Ht=(e,o)=>e.length===o.length&&e.every((a,c)=>zt(a,o[c])),Ot=e=>({transform:e.transform,nodeOrigin:e.nodeOrigin,selectedNodesCount:e.getNodes().filter(o=>o.selected).length});function Lt(e,o,a,c,d){let n=.5;d==="start"?n=0:d==="end"&&(n=1);let x=[(e.x+e.width*n)*o[2]+o[0],e.y*o[2]+o[1]-c],r=[-100*n,-100];switch(a){case X.Right:x=[(e.x+e.width)*o[2]+o[0]+c,(e.y+e.height*n)*o[2]+o[1]],r=[0,-100*n];break;case X.Bottom:x[1]=(e.y+e.height)*o[2]+o[1]+c,r[1]=0;break;case X.Left:x=[e.x*o[2]+o[0]-c,(e.y+e.height*n)*o[2]+o[1]],r=[-100,-100*n];break}return`translate(${x[0]}px, ${x[1]}px) translate(${r[0]}%, ${r[1]}%)`}function xe({nodeId:e,children:o,className:a,style:c,isVisible:d,position:n=X.Top,offset:x=10,align:r="center",...p}){const f=tt(),N=l.useCallback(S=>(Array.isArray(e)?e:[e||f||""]).reduce((s,v)=>{const F=S.nodeInternals.get(v);return F&&s.push(F),s},[]),[e,f]),u=je(N,Ht),{transform:h,nodeOrigin:w,selectedNodesCount:C}=je(Ot,wt);if(!(typeof d=="boolean"?d:u.length===1&&u[0].selected&&C===1)||!u.length)return null;const A=vt(u,w),k=Math.max(...u.map(S=>{var b;return(((b=S[ve])==null?void 0:b.z)||1)+1})),D={position:"absolute",transform:Lt(A,h,n,x,r),zIndex:k,...c};return U.createElement($t,null,U.createElement("div",{style:D,className:ot(["react-flow__node-toolbar",a]),...p},o))}var Q;(function(e){e.Line="line",e.Handle="handle"})(Q||(Q={}));function Ft({width:e,prevWidth:o,height:a,prevHeight:c,invertX:d,invertY:n}){const x=e-o,r=a-c,p=[x>0?1:x<0?-1:0,r>0?1:r<0?-1:0];return x&&d&&(p[0]=p[0]*-1),r&&n&&(p[1]=p[1]*-1),p}const nt={width:0,height:0,x:0,y:0},_t={...nt,pointerX:0,pointerY:0,aspectRatio:1};function Bt({nodeId:e,position:o,variant:a=Q.Handle,className:c,style:d={},children:n,color:x,minWidth:r=10,minHeight:p=10,maxWidth:f=Number.MAX_VALUE,maxHeight:N=Number.MAX_VALUE,keepAspectRatio:u=!1,shouldResize:h,onResizeStart:w,onResize:C,onResizeEnd:I}){const A=tt(),k=typeof e=="string"?e:A,D=Ct(),S=l.useRef(null),b=l.useRef(_t),s=l.useRef(nt),v=kt(),F=a===Q.Line?"right":"bottom-right",P=o??F;l.useEffect(()=>{if(!S.current||!k)return;const j=St(S.current),i=P.includes("right")||P.includes("left"),g=P.includes("bottom")||P.includes("top"),M=P.includes("left"),H=P.includes("top"),_=It().on("start",T=>{const y=D.getState().nodeInternals.get(k),{xSnapped:q,ySnapped:G}=v(T);s.current={width:(y==null?void 0:y.width)??0,height:(y==null?void 0:y.height)??0,x:(y==null?void 0:y.position.x)??0,y:(y==null?void 0:y.position.y)??0},b.current={...s.current,pointerX:q,pointerY:G,aspectRatio:s.current.width/s.current.height},w==null||w(T,{...s.current})}).on("drag",T=>{const{nodeInternals:y,triggerNodeChanges:q}=D.getState(),{xSnapped:G,ySnapped:ae}=v(T),B=y.get(k);if(B){const K=[],{pointerX:ce,pointerY:ut,width:De,height:Pe,x:Re,y:$e,aspectRatio:W}=b.current,{x:ze,y:He,width:Oe,height:Le}=s.current,Fe=Math.floor(i?G-ce:0),_e=Math.floor(g?ae-ut:0);let $=qe(De+(M?-Fe:Fe),r,f),z=qe(Pe+(H?-_e:_e),p,N);if(u){const Y=$/z,re=i&&g,de=i&&!g,ue=g&&!i;$=Y<=W&&re||ue?z*W:$,z=Y>W&&re||de?$/W:z,$>=f?($=f,z=f/W):$<=r&&($=r,z=r/W),z>=N?(z=N,$=N*W):z<=p&&(z=p,$=p*W)}const Be=$!==Oe,We=z!==Le;if(M||H){const Y=M?Re-($-De):Re,re=H?$e-(z-Pe):$e,de=Y!==ze&&Be,ue=re!==He&&We;if(de||ue){const me={id:B.id,type:"position",position:{x:de?Y:ze,y:ue?re:He}};K.push(me),s.current.x=me.position.x,s.current.y=me.position.y}}if(Be||We){const Y={id:k,type:"dimensions",updateStyle:!0,resizing:!0,dimensions:{width:$,height:z}};K.push(Y),s.current.width=$,s.current.height=z}if(K.length===0)return;const pt=Ft({width:s.current.width,prevWidth:Oe,height:s.current.height,prevHeight:Le,invertX:M,invertY:H}),Ve={...s.current,direction:pt};if((h==null?void 0:h(T,Ve))===!1)return;C==null||C(T,Ve),q(K)}}).on("end",T=>{const y={id:k,type:"dimensions",resizing:!1};I==null||I(T,{...s.current}),D.getState().triggerNodeChanges([y])});return j.call(_),()=>{j.on(".drag",null)}},[k,P,r,p,f,N,u,v,w,C,I]);const R=P.split("-"),L=a===Q.Line?"borderColor":"backgroundColor",m=x?{...d,[L]:x}:d;return U.createElement("div",{className:ot(["react-flow__resize-control","nodrag",...R,a,c]),ref:S,style:m},n)}var Ge=l.memo(Bt);const Wt=["top-left","top-right","bottom-left","bottom-right"],Vt=["top","right","bottom","left"];function Xt({nodeId:e,isVisible:o=!0,handleClassName:a,handleStyle:c,lineClassName:d,lineStyle:n,color:x,minWidth:r=10,minHeight:p=10,maxWidth:f=Number.MAX_VALUE,maxHeight:N=Number.MAX_VALUE,keepAspectRatio:u=!1,shouldResize:h,onResizeStart:w,onResize:C,onResizeEnd:I}){return o?U.createElement(U.Fragment,null,Vt.map(A=>U.createElement(Ge,{key:A,className:d,style:n,nodeId:e,position:A,variant:Q.Line,color:x,minWidth:r,minHeight:p,maxWidth:f,maxHeight:N,onResizeStart:w,keepAspectRatio:u,shouldResize:h,onResize:C,onResizeEnd:I})),Wt.map(A=>U.createElement(Ge,{key:A,className:a,style:c,nodeId:e,position:A,color:x,minWidth:r,minHeight:p,maxWidth:f,maxHeight:N,onResizeStart:w,keepAspectRatio:u,shouldResize:h,onResize:C,onResizeEnd:I}))):null}var Ae={},qt=gt;Object.defineProperty(Ae,"__esModule",{value:!0});var Me=Ae.default=void 0,Gt=qt(ht()),Yt=t,Ut=(0,Gt.default)((0,Yt.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}),"Cancel");Me=Ae.default=Ut;const Kt=oe(Ce)(({theme:e})=>({background:e.palette.card.main,color:e.darkTextPrimary,border:"solid 1px",width:"max-content",height:"auto",padding:"10px",boxShadow:"none"})),Jt=oe(xe)(({theme:e})=>({backgroundColor:e.palette.card.main,color:e.darkTextPrimary,padding:"5px",borderRadius:"10px",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)"})),it=({data:e})=>{const o=ge(),a=ne(m=>m.customization),c=ne(m=>m.canvas),d=l.useRef(null),n=Te(),[x,r]=l.useState(0),[p,f]=l.useState(!1),[N,u]=l.useState(""),{deleteNode:h,duplicateNode:w}=l.useContext(le),[C,I]=l.useState(!1),[A,k]=l.useState({}),S=e.color||"#666666",b=()=>e.selected?S:p?Z(S,.8):Z(S,.5),s=()=>e.outputAnchors??[],v=m=>{var M;const g=(((M=d.current)==null?void 0:M.clientHeight)||0)/(s().length+1)*(m+1);return g>0&&n(e.id),g},F=()=>{const m=s().length;return Math.max(60,m*20+40)},P=()=>a.isDarkMode?p?ee(S,.7):ee(S,.8):p?te(S,.8):te(S,.9),R=m=>{switch(m){case"ERROR":return o.palette.error.dark;case"INPROGRESS":return o.palette.warning.dark;case"STOPPED":case"TERMINATED":return o.palette.error.main;case"FINISHED":return o.palette.success.dark;default:return o.palette.primary.dark}},L=m=>{const j=Ue.find(i=>i.name===m.name);return j?t.jsx(j.icon,{size:24,color:"white"}):null};return l.useEffect(()=>{d.current&&setTimeout(()=>{var m,j;r(((m=d.current)==null?void 0:m.offsetTop)+((j=d.current)==null?void 0:j.clientHeight)/2),n(e.id)},10)},[e,d,n]),l.useEffect(()=>{const m=(g,M)=>`Node version ${g} outdated
Update to latest version ${M}`,j=g=>`Node outdated
Update to latest version ${g}`,i=c.componentNodes.find(g=>g.name===e.name);i&&(e.version?e.version&&i.version>e.version?u(m(e.version,i.version)):i.badge==="DEPRECATING"?u((i==null?void 0:i.deprecateMessage)??"This node will be deprecated in the next release. Change to a new node tagged with NEW"):u(""):u(j(i.version)))},[c.componentNodes,e.name,e.version]),t.jsxs("div",{ref:d,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[t.jsx(Jt,{children:t.jsxs(Ie,{sx:{gap:1},variant:"outlined","aria-label":"Basic button group",children:[e.name!=="startAgentflow"&&t.jsx(V,{size:"small",title:"Duplicate",onClick:()=>{w(e.id)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.primary.main}},children:t.jsx(Ee,{size:20})}),t.jsx(V,{size:"small",title:"Delete",onClick:()=>{h(e.id)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.error.main}},children:t.jsx(Ne,{size:20})}),t.jsx(V,{size:"small",title:"Info",onClick:()=>{k({data:e}),I(!0)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.info.main}},children:t.jsx(ke,{size:20})})]})}),t.jsxs(Kt,{content:!1,sx:{borderColor:b(),borderWidth:"1px",boxShadow:e.selected?`0 0 0 1px ${b()} !important`:"none",minHeight:F(),height:"auto",backgroundColor:P(),display:"flex",alignItems:"center","&:hover":{boxShadow:e.selected?`0 0 0 1px ${b()} !important`:"none"}},border:!1,children:[e&&e.status&&t.jsx(be,{title:e.status==="ERROR"?e.error||"Error":"",children:t.jsx(J,{variant:"rounded",sx:{...o.typography.smallAvatar,borderRadius:"50%",background:e.status==="STOPPED"||e.status==="TERMINATED"?"white":R(e.status),color:"white",ml:2,position:"absolute",top:-10,right:-10},children:e.status==="INPROGRESS"?t.jsx(Ze,{className:"spin-animation"}):e.status==="ERROR"?t.jsx(rt,{}):e.status==="TERMINATED"?t.jsx(Me,{sx:{color:R(e.status)}}):e.status==="STOPPED"?t.jsx(et,{sx:{color:R(e.status)}}):t.jsx(Se,{})})}),N&&t.jsx(be,{placement:"right-start",title:t.jsx("span",{style:{whiteSpace:"pre-line"},children:N}),children:t.jsx(J,{variant:"rounded",sx:{...o.typography.smallAvatar,borderRadius:"50%",background:"white",position:"absolute",top:-10,left:-10},children:t.jsx(Pt,{color:"orange"})})}),t.jsxs(O,{sx:{width:"100%"},children:[!e.hideInput&&t.jsx(he,{type:"target",position:X.Left,id:e.id,style:{width:5,height:20,backgroundColor:"transparent",border:"none",position:"absolute",left:-2},children:t.jsx("div",{style:{width:5,height:20,backgroundColor:S,position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}})}),t.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[t.jsx(O,{item:!0,style:{width:50},children:e.color&&!e.icon?t.jsx("div",{style:{...o.typography.commonAvatar,...o.typography.largeAvatar,borderRadius:"15px",backgroundColor:e.color,cursor:"grab",display:"flex",justifyContent:"center",alignItems:"center",background:e.color},children:L(e)}):t.jsx("div",{style:{...o.typography.commonAvatar,...o.typography.largeAvatar,borderRadius:"50%",backgroundColor:"white",cursor:"grab"},children:t.jsx("img",{style:{width:"100%",height:"100%",padding:5,objectFit:"contain"},src:`${se}/api/v1/node-icon/${e.name}`,alt:e.name})})}),t.jsxs(O,{children:[t.jsx(ie,{sx:{fontSize:"0.85rem",fontWeight:500},children:e.label}),(()=>{var j,i,g,M,H,_;return[{model:(j=e.inputs)==null?void 0:j.llmModel,config:(i=e.inputs)==null?void 0:i.llmModelConfig},{model:(g=e.inputs)==null?void 0:g.agentModel,config:(M=e.inputs)==null?void 0:M.agentModelConfig},{model:(H=e.inputs)==null?void 0:H.conditionAgentModel,config:(_=e.inputs)==null?void 0:_.conditionAgentModelConfig}].filter(T=>T.model&&T.config).map((T,y)=>t.jsx(O,{sx:{display:"flex",gap:1,mt:1},children:t.jsxs(O,{sx:{backgroundColor:a.isDarkMode?"rgba(255, 255, 255, 0.2)":"rgba(255, 255, 255, 0.9)",borderRadius:"16px",width:"max-content",height:24,pl:1,pr:1,display:"flex",justifyContent:"center",alignItems:"center"},children:[t.jsx("img",{style:{width:20,height:20,objectFit:"contain"},src:`${se}/api/v1/node-icon/${T.model}`,alt:T.model}),t.jsx(ie,{sx:{fontSize:"0.7rem",ml:.5},children:T.config.modelName||T.config.model})]})},`model-${y}`))})(),(()=>{var j,i,g,M,H,_,T;return[{tools:(j=e.inputs)==null?void 0:j.llmTools,toolProperty:"llmSelectedTool"},{tools:(i=e.inputs)==null?void 0:i.agentTools,toolProperty:"agentSelectedTool"},{tools:((g=e.inputs)==null?void 0:g.selectedTool)??((M=e.inputs)==null?void 0:M.toolAgentflowSelectedTool)?[{selectedTool:((H=e.inputs)==null?void 0:H.selectedTool)??((_=e.inputs)==null?void 0:_.toolAgentflowSelectedTool)}]:[],toolProperty:["selectedTool","toolAgentflowSelectedTool"]},{tools:(T=e.inputs)==null?void 0:T.agentKnowledgeVSEmbeddings,toolProperty:["vectorStore","embeddingModel"]}].filter(y=>y.tools&&y.tools.length>0).map((y,q)=>t.jsx(O,{sx:{display:"flex",gap:1,mt:1},children:y.tools.flatMap((G,ae)=>{if(Array.isArray(y.toolProperty))return y.toolProperty.filter(B=>G[B]).map((B,K)=>{const ce=G[B];return t.jsx(O,{component:"img",src:`${se}/api/v1/node-icon/${ce}`,alt:ce,sx:{width:20,height:20,borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.2)",padding:.3}},`tool-${q}-${ae}-${K}`)});{const B=G[y.toolProperty];return B?[t.jsx(O,{component:"img",src:`${se}/api/v1/node-icon/${B}`,alt:B,sx:{width:20,height:20,borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.2)",padding:.3}},`tool-${q}-${ae}`)]:[]}})},`tools-${q}`))})()]})]}),s().map((m,j)=>t.jsxs(he,{type:"source",position:X.Right,id:m.id,style:{height:20,width:20,top:v(j),backgroundColor:"transparent",border:"none",position:"absolute",right:-10,opacity:p?1:0,transition:"opacity 0.2s"},children:[t.jsx("div",{style:{position:"absolute",width:20,height:20,borderRadius:"50%",backgroundColor:o.palette.background.paper,pointerEvents:"none"}}),t.jsx(st,{size:20,color:S,style:{pointerEvents:"none",position:"relative",zIndex:1}})]},m.id))]})]}),t.jsx(Qe,{show:C,dialogProps:A,onCancel:()=>I(!1)})]})};it.propTypes={data:E.object};const mo=l.memo(it),Qt=oe(Ce)(({theme:e})=>({background:e.palette.card.main,color:e.darkTextPrimary,border:"solid 1px",width:"max-content",height:"auto",padding:"10px",boxShadow:"none"})),Zt=oe(xe)(({theme:e})=>({backgroundColor:e.palette.card.main,color:e.darkTextPrimary,padding:"5px",borderRadius:"10px",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)"})),lt=({data:e})=>{const o=ge(),a=ne(i=>i.customization),c=l.useRef(null),d=l.useRef(null),n=Te(),[x,r]=l.useState(0),[p,f]=l.useState(!1),{deleteNode:N,duplicateNode:u,reactFlowInstance:h}=l.useContext(le),[w,C]=l.useState(!1),[I,A]=l.useState({}),[k,D]=l.useState({width:"300px",height:"250px"});l.useEffect(()=>{if(h){const i=h.getNodes().find(g=>g.id===e.id);i&&i.width&&i.height&&D({width:`${i.width}px`,height:`${i.height}px`})}},[h,e.id]);const b=e.color||"#666666",s=()=>e.selected?b:p?Z(b,.8):Z(b,.5),v=()=>e.outputAnchors??[],F=i=>{var _;const H=(((_=c.current)==null?void 0:_.clientHeight)||0)/(v().length+1)*(i+1);return H>0&&n(e.id),H},P=()=>{const i=v().length;return Math.max(60,i*20+40)},R=()=>a.isDarkMode?p?ee(b,.7):ee(b,.8):p?te(b,.8):te(b,.9),L=i=>{switch(i){case"ERROR":return o.palette.error.dark;case"INPROGRESS":return o.palette.warning.dark;case"STOPPED":case"TERMINATED":return o.palette.error.main;case"FINISHED":return o.palette.success.dark;default:return o.palette.primary.dark}},m=i=>{const g=Ue.find(M=>M.name===i.name);return g?t.jsx(g.icon,{size:24,color:"white"}):null};l.useEffect(()=>{c.current&&setTimeout(()=>{var i,g;r(((i=c.current)==null?void 0:i.offsetTop)+((g=c.current)==null?void 0:g.clientHeight)/2),n(e.id)},10)},[e,c,n]);const j=l.useCallback((i,g)=>{c.current&&D({width:`${g.width}px`,height:`${g.height}px`})},[c,D]);return t.jsxs("div",{ref:c,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[t.jsx(xe,{align:"start",isVisible:!0,children:t.jsxs(O,{style:{display:"flex",alignItems:"center",flexDirection:"row"},children:[e.color&&!e.icon?t.jsx("div",{style:{...o.typography.commonAvatar,...o.typography.largeAvatar,borderRadius:"15px",backgroundColor:e.color,cursor:"grab",display:"flex",justifyContent:"center",alignItems:"center",background:e.color},children:m(e)}):t.jsx("div",{style:{...o.typography.commonAvatar,...o.typography.largeAvatar,borderRadius:"50%",backgroundColor:"white",cursor:"grab"},children:t.jsx("img",{style:{width:"100%",height:"100%",padding:5,objectFit:"contain"},src:`${se}/api/v1/node-icon/${e.name}`,alt:e.name})}),t.jsx(ie,{sx:{fontSize:"0.85rem",fontWeight:500,ml:1},children:e.label})]})}),t.jsx(Zt,{align:"end",children:t.jsxs(Ie,{sx:{gap:1},variant:"outlined","aria-label":"Basic button group",children:[t.jsx(V,{size:"small",title:"Duplicate",onClick:()=>{u(e.id)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.primary.main}},children:t.jsx(Ee,{size:20})}),t.jsx(V,{size:"small",title:"Delete",onClick:()=>{N(e.id)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.error.main}},children:t.jsx(Ne,{size:20})}),t.jsx(V,{size:"small",title:"Info",onClick:()=>{A({data:e}),C(!0)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.info.main}},children:t.jsx(ke,{size:20})})]})}),t.jsx(Xt,{minWidth:300,minHeight:Math.max(P(),250),onResizeEnd:j}),t.jsxs(Qt,{content:!1,sx:{borderColor:s(),borderWidth:"1px",boxShadow:e.selected?`0 0 0 1px ${s()} !important`:"none",minHeight:Math.max(P(),250),minWidth:300,width:k.width,height:k.height,backgroundColor:R(),display:"flex","&:hover":{boxShadow:e.selected?`0 0 0 1px ${s()} !important`:"none"}},border:!1,children:[e&&e.status&&t.jsx(be,{title:e.status==="ERROR"?e.error||"Error":"",children:t.jsx(J,{variant:"rounded",sx:{...o.typography.smallAvatar,borderRadius:"50%",background:e.status==="STOPPED"||e.status==="TERMINATED"?"white":L(e.status),color:"white",ml:2,position:"absolute",top:-10,right:-10},children:e.status==="INPROGRESS"?t.jsx(Ze,{className:"spin-animation"}):e.status==="ERROR"?t.jsx(rt,{}):e.status==="TERMINATED"?t.jsx(Me,{sx:{color:L(e.status)}}):e.status==="STOPPED"?t.jsx(et,{sx:{color:L(e.status)}}):t.jsx(Se,{})})}),t.jsxs(O,{sx:{width:"100%"},children:[!e.hideInput&&t.jsx(he,{type:"target",position:X.Left,id:e.id,style:{width:5,height:20,backgroundColor:"transparent",border:"none",position:"absolute",left:-2},children:t.jsx("div",{style:{width:5,height:20,backgroundColor:b,position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}})}),t.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:t.jsx(O,{sx:{height:`calc(${k.height} - 20px)`,width:`${k.width}`,overflow:"hidden",position:"relative",borderRadius:"10px"},children:t.jsx("div",{ref:d,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:o.palette.background.default},children:t.jsx(At,{color:"#aaa",gap:16})})})}),v().map((i,g)=>t.jsxs(he,{type:"source",position:X.Right,id:i.id,style:{height:20,width:20,top:F(g),backgroundColor:"transparent",border:"none",position:"absolute",right:-10,opacity:p?1:0,transition:"opacity 0.2s"},children:[t.jsx("div",{style:{position:"absolute",width:20,height:20,borderRadius:"50%",backgroundColor:o.palette.background.paper,pointerEvents:"none"}}),t.jsx(st,{size:20,color:b,style:{pointerEvents:"none",position:"relative",zIndex:1}})]},i.id))]})]}),t.jsx(Qe,{show:w,dialogProps:I,onCancel:()=>C(!1)})]})};lt.propTypes={data:E.object};const fo=l.memo(lt);function at({transform:e,isHumanInput:o,label:a,color:c}){return t.jsx("div",{style:{position:"absolute",background:"transparent",left:o?10:0,paddingTop:1,color:c,fontSize:"0.5rem",fontWeight:700,transform:e,zIndex:1e3},className:"nodrag nopan",children:a})}at.propTypes={transform:E.string,isHumanInput:E.bool,label:E.string,color:E.string};const pe=40,ct=({id:e,sourceX:o,sourceY:a,targetX:c,targetY:d,sourcePosition:n,targetPosition:x,data:r,markerEnd:p,selected:f})=>{const[N,u]=l.useState(!1),{deleteEdge:h}=l.useContext(le),w=Ke(),C=(s,v)=>{s.stopPropagation(),h(v),w({type:xt})},I=o===c,A=a===d,[k,D,S]=Et({sourceX:I?o+1e-4:o,sourceY:A?a+1e-4:a,sourcePosition:n,targetX:c,targetY:d,targetPosition:x}),b=`edge-gradient-${e}`;return t.jsxs(t.Fragment,{children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:b,children:[t.jsx("stop",{offset:"0%",stopColor:(r==null?void 0:r.sourceColor)||"#ae53ba"}),t.jsx("stop",{offset:"100%",stopColor:(r==null?void 0:r.targetColor)||"#2a8af6"})]})}),t.jsx("path",{id:`${e}-selector`,className:"agent-flow-edge-selector",style:{stroke:"transparent",strokeWidth:15,fill:"none",cursor:"pointer"},d:k,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1)}),t.jsx("path",{id:e,className:"agent-flow-edge",style:{strokeWidth:f?3:2,stroke:`url(#${b})`,filter:f?"drop-shadow(0 0 3px rgba(0,0,0,0.3))":"none",cursor:"pointer",opacity:f?1:.75,fill:"none"},d:k,markerEnd:p,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1)}),(r==null?void 0:r.edgeLabel)&&t.jsx(Nt,{children:t.jsx(at,{isHumanInput:r==null?void 0:r.isHumanInput,color:(r==null?void 0:r.sourceColor)||"#ae53ba",label:r.edgeLabel,transform:`translate(-50%, 0%) translate(${o}px,${a}px)`})}),N&&t.jsx("foreignObject",{width:pe,height:pe,x:D-pe/2,y:S-pe/2,className:"edgebutton-foreignobject",requiredExtensions:"http://www.w3.org/1999/xhtml",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:t.jsx("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",pointerEvents:"all"},children:t.jsx("button",{className:"edgebutton",onClick:s=>C(s,e),style:{width:"12px",height:"12px",background:`linear-gradient(to right, ${(r==null?void 0:r.sourceColor)||"#ae53ba"}, ${(r==null?void 0:r.targetColor)||"#2a8af6"})`,border:"none",borderRadius:"50%",cursor:"pointer",fontSize:"10px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",boxShadow:"0 0 4px rgba(0,0,0,0.3)",transition:"all 0.2s ease-in-out",padding:"2px"},onMouseOver:s=>{s.currentTarget.style.transform="scale(1.2)",s.currentTarget.style.boxShadow="0 0 8px rgba(0,0,0,0.4)"},onFocus:s=>{s.currentTarget.style.transform="scale(1.2)",s.currentTarget.style.boxShadow="0 0 8px rgba(0,0,0,0.4)"},onMouseOut:s=>{s.currentTarget.style.transform="scale(1)",s.currentTarget.style.boxShadow="0 0 4px rgba(0,0,0,0.3)"},onBlur:s=>{s.currentTarget.style.transform="scale(1)",s.currentTarget.style.boxShadow="0 0 4px rgba(0,0,0,0.3)"},children:t.jsx(Je,{stroke:2,size:"12",color:"white"})})})})]})};ct.propTypes={id:E.string,sourceX:E.number,sourceY:E.number,targetX:E.number,targetY:E.number,sourcePosition:E.any,targetPosition:E.any,style:E.object,data:E.object,markerEnd:E.any,selected:E.bool};const yo=l.memo(ct),eo=oe(Ce)(({theme:e})=>({background:e.palette.card.main,color:e.darkTextPrimary,border:"solid 1px",width:"max-content",height:"auto",padding:"10px",boxShadow:"none"})),to=oe(xe)(({theme:e})=>({backgroundColor:e.palette.card.main,color:e.darkTextPrimary,padding:"5px",borderRadius:"10px",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)"})),oo=({data:e})=>{const o=ge(),a=ne(C=>C.customization),c=l.useRef(null),{reactFlowInstance:d,deleteNode:n,duplicateNode:x}=l.useContext(le),[r]=e.inputParams,[p,f]=l.useState(!1),u=e.color||"#666666",h=()=>e.selected?u:p?Z(u,.8):Z(u,.5),w=()=>a.isDarkMode?p?ee(u,.7):ee(u,.8):p?te(u,.8):te(u,.9);return t.jsxs("div",{ref:c,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[t.jsx(to,{children:t.jsxs(Ie,{sx:{gap:1},variant:"outlined","aria-label":"Basic button group",children:[t.jsx(V,{size:"small",title:"Duplicate",onClick:()=>{x(e.id)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.primary.main}},children:t.jsx(Ee,{size:20})}),t.jsx(V,{size:"small",title:"Delete",onClick:()=>{n(e.id)},sx:{color:a.isDarkMode?"white":"inherit","&:hover":{color:o.palette.error.main}},children:t.jsx(Ne,{size:20})})]})}),t.jsx(eo,{content:!1,sx:{borderColor:h(),borderWidth:"1px",boxShadow:e.selected?`0 0 0 1px ${h()} !important`:"none",minHeight:60,height:"auto",backgroundColor:w(),display:"flex",alignItems:"center","&:hover":{boxShadow:e.selected?`0 0 0 1px ${h()} !important`:"none"}},border:!1,children:t.jsx(O,{children:t.jsx(Mt,{placeholder:r.placeholder,inputParam:r,onChange:C=>e.inputs[r.name]=C,value:e.inputs[r.name]??r.default??"",nodes:d?d.getNodes():[],edges:d?d.getEdges():[],nodeId:e.id},e.id)})})]})};oo.propTypes={data:E.object};const dt=({show:e,dialogProps:o,onCancel:a})=>{const c=document.getElementById("portal"),d=Ke(),n=ge(),x=ne(s=>s.customization),r=l.useRef(),{reactFlowInstance:p}=l.useContext(le),f=Te(),[N,u]=l.useState([]),[h,w]=l.useState({}),[C,I]=l.useState(null),[A,k]=l.useState(""),D=()=>{p.setNodes(s=>s.map(v=>(v.id===h.id&&(v.data={...v.data,label:r.current.value},w(v.data)),v))),f(h.id)},S=({nodeId:s,inputParam:v,newValue:F})=>{p.setNodes(P=>P.map(R=>{if(R.id===s){const L={...R.data.inputs,[v.name]:F},m=bt({...R.data,inputs:L});Object.keys(L).forEach(j=>{const i=m.find(g=>g.name===j);i&&i.display===!1&&delete L[j]}),R.data={...R.data,inputParams:m,inputs:L},u(m),w(R.data)}return R}))};l.useEffect(()=>(o.inputParams&&u(o.inputParams),o.data&&(w(o.data),o.data.label&&k(o.data.label)),()=>{u([]),w({})}),[o]),l.useEffect(()=>(d(e?{type:mt}:{type:Xe}),()=>d({type:Xe})),[e,d]);const b=e?t.jsx(ft,{onClose:a,open:e,fullWidth:!0,maxWidth:"sm","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:t.jsxs(yt,{children:[h&&h.name&&t.jsx(O,{sx:{width:"100%"},children:C?t.jsxs(fe,{flexDirection:"row",sx:{width:"100%"},children:[t.jsx(Dt,{autoFocus:!0,size:"small",sx:{width:"100%",ml:2},inputRef:r,defaultValue:A,onKeyDown:s=>{s.key==="Enter"?(h.label=r.current.value,k(r.current.value),D(),I(!1)):s.key==="Escape"&&I(!1)}}),t.jsx(ye,{title:"Save Name",sx:{borderRadius:"50%"},children:t.jsx(J,{variant:"rounded",sx:{...n.typography.commonAvatar,...n.typography.mediumAvatar,transition:"all .2s ease-in-out",background:n.palette.success.light,color:n.palette.success.dark,ml:1,"&:hover":{background:n.palette.success.dark,color:n.palette.success.light}},color:"inherit",onClick:()=>{h.label=r.current.value,k(r.current.value),D(),I(!1)},children:t.jsx(Se,{stroke:1.5,size:"1rem"})})}),t.jsx(ye,{title:"Cancel",sx:{borderRadius:"50%"},children:t.jsx(J,{variant:"rounded",sx:{...n.typography.commonAvatar,...n.typography.mediumAvatar,transition:"all .2s ease-in-out",background:n.palette.error.light,color:n.palette.error.dark,ml:1,"&:hover":{background:n.palette.error.dark,color:n.palette.error.light}},color:"inherit",onClick:()=>I(!1),children:t.jsx(Je,{stroke:1.5,size:"1rem"})})})]}):t.jsxs(fe,{flexDirection:"row",sx:{display:"flex",alignItems:"center",mb:2},children:[t.jsx(ie,{sx:{ml:2,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},variant:"h4",children:A}),(h==null?void 0:h.id)&&t.jsx(ye,{title:"Edit Name",sx:{borderRadius:"50%"},children:t.jsx(J,{variant:"rounded",sx:{...n.typography.commonAvatar,...n.typography.mediumAvatar,transition:"all .2s ease-in-out",ml:1,background:n.palette.secondary.light,color:n.palette.secondary.dark,"&:hover":{background:n.palette.secondary.dark,color:n.palette.secondary.light}},color:"inherit",onClick:()=>I(!0),children:t.jsx(jt,{stroke:1.5,size:"1rem"})})})]})}),(h==null?void 0:h.hint)&&t.jsxs(fe,{direction:"row",alignItems:"center",sx:{ml:2,backgroundColor:x.isDarkMode?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.03)",borderRadius:"8px",mr:2,px:1.5,py:1,mt:1,mb:1,border:`1px solid ${x.isDarkMode?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.08)"}`},children:[t.jsx(ke,{size:"1rem",stroke:1.5,color:n.palette.info.main,style:{marginRight:"6px"}}),t.jsx(ie,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic",lineHeight:1.2},children:h.hint})]}),N.filter(s=>s.display!==!1).map((s,v)=>t.jsx(Tt,{disabled:o.disabled,inputParam:s,data:h,isAdditionalParams:!0,onCustomDataChange:S},v))]})}):null;return Ye.createPortal(b,c)};dt.propTypes={show:E.bool,dialogProps:E.object,onCancel:E.func};const bo=l.memo(dt);export{mo as A,bo as E,fo as I,oo as S,yo as a};
