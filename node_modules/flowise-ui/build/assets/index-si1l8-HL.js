import{af as ve,P,o as re,p as oe,r,R as M,q as We,H as ee,j as e,D as _,h as Ce,aK as Se,k as K,B as F,l as U,a1 as se,m as Ie,n as b,aa as Ae,s as Ee,E as I,au as O,bi as $,bl as Te,J as ne,K as ce,u as Be,a as ie,b as Ne,c as Y,bm as Oe,M as Me,S as z,e as Ue,U as le,V as de,W as pe,X as he,O as H,L as N,Y as xe,b9 as te,av as Re,C as q,b6 as Pe,a8 as G,$ as ae,Z as ze,bn as $e,a_ as Fe,ac as S}from"./index-B1XR3Coy.js";import{m as Le}from"./moment-9Y6NtRWJ.js";import{E as Ve}from"./ErrorBoundary-WOMkE_83.js";import{V as qe}from"./ViewHeader-jo2V0q71.js";import{C as ue,u as Ge}from"./ConfirmDialog-Bksga_et.js";import{S as J,a as o}from"./TableStyles-Bn4d_qd9.js";import{I as _e}from"./IconPlus-DpyX5kZB.js";import{S as w}from"./Skeleton-BQAmmov-.js";import{I as Ke}from"./IconEyeOff-BOYq-4iX.js";import{I as Ye}from"./IconEye-5BEWSVYC.js";import{I as He}from"./IconSearch-BzBgax5m.js";import{I as Je}from"./IconTrash-BvhWIQ6v.js";import"./IconCopy-BBl1XuSo.js";import"./StyledFab-BqTal21_.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Xe=ve("outline","trash-off","IconTrashOff",[["path",{d:"M3 3l18 18",key:"svg-0"}],["path",{d:"M4 7h3m4 0h9",key:"svg-1"}],["path",{d:"M10 11l0 6",key:"svg-2"}],["path",{d:"M14 14l0 3",key:"svg-3"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l.077 -.923",key:"svg-4"}],["path",{d:"M18.384 14.373l.616 -7.373",key:"svg-5"}],["path",{d:"M9 5v-1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-6"}]]);const me=({show:s,dialogProps:c,onCancel:y,onConfirm:i})=>{const v=document.getElementById("portal"),d=re();oe();const h=(...a)=>d(ne(...a)),x=(...a)=>d(ce(...a)),[m,p]=r.useState(""),[u,g]=r.useState(""),[W,n]=r.useState("ADD"),[D,T]=r.useState({}),C=M(a=>a.auth.user);r.useEffect(()=>(c.type==="EDIT"&&c.data?(p(c.data.name),g(c.data.description),n("EDIT"),T(c.data)):c.type==="ADD"&&(p(""),g(""),n("ADD"),T({})),()=>{p(""),g(""),n("ADD"),T({})}),[c]),r.useEffect(()=>(d(s?{type:We}:{type:ee}),()=>d({type:ee})),[s,d]);const A=async()=>{if(m==="Default Workspace"||m==="Personal Workspace"){h({message:"Workspace name cannot be Default Workspace or Personal Workspace - this is a reserved name",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:a=>e.jsx(b,{style:{color:"white"},onClick:()=>x(a),children:e.jsx(I,{})})}});return}try{const a={name:m,description:u,createdBy:C.id,organizationId:C.activeOrganizationId,existingWorkspaceId:C.activeWorkspaceId},l=await O.createWorkspace(a);l.data&&(h({message:"New Workspace added",options:{key:new Date().getTime()+Math.random(),variant:"success",action:B=>e.jsx(b,{style:{color:"white"},onClick:()=>x(B),children:e.jsx(I,{})})}}),i(l.data.id))}catch(a){h({message:`Failed to add new Workspace: ${typeof a.response.data=="object"?a.response.data.message:a.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:l=>e.jsx(b,{style:{color:"white"},onClick:()=>x(l),children:e.jsx(I,{})})}}),y()}},L=async()=>{try{const a={id:D.id,name:m,description:u,updatedBy:C.id},l=await O.updateWorkspace(a);l.data&&($.dispatch(Te(l.data)),h({message:"Workspace saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:B=>e.jsx(b,{style:{color:"white"},onClick:()=>x(B),children:e.jsx(I,{})})}}),i())}catch(a){h({message:`Failed to save Workspace: ${typeof a.response.data=="object"?a.response.data.message:a.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:l=>e.jsx(b,{style:{color:"white"},onClick:()=>x(l),children:e.jsx(I,{})})}}),y()}},R=s?e.jsxs(_,{fullWidth:!0,maxWidth:"sm",open:s,onClose:y,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Ce,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Se,{style:{marginRight:"10px"}}),c.type==="ADD"?"Add Workspace":"Edit Workspace"]})}),e.jsxs(K,{children:[e.jsxs(F,{sx:{p:2},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(U,{children:["Name",e.jsx("span",{style:{color:"red"},children:"Â *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(se,{size:"small",sx:{mt:1},type:"string",fullWidth:!0,onChange:a=>p(a.target.value),value:m??""},"workspaceName")]}),e.jsxs(F,{sx:{p:2},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsx(U,{children:"Description"}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(se,{size:"small",sx:{mt:1},type:"string",fullWidth:!0,multiline:!0,rows:4,onChange:a=>g(a.target.value),value:u??""},"workspaceDescription")]})]}),e.jsxs(Ie,{children:[e.jsx(b,{onClick:()=>y(),children:c.cancelButtonName}),e.jsx(Ae,{disabled:!m,variant:"contained",onClick:()=>W==="ADD"?A():L(),children:c.confirmButtonName})]}),e.jsx(ue,{})]}):null;return Ee.createPortal(R,v)};me.propTypes={show:P.bool,dialogProps:P.object,onCancel:P.func,onConfirm:P.func};const Ze="/assets/workspaces_empty-Bc1rx9Ju.svg";function ke(s){var W;const c=M(n=>n.customization),y=M(n=>n.auth.user),[i,v]=r.useState(!1),[d,h]=r.useState(""),[x,m]=r.useState([]),p=ie(),u=Y(Re.getAllUsersByWorkspaceId),g=n=>{v(!i),h(n)};return r.useEffect(()=>{u.data&&m(u.data)},[u.data]),r.useEffect(()=>{i&&d?u.request(d):(v(!1),h(""))},[i]),e.jsxs(r.Fragment,{children:[e.jsxs(J,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsxs(o,{component:"th",scope:"row",children:[s.workspace.name,y.activeWorkspaceId===s.workspace.id&&e.jsx(q,{sx:{ml:2,my:"auto",width:"max-content",background:p.palette.teal.main,color:"white"},label:"Active"})]}),e.jsx(o,{style:{wordWrap:"break-word",flexWrap:"wrap",width:"30%"},children:Pe(((W=s.workspace)==null?void 0:W.description)||"",200)}),e.jsxs(o,{sx:{textAlign:"center"},children:[s.workspace.userCount," ",s.workspace.userCount>0&&e.jsx(G,{"aria-label":"expand row",size:"small",color:"inherit",onClick:()=>g(s.workspace.id),children:s.workspace.userCount>0&&i?e.jsx(Ke,{}):e.jsx(Ye,{})})]}),e.jsx(o,{children:Le(s.workspace.updatedDate).format("MMMM Do YYYY, hh:mm A")}),e.jsxs(o,{children:[s.workspace.name!=="Default Workspace"&&e.jsx(ae,{permissionId:"workspace:update",title:"Edit",color:"primary",onClick:()=>s.onEditClick(s.workspace),children:e.jsx(He,{})}),e.jsx(ze,{to:`/workspace-users/${s.workspace.id}`,children:e.jsx(G,{title:"Workspace Users",color:"primary",children:e.jsx($e,{})})}),s.workspace.name!=="Default Workspace"&&(s.workspace.userCount>1||s.workspace.isOrgDefault===!0?e.jsx(G,{title:"Delete",disabled:!0,color:"error",onClick:()=>s.onDeleteClick(s.workspace),children:e.jsx(Xe,{})}):e.jsx(ae,{permissionId:"workspace:delete",title:"Delete",color:"error",onClick:()=>s.onDeleteClick(s.workspace),children:e.jsx(Je,{})}))]})]}),e.jsx(Fe,{anchor:"right",open:i,onClose:()=>v(!1),sx:{minWidth:320},children:e.jsxs(F,{sx:{p:4,height:"auto",width:650},children:[e.jsx(U,{sx:{textAlign:"left",mb:2},variant:"h2",children:"Users"}),e.jsx(le,{style:{display:"flex",flexDirection:"row"},sx:{border:1,borderColor:p.palette.grey[900]+25,borderRadius:2},component:de,children:e.jsxs(pe,{"aria-label":"workspace users table",children:[e.jsx(he,{sx:{backgroundColor:c.isDarkMode?p.palette.common.black:p.palette.grey[100],height:56},children:e.jsxs(H,{children:[e.jsx(o,{sx:{width:"60%"},children:"User"}),e.jsx(o,{sx:{width:"40%"},children:"Role"})]})}),e.jsx(xe,{children:x&&x.length>0&&x.map((n,D)=>e.jsxs(H,{children:[e.jsx(o,{children:n.user.name||n.user.email}),e.jsx(o,{children:n.isOrgOwner?e.jsx(q,{label:"ORGANIZATION OWNER",size:"small"}):n.role.name==="personal workspace"?e.jsx(q,{label:"PERSONAL WORKSPACE",size:"small"}):n.role.name})]},D))})]})})]})})]},s.rowKey)}ke.propTypes={rowKey:S.any,workspace:S.any,onEditClick:S.func,onDeleteClick:S.func,onViewUsersClick:S.func,open:S.bool,theme:S.any};const xs=()=>{const s=Be(),c=ie(),{confirm:y}=Ge(),i=M(t=>t.auth.user),v=M(t=>t.customization);oe();const d=(...t)=>p(ne(...t)),h=(...t)=>p(ce(...t)),[x,m]=r.useState(""),p=re(),{error:u,setError:g}=Ne(),[W,n]=r.useState(!0),[D,T]=r.useState([]),[C,A]=r.useState(!1),[L,R]=r.useState({}),[a,l]=r.useState(!1),[B,X]=r.useState(!1),k=Y(O.getAllWorkspacesByOrganizationId),E=Y(O.switchWorkspace),je=t=>{s(`/workspace-users/${t.id}`)},fe=t=>{m(t.target.value)},we=()=>{R({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",data:{}}),A(!0)},ge=t=>{R({type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Save",data:t}),A(!0)},ye=async t=>{const j={title:`Delete Workspace ${t.name}`,description:"This is irreversible and will remove all associated data inside the workspace. Are you sure you want to delete?",confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await y(j)){X(!0);try{const f=t.id;(await O.deleteWorkspace(f)).data&&(d({message:"Workspace deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:be=>e.jsx(b,{style:{color:"white"},onClick:()=>h(be),children:e.jsx(I,{})})}}),Z(f,!0))}catch(f){console.error("Failed to delete workspace:",f),d({message:`Failed to delete workspace: ${typeof f.response.data=="object"?f.response.data.message:f.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:Q=>e.jsx(b,{style:{color:"white"},onClick:()=>h(Q),children:e.jsx(I,{})})}})}finally{X(!1)}}},Z=(t,j)=>{if(A(!1),k.request(i.activeOrganizationId),!(i.assignedWorkspaces.length===0||D.length===0))if(j&&i.activeWorkspaceId===t){l(!0);const f=D[0].id;E.request(f)}else!j&&t&&(l(!0),E.request(t))};function De(t){return t.name.toLowerCase().indexOf(x.toLowerCase())>-1}return r.useEffect(()=>{if(E.data){l(!1);const t=new Promise(j=>{const V=$.subscribe(()=>{$.getState().auth.user.activeWorkspaceId===E.data.activeWorkspaceId&&(V(),j())})});$.dispatch(Oe(E.data)),t.then(()=>{s("/",{replace:!0}),s(0)})}},[E.data,s]),r.useEffect(()=>{k.data&&T(k.data)},[k.data]),r.useEffect(()=>{n(k.loading)},[k.loading]),r.useEffect(()=>{k.error&&g(k.error)},[k.error,g]),r.useEffect(()=>{k.request(i.activeOrganizationId)},[]),e.jsxs(e.Fragment,{children:[e.jsx(Me,{children:u?e.jsx(Ve,{error:u}):e.jsxs(z,{flexDirection:"column",sx:{gap:3},children:[e.jsx(qe,{isBackButton:!1,isEditButton:!1,onSearchChange:fe,search:!0,title:"Workspaces",searchPlaceholder:"Search Workspaces",children:e.jsx(Ue,{permissionId:"workspace:create",variant:"contained",sx:{borderRadius:2,height:"100%"},onClick:we,startIcon:e.jsx(_e,{}),children:"Add New"})}),!W&&D.length<=0?e.jsxs(z,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(F,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:Ze,alt:"workspaces_emptySVG"})}),e.jsx("div",{children:"No Workspaces Yet"})]}):e.jsx(le,{sx:{border:1,borderColor:c.palette.grey[900]+25,borderRadius:2},component:de,children:e.jsxs(pe,{sx:{minWidth:650},children:[e.jsx(he,{sx:{backgroundColor:v.isDarkMode?c.palette.common.black:c.palette.grey[100],height:56},children:e.jsxs(H,{children:[e.jsx(N,{children:"Name"}),e.jsx(N,{children:"Description"}),e.jsx(N,{children:"Users"}),e.jsx(N,{children:"Last Updated"}),e.jsx(N,{children:" "})]})}),e.jsx(xe,{children:W?e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})})]}),e.jsxs(J,{children:[e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})}),e.jsx(o,{children:e.jsx(w,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:D.filter(De).map((t,j)=>e.jsx(ke,{workspace:t,rowKey:j,onEditClick:ge,onDeleteClick:ye,onViewUsersClick:je},j))})})]})})]})}),C&&e.jsx(me,{show:C,dialogProps:L,onCancel:()=>A(!1),onConfirm:Z}),e.jsx(ue,{}),e.jsx(_,{open:a,PaperProps:{style:{backgroundColor:"transparent",boxShadow:"none"}},children:e.jsx(K,{children:e.jsxs(z,{spacing:2,alignItems:"center",children:[e.jsx(te,{}),e.jsx(U,{variant:"body1",style:{color:"white"},children:"Switching workspace..."})]})})}),e.jsx(_,{open:B,PaperProps:{style:{backgroundColor:"transparent",boxShadow:"none"}},children:e.jsx(K,{children:e.jsxs(z,{spacing:2,alignItems:"center",children:[e.jsx(te,{}),e.jsx(U,{variant:"body1",style:{color:"white"},children:"Deleting workspace..."})]})})})]})};export{xs as default};
