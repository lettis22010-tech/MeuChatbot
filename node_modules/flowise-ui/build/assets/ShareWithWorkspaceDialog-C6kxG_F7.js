import{P as p,o as E,p as O,c as j,au as g,av as q,R,r,q as z,H as b,j as a,D as F,h as G,k as U,B as D,S as _,l as H,a1 as M,m as $,n as x,aa as L,s as V,aq as J,E as w,J as K,K as X}from"./index-B1XR3Coy.js";import{C as Q}from"./ConfirmDialog-Bksga_et.js";import{G as Y}from"./Grid-DtMOPoeK.js";import{I as Z}from"./IconShare-DiLHmK0B.js";const P=({show:m,dialogProps:o,onCancel:u,setError:i})=>{const W=document.getElementById("portal"),d=E();O();const n=j(g.getSharedWorkspacesForItem),c=j(q.getWorkspacesByOrganizationIdUserId),k=(...e)=>d(K(...e)),y=(...e)=>d(X(...e)),l=R(e=>e.auth.user),[h,f]=r.useState([]),[I,v]=r.useState(""),A=e=>{setTimeout(()=>{f(t=>{let s=[...J.cloneDeep(t)];const S=s.findIndex(C=>C.id===e.id);return S>=0&&(s[S]={...e}),s})})},N=r.useMemo(()=>[{field:"workspaceName",headerName:"Workspace",editable:!1,flex:1},{field:"shared",headerName:"Share",type:"boolean",editable:!0,width:180}],[]);r.useEffect(()=>{if(n.data){const e=n.data;e&&e.length>0&&(h.map(t=>{e.map(s=>{t.id===s.workspaceId&&(t.shared=!0)})}),f([...h]))}},[n.data]),r.useEffect(()=>{n.error&&i&&i(n.error)},[n.error]),r.useEffect(()=>{if(c.data){const e=[];c.data.filter(t=>t.workspace.id!==l.activeWorkspaceId).map(t=>{e.push({id:t.workspace.id,workspaceName:t.workspace.name,shared:!1})}),f([...e])}},[c.data,l.activeWorkspaceId]),r.useEffect(()=>{c.error&&i&&i(c.error)},[c.error,i]),r.useEffect(()=>{l&&c.request(l.activeOrganizationId,l.id),v(o.data.name),n.request(o.data.id)},[o,l]),r.useEffect(()=>(d(m?{type:z}:{type:b}),()=>d({type:b})),[m,d]);const T=async()=>{try{const e={itemType:o.data.itemType,workspaceIds:[]};h.map(s=>{s.shared&&e.workspaceIds.push(s.id)}),(await g.setSharedWorkspacesForItem(o.data.id,e)).data&&(k({message:"Items Shared Successfully",options:{key:new Date().getTime()+Math.random(),variant:"success",action:s=>a.jsx(x,{style:{color:"white"},onClick:()=>y(s),children:a.jsx(w,{})})}}),u())}catch(e){i&&i(e),k({message:`Failed to share Item: ${typeof e.response.data=="object"?e.response.data.message:e.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:t=>a.jsx(x,{style:{color:"white"},onClick:()=>y(t),children:a.jsx(w,{})})}}),u()}},B=m?a.jsxs(F,{fullWidth:!0,maxWidth:"md",open:m,onClose:u,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[a.jsx(G,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:a.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[a.jsx(Z,{style:{marginRight:"10px"}}),o.data.title]})}),a.jsxs(U,{children:[a.jsxs(D,{sx:{p:2},children:[a.jsx(_,{sx:{position:"relative"},direction:"row",children:a.jsx(H,{variant:"overline",children:"Name"})}),a.jsx(M,{id:"name",type:"string",disabled:!0,fullWidth:!0,placeholder:I,value:I,name:"name"})]}),a.jsx(D,{sx:{p:2},children:a.jsx(Y,{columns:N,rows:h,onRowUpdate:A})})]}),a.jsxs($,{children:[a.jsx(x,{onClick:()=>u(),children:o.cancelButtonName}),a.jsx(L,{onClick:T,variant:"contained",children:o.confirmButtonName})]}),a.jsx(Q,{})]}):null;return V.createPortal(B,W)};P.propTypes={show:p.bool,dialogProps:p.object,onCancel:p.func,onConfirm:p.func,setError:p.func};export{P as S};
