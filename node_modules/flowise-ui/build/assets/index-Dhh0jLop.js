import{af as ge,P as S,R as E,o as J,p as K,r,q as pe,H as P,j as e,D as we,h as ye,k as Ie,B as D,l as k,a1 as X,m as ve,aa as Ce,s as be,av as B,n as M,E as L,J as Z,K as Q,a as ee,b as De,c as se,M as Ue,S as G,e as Se,U as te,V as ae,W as re,X as ne,O as q,Y as ie,az as ke,C as A,$,_ as Ee,b9 as Oe,a_ as Re,ac as b}from"./index-B1XR3Coy.js";import{C as oe,u as Te}from"./ConfirmDialog-Bksga_et.js";import{V as ze}from"./ViewHeader-jo2V0q71.js";import{E as Ne}from"./ErrorBoundary-WOMkE_83.js";import{D as Ae}from"./Dropdown-BH_BuIwh.js";import{I as le}from"./role-BJZr6s4d.js";import{a,S as H}from"./TableStyles-Bn4d_qd9.js";import{I as Be}from"./InviteUsersDialog-Cjo8M445.js";import{I as Me}from"./IconPlus-DpyX5kZB.js";import{S as u}from"./Skeleton-BQAmmov-.js";import{I as Le}from"./IconEyeOff-BOYq-4iX.js";import{I as Ve}from"./IconEye-5BEWSVYC.js";import{I as Fe}from"./IconSearch-BzBgax5m.js";import{I as We}from"./IconTrash-BvhWIQ6v.js";import"./StyledFab-BqTal21_.js";import"./IconCopy-BBl1XuSo.js";import"./Autocomplete-2B99MXTa.js";import"./Close-CA_iFeNy.js";import"./FormControl-Cb0ROeST.js";import"./TextField-BEeUeVUl.js";import"./InputLabel-HPVYUEFn.js";import"./IconCircleCheck-CKqsC1lm.js";import"./Tooltip-9ICsuaYn.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var _e=ge("outline","user-star","IconUserStar",[["path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0",key:"svg-0"}],["path",{d:"M6 21v-2a4 4 0 0 1 4 -4h.5",key:"svg-1"}],["path",{d:"M17.8 20.817l-2.172 1.138a.392 .392 0 0 1 -.568 -.41l.415 -2.411l-1.757 -1.707a.389 .389 0 0 1 .217 -.665l2.428 -.352l1.086 -2.193a.392 .392 0 0 1 .702 0l1.086 2.193l2.428 .352a.39 .39 0 0 1 .217 .665l-1.757 1.707l.414 2.41a.39 .39 0 0 1 -.567 .411l-2.172 -1.138z",key:"svg-2"}]]);const Ge=[{label:"Active",name:"active"},{label:"Inactive",name:"inactive"}],ce=({show:s,dialogProps:i,onCancel:x,onConfirm:m,setError:g})=>{var z,U;const j=document.getElementById("portal"),f=E(n=>n.auth.user),c=J();K();const p=(...n)=>c(Z(...n)),v=(...n)=>c(Q(...n)),[w,o]=r.useState(""),[h,y]=r.useState(""),[C,I]=r.useState("active"),[O,R]=r.useState({});r.useEffect(()=>(i.type==="EDIT"&&i.data&&(R(i.data.user),y(i.data.user.email),o(i.data.user.name),I(i.data.user.status)),()=>{y(""),o(""),I("active"),R({})}),[i]),r.useEffect(()=>(c(s?{type:pe}:{type:P}),()=>c({type:P})),[s,c]);const T=async()=>{try{const n={userId:O.id,organizationId:f.activeOrganizationId,status:C},l=await B.updateOrganizationUser(n);l.data&&(p({message:"User Details Updated",options:{key:new Date().getTime()+Math.random(),variant:"success",action:F=>e.jsx(M,{style:{color:"white"},onClick:()=>v(F),children:e.jsx(L,{})})}}),m(l.data.id))}catch(n){g(err),p({message:`Failed to update User: ${typeof n.response.data=="object"?n.response.data.message:n.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:l=>e.jsx(M,{style:{color:"white"},onClick:()=>v(l),children:e.jsx(L,{})})}}),x()}},V=s?e.jsxs(we,{fullWidth:!0,maxWidth:"sm",open:s,onClose:x,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ye,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(le,{style:{marginRight:"10px"}}),"Edit User"]})}),e.jsxs(Ie,{children:[e.jsxs(D,{sx:{p:1},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(k,{children:["Email",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(X,{size:"small",sx:{mt:1},type:"string",fullWidth:!0,disabled:!0,onChange:n=>y(n.target.value),value:h??""},"userEmail")]}),e.jsxs(D,{sx:{p:1},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsx(k,{children:"Name"}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(X,{size:"small",sx:{mt:1},type:"string",fullWidth:!0,disabled:!0,onChange:n=>o(n.target.value),value:w??""},"username")]}),e.jsxs(D,{sx:{p:1},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(k,{children:["Account Status",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(Ae,{name:"status",disabled:(z=i==null?void 0:i.data)==null?void 0:z.isOrgOwner,options:Ge,onSelect:n=>I(n),value:C??"choose an option",id:"dropdown_status"},C),((U=i==null?void 0:i.data)==null?void 0:U.isOrgOwner)&&e.jsx(k,{variant:"caption",children:e.jsx("i",{children:"Cannot change status of the organization owner!"})})]})]}),e.jsx(ve,{sx:{px:3,pb:2},children:e.jsx(Ce,{disabled:!h,variant:"contained",onClick:()=>T(),id:"btn_confirmInviteUser",children:i.confirmButtonName})}),e.jsx(oe,{})]}):null;return be.createPortal(V,j)};ce.propTypes={show:S.bool,dialogProps:S.object,onCancel:S.func,onConfirm:S.func,setError:S.func};const $e="/assets/users_empty-GRLclS2m.svg";function de(s){var w;const i=E(o=>o.customization),[x,m]=r.useState(!1),[g,j]=r.useState([]),f=ee(),c=se(B.getWorkspacesByOrganizationIdUserId),p=(o,h)=>{m(!x),c.request(h,o)};r.useEffect(()=>{c.data&&j(c.data)},[c.data]),r.useEffect(()=>{x||(m(!1),j([]))},[x]);const v=E(o=>o.auth.user);return e.jsxs(ke.Fragment,{children:[e.jsxs(H,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(a,{component:"th",scope:"row",children:e.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:e.jsx("div",{style:{width:25,height:25,marginRight:10,borderRadius:"50%"},children:(w=s==null?void 0:s.row)!=null&&w.isOrgOwner?e.jsx(_e,{style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"contain"}}):e.jsx(le,{style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"contain"}})})})}),e.jsxs(a,{children:[s.row.user.name??"",s.row.user.email&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),s.row.user.email]}),s.row.isOrgOwner&&e.jsxs(e.Fragment,{children:[" ",e.jsx("br",{}),e.jsx(A,{size:"small",label:"ORGANIZATION OWNER"})," "]})]}),e.jsxs(a,{sx:{textAlign:"center"},children:[s.row.roleCount,e.jsx($,{permissionId:"users:manage","aria-label":"expand row",size:"small",color:"inherit",onClick:()=>p(s.row.userId,s.row.organizationId),children:s.row.roleCount>0&&x?e.jsx(Le,{}):e.jsx(Ve,{})})]}),e.jsxs(a,{children:[s.row.status.toUpperCase()==="ACTIVE"&&e.jsx(A,{color:"success",label:s.row.status.toUpperCase()}),s.row.status.toUpperCase()==="INVITED"&&e.jsx(A,{color:"warning",label:s.row.status.toUpperCase()}),s.row.status.toUpperCase()==="INACTIVE"&&e.jsx(A,{color:"error",label:s.row.status.toUpperCase()})]}),e.jsx(a,{children:s.row.lastLogin?Ee(s.row.lastLogin).format("DD/MM/YYYY HH:mm"):"Never"}),e.jsxs(a,{children:[s.row.status.toUpperCase()==="INVITED"&&e.jsx($,{permissionId:"workspace:add-user,users:manage",title:"Edit",color:"primary",onClick:()=>s.onEditClick(s.row),children:e.jsx(Fe,{})}),!s.row.isOrgOwner&&s.row.userId!==v.id&&(s.deletingUserId===s.row.user.id?e.jsx(Oe,{size:24,color:"error"}):e.jsx($,{permissionId:"workspace:unlink-user,users:manage",title:"Delete",color:"error",onClick:()=>s.onDeleteClick(s.row.user),children:e.jsx(We,{})}))]})]}),e.jsx(Re,{anchor:"right",open:x,onClose:()=>m(!1),sx:{minWidth:320},children:e.jsxs(D,{sx:{p:4,height:"auto",width:650},children:[e.jsx(k,{sx:{textAlign:"left",mb:2},variant:"h2",children:"Assigned Roles"}),e.jsx(te,{style:{display:"flex",flexDirection:"row"},sx:{border:1,borderColor:f.palette.grey[900]+25,borderRadius:2},component:ae,children:e.jsxs(re,{"aria-label":"assigned roles table",children:[e.jsx(ne,{sx:{backgroundColor:i.isDarkMode?f.palette.common.black:f.palette.grey[100],height:56},children:e.jsxs(q,{children:[e.jsx(a,{sx:{width:"50%"},children:"Role"}),e.jsx(a,{sx:{width:"50%"},children:"Workspace"})]})}),e.jsx(ie,{children:g.map((o,h)=>e.jsxs(q,{children:[e.jsx(a,{children:o.role.name}),e.jsx(a,{children:o.workspace.name})]},h))})]})})]})})]})}de.propTypes={row:b.any,onDeleteClick:b.func,onEditClick:b.func,open:b.bool,theme:b.any,deletingUserId:b.string};const ms=()=>{const s=ee(),i=E(t=>t.customization),x=J();K();const{error:m,setError:g}=De(),j=E(t=>t.auth.user),f=(...t)=>x(Z(...t)),c=(...t)=>x(Q(...t)),[p,v]=r.useState(!0),[w,o]=r.useState(!1),[h,y]=r.useState(!1),[C,I]=r.useState({}),[O,R]=r.useState([]),[T,V]=r.useState(""),[z,U]=r.useState(null),{confirm:n}=Te(),l=se(B.getAllUsersByOrganizationId),F=t=>{V(t.target.value)};function xe(t){var d;return((d=t.user.name)==null?void 0:d.toLowerCase().indexOf(T.toLowerCase()))>-1||t.user.email.toLowerCase().indexOf(T.toLowerCase())>-1}const ue=()=>{I({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Send Invite",data:null}),o(!0)},he=t=>{t.status.toUpperCase()==="INVITED"?me(t):je(t)},me=t=>{I({type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Update Invite",data:t}),o(!0)},je=t=>{I({type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Save",data:t}),y(!0)},fe=async t=>{const d={title:"Delete",description:`Remove ${t.name??t.email} from organization?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await n(d))try{U(t.id),(await B.deleteOrganizationUser(j.activeOrganizationId,t.id)).data&&(f({message:"User removed from organization successfully",options:{key:new Date().getTime()+Math.random(),variant:"success",action:_=>e.jsx(M,{style:{color:"white"},onClick:()=>c(_),children:e.jsx(L,{})})}}),W())}catch(N){f({message:`Failed to delete User: ${typeof N.response.data=="object"?N.response.data.message:N.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:_=>e.jsx(M,{style:{color:"white"},onClick:()=>c(_),children:e.jsx(L,{})})}})}finally{U(null)}},W=()=>{o(!1),y(!1),l.request(j.activeOrganizationId)};return r.useEffect(()=>{l.request(j.activeOrganizationId)},[]),r.useEffect(()=>{v(l.loading)},[l.loading]),r.useEffect(()=>{l.error&&g(l.error)},[l.error,g]),r.useEffect(()=>{if(l.data){const t=l.data||[],d=t.find(Y=>Y.isOrgOwner===!0);d&&(t.splice(t.indexOf(d),1),t.unshift(d)),R(t)}},[l.data]),e.jsxs(e.Fragment,{children:[e.jsx(Ue,{children:m?e.jsx(Ne,{error:m}):e.jsxs(G,{flexDirection:"column",sx:{gap:3},children:[e.jsx(ze,{onSearchChange:F,search:!0,searchPlaceholder:"Search Users",title:"User Management",children:e.jsx(Se,{permissionId:"workspace:add-user,users:manage",variant:"contained",sx:{borderRadius:2,height:"100%"},onClick:ue,startIcon:e.jsx(Me,{}),id:"btn_createUser",children:"Invite User"})}),!p&&O.length===0?e.jsxs(G,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(D,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:$e,alt:"users_emptySVG"})}),e.jsx("div",{children:"No Users Yet"})]}):e.jsx(e.Fragment,{children:e.jsx(G,{flexDirection:"row",children:e.jsx(D,{sx:{py:2,height:"auto",width:"100%"},children:e.jsx(te,{style:{display:"flex",flexDirection:"row"},sx:{border:1,borderColor:s.palette.grey[900]+25,borderRadius:2},component:ae,children:e.jsxs(re,{sx:{minWidth:650},"aria-label":"users table",children:[e.jsx(ne,{sx:{backgroundColor:i.isDarkMode?s.palette.common.black:s.palette.grey[100],height:56},children:e.jsxs(q,{children:[e.jsx(a,{children:" "}),e.jsx(a,{children:"Email/Name"}),e.jsx(a,{children:"Assigned Roles"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Last Login"}),e.jsx(a,{children:" "})]})}),e.jsx(ie,{children:p?e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(a,{children:e.jsx(u,{variant:"text"})}),e.jsx(a,{children:e.jsx(u,{variant:"text"})}),e.jsx(a,{children:e.jsx(u,{variant:"text"})}),e.jsx(a,{children:e.jsx(u,{variant:"text"})}),e.jsx(a,{children:e.jsx(u,{variant:"text"})}),e.jsx(a,{children:e.jsx(u,{variant:"text"})})]}),e.jsxs(H,{children:[e.jsx(a,{children:e.jsx(u,{variant:"text"})}),e.jsx(a,{children:e.jsx(u,{variant:"text"})}),e.jsx(a,{children:e.jsx(u,{variant:"text"})}),e.jsx(a,{children:e.jsx(u,{variant:"text"})}),e.jsx(a,{children:e.jsx(u,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:O.filter(xe).map((t,d)=>e.jsx(de,{row:t,onDeleteClick:fe,onEditClick:he,deletingUserId:z},d))})})]})})})})})]})}),w&&e.jsx(Be,{show:w,dialogProps:C,onCancel:()=>o(!1),onConfirm:W}),h&&e.jsx(ce,{show:h,dialogProps:C,onCancel:()=>y(!1),onConfirm:W,setError:g}),e.jsx(oe,{})]})};export{ms as default};
