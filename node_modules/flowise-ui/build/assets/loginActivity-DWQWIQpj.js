import{af as O,b4 as W,r as a,j as e,aB as ce,P as E,a as le,R as de,o as he,p as xe,b as ue,c as ge,M as pe,S as P,B as je,a0 as me,a1 as ye,a2 as fe,a3 as k,a4 as ve,a8 as B,ad as be,U as Se,V as we,W as ke,X as Ce,O as De,Y as Ie,bk as Re,n as F,E as U,J as Me,K as Le}from"./index-B1XR3Coy.js";import{m as Ae}from"./moment-9Y6NtRWJ.js";import{u as Te,C as Ee}from"./ConfirmDialog-Bksga_et.js";import{V as Pe}from"./ViewHeader-jo2V0q71.js";import{E as Be}from"./ErrorBoundary-WOMkE_83.js";import{a as s,S as C}from"./TableStyles-Bn4d_qd9.js";import{e as z}from"./react-datepicker-CbT3l_H_.js";import{F as Fe}from"./FormControl-Cb0ROeST.js";import{I as Ue}from"./InputLabel-HPVYUEFn.js";import{I as ze}from"./IconChevronLeft-Dkfa8829.js";import{I as Ne}from"./IconChevronRight-C7SE20Y-.js";import{I as Oe}from"./IconTrash-BvhWIQ6v.js";import{S as r}from"./Skeleton-BQAmmov-.js";import"./StyledFab-BqTal21_.js";import"./IconSearch-BzBgax5m.js";import"./IconCopy-BBl1XuSo.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var We=O("outline","circle-x","IconCircleX",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M10 10l4 4m0 -4l-4 4",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var qe=O("outline","login","IconLogin",[["path",{d:"M15 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M21 12h-13l3 -3",key:"svg-1"}],["path",{d:"M11 15l-3 -3",key:"svg-2"}]]);const Ve=l=>W.post("/audit/login-activity",l),Ye=l=>W.post("/audit/login-activity/delete",l),N={fetchLoginActivity:Ve,deleteLoginActivity:Ye},$e=["Login Success","Logout Success","Unknown User","Incorrect Credential","User Disabled","No Assigned Workspace","Unknown Activity"],He={PaperProps:{style:{width:160}}},Xe={"& .MuiOutlinedInput-notchedOutline":{borderRadius:2}},D=a.forwardRef(function({value:g,onClick:m},y){return e.jsx(ce,{style:{borderRadius:15,border:"1px solid #e0e0e0"},onClick:m,ref:y,children:g})});D.propTypes={value:E.string,onClick:E.func};const dt=()=>{const l=le(),g=de(t=>t.customization),m=he();xe();const{error:y,setError:I}=ue(),R=(...t)=>m(Me(...t)),M=(...t)=>m(Le(...t)),[q,S]=a.useState(!0),{confirm:V}=Te(),d=ge(N.fetchLoginActivity),[w,Y]=a.useState([]),[p,$]=a.useState([]),[j,H]=a.useState(0),[h,L]=a.useState(1),[X,J]=a.useState(1),[f,K]=a.useState(50),[x,G]=a.useState(new Date(new Date().setMonth(new Date().getMonth()-1))),[u,Q]=a.useState(new Date),[o,v]=a.useState([]),Z=t=>{G(t),b(h,t,u,p)},_=t=>{Q(t),b(h,x,t,p)},ee=t=>{if(t.target.checked){const c=w.map(n=>n.id);v(c);return}v([])},te=(t,c)=>{const n=o.indexOf(c);let i=[];n===-1?i=i.concat(o,c):n===0?i=i.concat(o.slice(1)):n===o.length-1?i=i.concat(o.slice(0,-1)):n>0&&(i=i.concat(o.slice(0,n),o.slice(n+1))),v(i)},b=(t,c,n,i)=>{const T=[];i.length>0&&i.forEach(oe=>{T.push(ie(oe))}),d.request({pageNo:t,startDate:c,endDate:n,activityCodes:T})},A=t=>{S(!0),L(t),b(t,x,u,p)},se=t=>{const{target:{value:c}}=t;let n=typeof c=="string"?c.split(","):c;$(n),b(h,x,u,n)};function ne(t){switch(t){case 0:return"Login Success";case 1:return"Logout Success";case-1:return"Unknown User";case-2:return"Incorrect Credential";case-3:return"User Disabled";case-4:return"No Assigned Workspace";default:return"Unknown Activity"}}function ie(t){switch(t){case"Login Success":return 0;case"Logout Success":return 1;case"Unknown User":return-1;case"Incorrect Credential":return-2;case"User Disabled":return-3;case"No Assigned Workspace":return-4;default:return-99}}const re=async()=>{const t={title:"Delete",description:`Delete ${o.length} ${o.length>1?"records":"record"}? `,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await V(t))try{(await N.deleteLoginActivity({selected:o})).data&&(R({message:o.length+" Login Activity Records Deleted Successfully",options:{key:new Date().getTime()+Math.random(),variant:"success",action:i=>e.jsx(F,{style:{color:"white"},onClick:()=>M(i),children:e.jsx(U,{})})}}),ae())}catch(n){R({message:`Failed to delete records: ${typeof n.response.data=="object"?n.response.data.message:n.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:i=>e.jsx(F,{style:{color:"white"},onClick:()=>M(i),children:e.jsx(U,{})})}})}},ae=()=>{d.request()};return a.useEffect(()=>{d.request({pageNo:1})},[]),a.useEffect(()=>{S(d.loading)},[d.loading]),a.useEffect(()=>{d.error&&I(d.error)},[d.error,I]),a.useEffect(()=>{if(d.data){const t=d.data;H(t.count),S(!1),L(t.currentPage),J(t.currentPage*t.pageSize-(t.pageSize-1)),K(t.currentPage*t.pageSize>t.count?t.count:t.currentPage*t.pageSize),Y(t.data),v([])}},[d.data]),e.jsxs(e.Fragment,{children:[e.jsx(pe,{children:y?e.jsx(Be,{error:y}):e.jsxs(P,{flexDirection:"column",sx:{gap:3},children:[e.jsx(Pe,{search:!1,title:"Login Activity"}),e.jsx(P,{flexDirection:"row",children:e.jsxs(je,{sx:{p:2,height:"auto",width:"100%"},children:[e.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",overflow:"hidden",marginBottom:10},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs("div",{style:{marginRight:10},children:[e.jsx("b",{style:{marginRight:10},children:"From: "}),e.jsx(z,{selected:x,onChange:t=>Z(t),selectsStart:!0,startDate:x,endDate:u,customInput:e.jsx(D,{})})]}),e.jsxs("div",{style:{marginRight:10},children:[e.jsx("b",{style:{marginRight:10},children:"To: "}),e.jsx(z,{selected:u,onChange:t=>_(t),selectsEnd:!0,startDate:x,endDate:u,minDate:x,maxDate:new Date,customInput:e.jsx(D,{})})]}),e.jsx("div",{children:e.jsxs(Fe,{sx:{borderRadius:2,display:"flex",flexDirection:"column",justifyContent:"end",minWidth:300,maxWidth:300},children:[e.jsx(Ue,{size:"small",id:"type-label",children:"Filter By"}),e.jsx(me,{size:"small",labelId:"type-label",multiple:!0,value:p,onChange:se,id:"type-checkbox",input:e.jsx(ye,{label:"Badge"}),renderValue:t=>t.join(", "),MenuProps:He,sx:Xe,children:$e.map(t=>e.jsxs(fe,{value:t,sx:{display:"flex",alignItems:"center",gap:1,p:1},children:[e.jsx(k,{checked:p.indexOf(t)>-1,sx:{p:0}}),e.jsx(ve,{primary:t})]},t))})]})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs("div",{style:{marginRight:10,display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(B,{size:"small",onClick:()=>A(h-1),style:{marginRight:10},variant:"outlined",disabled:h===1,children:e.jsx(ze,{color:g.isDarkMode?h===1?"#616161":"white":h===1?"#e0e0e0":"black"})}),"Showing ",Math.min(X,j),"-",f," of ",j," Records",e.jsx(B,{size:"small",onClick:()=>A(h+1),style:{marginLeft:10},variant:"outlined",disabled:f>=j,children:e.jsx(Ne,{color:g.isDarkMode?f>=j?"#616161":"white":f>=j?"#e0e0e0":"black"})})]}),e.jsx(be,{permissionId:"loginActivity:delete",sx:{mt:1,mb:2},variant:"outlined",disabled:o.length===0,onClick:re,color:"error",startIcon:e.jsx(Oe,{}),children:"Delete Selected"})]})]}),e.jsx(Se,{style:{display:"flex",flexDirection:"row"},sx:{border:1,borderColor:l.palette.grey[900]+25,borderRadius:2},component:we,children:e.jsxs(ke,{sx:{minWidth:650},"aria-label":"users table",children:[e.jsx(Ce,{sx:{backgroundColor:g.isDarkMode?l.palette.common.black:l.palette.grey[100],height:40},children:e.jsxs(De,{children:[e.jsx(s,{style:{width:"5%"},children:e.jsx(k,{color:"primary",checked:o.length===(w||[]).length,onChange:ee})}),e.jsx(s,{children:"Activity"}),e.jsx(s,{children:"User"}),e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Method"}),e.jsx(s,{children:"Message"})]})}),e.jsx(Ie,{children:q?e.jsxs(e.Fragment,{children:[e.jsxs(C,{children:[e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})})]}),e.jsxs(C,{children:[e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:w.map((t,c)=>e.jsxs(C,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(s,{component:"th",scope:"row",style:{width:"5%"},children:e.jsx(k,{color:"primary",checked:o.indexOf(t.id)!==-1,onChange:n=>te(n,t.id)})}),e.jsx(s,{component:"th",scope:"row",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"left"},children:[e.jsxs("div",{style:{width:25,height:25,borderRadius:"50%",marginRight:10},children:[t.activityCode===0&&e.jsx(qe,{style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"contain",color:l.palette.success.dark}}),t.activityCode===1&&e.jsx(Re,{style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"contain",color:l.palette.secondary.dark}}),t.activityCode<0&&e.jsx(We,{style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"contain",color:l.palette.error.dark}})]}),e.jsx("div",{children:ne(t.activityCode)})]})}),e.jsx(s,{children:t.username}),e.jsx(s,{children:Ae(t.attemptedDateTime).format("MMMM Do, YYYY, HH:mm")}),e.jsx(s,{children:t.loginMode?t.loginMode:"Email/Password"}),e.jsx(s,{children:t.message})]},c))})})]})})]})})]})}),e.jsx(Ee,{})]})};export{dt as default};
