import{t as _,M as Q,P as S,a as M,R as Z,j as e,B as f,aj as q,l as D,ax as pe,ay as K,L as ge,N as Y,O as ee,r as i,U as me,V as ue,W as je,X as fe,Y as be,u as ye,c as Se,b as Ce,d as ve,S as X,T as J,I as we,e as ke,az as De,g as Te}from"./index-B1XR3Coy.js";import{E as Ie}from"./ErrorBoundary-WOMkE_83.js";import{D as Re,T as Le}from"./TablePagination-Dfhg7VLc.js";import{D as te,A as Be}from"./AddDocStoreDialog-BZe2F3X3.js";import{I as ze}from"./IconLanguage-Dreb5nKM.js";import{I as Ae}from"./IconScissors-B1WA5G_Y.js";import{V as Oe}from"./ViewHeader-jo2V0q71.js";import{d as Pe}from"./documentstore-GQ_lrBF1.js";import{T as We}from"./TableSortLabel-DZVq0i6E.js";import{S as l}from"./Skeleton-BQAmmov-.js";import{T as _e}from"./ToggleButtonGroup-D1WH89Fe.js";import{I as Me}from"./IconLayoutGrid-DAeG3wjO.js";import{I as Ee}from"./IconPlus-DpyX5kZB.js";import"./IconCopy-BBl1XuSo.js";import"./FormControl-Cb0ROeST.js";import"./Pagination-DyTukyc1.js";import"./LastPage-CMvObEkB.js";import"./ConfirmDialog-Bksga_et.js";import"./StyledFab-BqTal21_.js";import"./IconSearch-BzBgax5m.js";const Ne=_(Q)(({theme:r})=>({background:r.palette.card.main,color:r.darkTextPrimary,overflow:"auto",position:"relative",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)",cursor:"pointer","&:hover":{background:r.palette.card.hover,boxShadow:"0 2px 14px 0 rgb(32 40 45 / 20%)"},height:"100%",minHeight:"160px",maxHeight:"300px",width:"100%",overflowWrap:"break-word",whiteSpace:"pre-line"})),se=({data:r,images:x,onClick:h})=>{var u,j;const a=M(),d=Z(p=>p.customization);return e.jsx(Ne,{content:!1,onClick:h,sx:{border:1,borderColor:a.palette.grey[900]+25,borderRadius:2},children:e.jsx(f,{sx:{height:"100%",p:2.25},children:e.jsxs(q,{container:!0,justifyContent:"space-between",direction:"column",sx:{height:"100%"},gap:2,children:[e.jsxs(f,{display:"flex",flexDirection:"column",sx:{flex:1,width:"100%"},children:[e.jsxs("div",{style:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",overflow:"hidden"},children:[e.jsx(D,{sx:{display:"-webkit-box",fontSize:"1.25rem",fontWeight:500,WebkitLineClamp:2,WebkitBoxOrient:"vertical",textOverflow:"ellipsis",overflow:"hidden",flex:1,mr:1},children:r.name}),e.jsx(te,{status:r.status})]}),e.jsx("span",{style:{display:"-webkit-box",marginTop:10,overflowWrap:"break-word",WebkitLineClamp:2,WebkitBoxOrient:"vertical",textOverflow:"ellipsis",overflow:"hidden"},children:r.description||" "})]}),e.jsxs(q,{container:!0,columnGap:2,rowGap:1,children:[e.jsxs("div",{style:{paddingLeft:"7px",paddingRight:"7px",paddingTop:"3px",paddingBottom:"3px",fontSize:"11px",width:"max-content",borderRadius:"25px",boxShadow:d.isDarkMode?"0 2px 14px 0 rgb(255 255 255 / 20%)":"0 2px 14px 0 rgb(32 40 45 / 20%)",display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(pe,{style:{marginRight:5},size:15}),((u=r.whereUsed)==null?void 0:u.length)??0," ",((j=r.whereUsed)==null?void 0:j.length)<=1?"flow":"flows"]}),e.jsxs("div",{style:{paddingLeft:"7px",paddingRight:"7px",paddingTop:"3px",paddingBottom:"3px",fontSize:"11px",width:"max-content",borderRadius:"25px",boxShadow:d.isDarkMode?"0 2px 14px 0 rgb(255 255 255 / 20%)":"0 2px 14px 0 rgb(32 40 45 / 20%)",display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(ze,{style:{marginRight:5},size:15}),K(r.totalChars??0)," chars"]}),e.jsxs("div",{style:{paddingLeft:"7px",paddingRight:"7px",paddingTop:"3px",paddingBottom:"3px",fontSize:"11px",width:"max-content",borderRadius:"25px",boxShadow:d.isDarkMode?"0 2px 14px 0 rgb(255 255 255 / 20%)":"0 2px 14px 0 rgb(32 40 45 / 20%)",display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Ae,{style:{marginRight:5},size:15}),K(r.totalChunks??0)," chunks"]})]}),x&&x.length>0&&e.jsxs(f,{sx:{display:"flex",alignItems:"center",justifyContent:"start",gap:1},children:[x.slice(0,x.length>3?3:x.length).map(p=>e.jsx(f,{sx:{width:30,height:30,borderRadius:"50%",backgroundColor:d.isDarkMode?a.palette.common.white:a.palette.grey[300]+75},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:5,objectFit:"contain"},alt:"",src:p})},p)),x.length>3&&e.jsxs(D,{sx:{alignItems:"center",display:"flex",fontSize:".9rem",fontWeight:200},children:["+ ",x.length-3," More"]})]})]})})})};se.propTypes={data:S.object,images:S.array,onClick:S.func};const Fe="/assets/doc_store_empty-B0My5Ox8.svg",s=_(ge)(({theme:r})=>({borderColor:r.palette.grey[900]+25,[`&.${Y.head}`]:{color:r.palette.grey[900]},[`&.${Y.body}`]:{fontSize:14,height:64}})),W=_(ee)(()=>({"&:last-child td, &:last-child th":{border:0}})),E=({data:r,isLoading:x,onRowClick:h,images:a})=>{const d=M(),u=Z(t=>t.customization),j="doc_store_order",p="doc_store_orderBy",[C,B]=i.useState(localStorage.getItem(j)||"desc"),[v,w]=i.useState(localStorage.getItem(p)||"name"),z=t=>{const g=v===t&&C==="asc"?"desc":"asc";B(g),w(t),localStorage.setItem(j,g),localStorage.setItem(p,t)},A=r?[...r].sort((t,b)=>v==="name"?C==="asc"?(t.name||"").localeCompare(b.name||""):(b.name||"").localeCompare(t.name||""):0):[];return e.jsx(e.Fragment,{children:e.jsx(me,{sx:{border:1,borderColor:d.palette.grey[900]+25,borderRadius:2},component:ue,children:e.jsxs(je,{sx:{minWidth:650},size:"small","aria-label":"document_store_table",children:[e.jsx(fe,{sx:{backgroundColor:u.isDarkMode?d.palette.common.black:d.palette.grey[100],height:56},children:e.jsxs(ee,{children:[e.jsx(s,{children:"Â "}),e.jsx(s,{children:e.jsx(We,{active:v==="name",direction:C,onClick:()=>z("name"),children:"Name"})}),e.jsx(s,{children:"Description"}),e.jsx(s,{children:"Connected flows"}),e.jsx(s,{children:"Total characters"}),e.jsx(s,{children:"Total chunks"}),e.jsx(s,{children:"Loader Types"})]})}),e.jsx(be,{children:x?e.jsxs(e.Fragment,{children:[e.jsxs(W,{children:[e.jsx(s,{children:e.jsx(l,{variant:"text"})}),e.jsx(s,{children:e.jsx(l,{variant:"text"})}),e.jsx(s,{children:e.jsx(l,{variant:"text"})}),e.jsx(s,{children:e.jsx(l,{variant:"text"})}),e.jsx(s,{children:e.jsx(l,{variant:"text"})}),e.jsx(s,{children:e.jsx(l,{variant:"text"})}),e.jsx(s,{children:e.jsx(l,{variant:"text"})})]}),e.jsxs(W,{children:[e.jsx(s,{children:e.jsx(l,{variant:"text"})}),e.jsx(s,{children:e.jsx(l,{variant:"text"})}),e.jsx(s,{children:e.jsx(l,{variant:"text"})}),e.jsx(s,{children:e.jsx(l,{variant:"text"})}),e.jsx(s,{children:e.jsx(l,{variant:"text"})}),e.jsx(s,{children:e.jsx(l,{variant:"text"})}),e.jsx(s,{children:e.jsx(l,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:A.map((t,b)=>{var g;return e.jsxs(W,{onClick:()=>h(t),hover:!0,sx:{cursor:"pointer","&:last-child td, &:last-child th":{border:0}},children:[e.jsx(s,{children:e.jsx(te,{isTableView:!0,status:t.status})}),e.jsx(s,{children:e.jsx(D,{sx:{display:"-webkit-box",WebkitLineClamp:5,WebkitBoxOrient:"vertical",textOverflow:"ellipsis",overflow:"hidden"},children:t.name})}),e.jsx(s,{children:e.jsx(D,{sx:{display:"-webkit-box",WebkitLineClamp:5,WebkitBoxOrient:"vertical",textOverflow:"ellipsis",overflow:"hidden"},children:t==null?void 0:t.description})}),e.jsx(s,{children:((g=t.whereUsed)==null?void 0:g.length)??0}),e.jsx(s,{children:t.totalChars}),e.jsx(s,{children:t.totalChunks}),e.jsx(s,{children:a&&a[t.id]&&e.jsxs(f,{sx:{display:"flex",alignItems:"center",justifyContent:"start",gap:1},children:[a[t.id].slice(0,a[t.id].length>3?3:a[t.id].length).map(T=>e.jsx(f,{sx:{width:30,height:30,borderRadius:"50%",backgroundColor:u.isDarkMode?d.palette.common.white:d.palette.grey[300]+75},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:5,objectFit:"contain"},alt:"",src:T})},T)),(a==null?void 0:a.length)>3&&e.jsxs(D,{sx:{alignItems:"center",display:"flex",fontSize:".9rem",fontWeight:200},children:["+ ",a.length-3," More"]})]})})]},b)})})})]})})})};E.propTypes={data:S.array,isLoading:S.bool,images:S.object,onRowClick:S.func};E.displayName="DocumentStoreTable";const lt=()=>{var G,V;const r=M(),x=ye(),h=Se(Pe.getAllDocumentStores),{error:a}=Ce(),[d,u]=i.useState(!0),[j,p]=i.useState({}),[C,B]=i.useState(""),[v,w]=i.useState(!1),[z,A]=i.useState({}),[t,b]=i.useState([]),[g,T]=i.useState(localStorage.getItem("docStoreDisplayStyle")||"card"),re=(o,c)=>{c!==null&&(localStorage.setItem("docStoreDisplayStyle",c),T(c))};function N(o){return o.name.toLowerCase().indexOf(C.toLowerCase())>-1||o.description.toLowerCase().indexOf(C.toLowerCase())>-1}const oe=o=>{B(o.target.value)},F=o=>{x("/document-stores/"+o)},ae=()=>{A({title:"Add New Document Store",type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add"}),w(!0)},ie=()=>{w(!1),O(I,R)};i.useEffect(()=>{O(I,R)},[]);const[I,ne]=i.useState(1),[R,le]=i.useState(Re),[ce,de]=i.useState(0),xe=(o,c)=>{ne(o),le(c),O(o,c)},O=(o,c)=>{u(!0);const n={page:o||I,limit:c||R};h.request(n)};i.useEffect(()=>{var o,c;if(h.data)try{const{data:n,total:he}=h.data;if(!Array.isArray(n))return;const L={};for(let m=0;m<n.length;m+=1){const y=n[m].loaders??[];let U=0,H=0;L[n[m].id]=[];for(let k=0;k<y.length;k+=1){const $=`${ve}/api/v1/node-icon/${y[k].loaderId}`;L[n[m].id].includes($)||L[n[m].id].push($),U+=((o=y[k])==null?void 0:o.totalChunks)??0,H+=((c=y[k])==null?void 0:c.totalChars)??0}n[m].totalDocs=(y==null?void 0:y.length)??0,n[m].totalChunks=U,n[m].totalChars=H}b(n),de(he),p(L)}catch(n){console.error(n)}},[h.data]),i.useEffect(()=>{u(h.loading)},[h.loading]);const P=t&&t.length>0;return e.jsxs(Q,{children:[a?e.jsx(Ie,{error:a}):e.jsxs(X,{flexDirection:"column",sx:{gap:3},children:[e.jsxs(Oe,{onSearchChange:oe,search:P,searchPlaceholder:"Search Name",title:"Document Store",description:"Store and upsert documents for LLM retrieval (RAG)",children:[P&&e.jsxs(_e,{sx:{borderRadius:2,maxHeight:40},value:g,color:"primary",exclusive:!0,onChange:re,children:[e.jsx(J,{sx:{borderColor:r.palette.grey[900]+25,borderRadius:2,color:(G=r==null?void 0:r.customization)!=null&&G.isDarkMode?"white":"inherit"},variant:"contained",value:"card",title:"Card View",children:e.jsx(Me,{})}),e.jsx(J,{sx:{borderColor:r.palette.grey[900]+25,borderRadius:2,color:(V=r==null?void 0:r.customization)!=null&&V.isDarkMode?"white":"inherit"},variant:"contained",value:"list",title:"List View",children:e.jsx(we,{})})]}),e.jsx(ke,{permissionId:"documentStores:create",variant:"contained",sx:{borderRadius:2,height:"100%"},onClick:ae,startIcon:e.jsx(Ee,{}),id:"btn_createVariable",children:"Add New"})]}),P?e.jsxs(De.Fragment,{children:[!g||g==="card"?e.jsx(f,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:Te,children:t==null?void 0:t.filter(N).map((o,c)=>e.jsx(se,{images:j[o.id],data:o,onClick:()=>F(o.id)},c))}):e.jsx(E,{isLoading:d,data:t==null?void 0:t.filter(N),images:j,onRowClick:o=>F(o.id)}),e.jsx(Le,{currentPage:I,limit:R,total:ce,onChange:xe})]}):e.jsxs(X,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(f,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:Fe,alt:"doc_store_empty"})}),e.jsx("div",{children:"No Document Stores Created Yet"})]})]}),v&&e.jsx(Be,{dialogProps:z,show:v,onCancel:()=>w(!1),onConfirm:ie})]})};export{lt as default};
