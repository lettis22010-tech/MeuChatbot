import{r as i,j as t,P as Dt,u as kt,a as Pt,R as ke,c as G,ak as Tt,o as Ot,p as _t,d as me,al as Pe,M as Bt,S as B,B as g,aj as he,am as Rt,l as S,an as Y,ao as X,a6 as fe,ap as Et,aq as x,ar as Q,a8 as ge,n as w,a1 as Te,E as v,as as Z,J as $t,K as Nt}from"./index-B1XR3Coy.js";import{i as Ht}from"./index-4nfsl_Py.js";import{u as Lt,C as Ft}from"./ConfirmDialog-Bksga_et.js";import{B as qt}from"./BackdropLoader-C982mQas.js";import{I as Oe,D as _e,A as Vt}from"./DocStoreInputHandler-9-EYgHTZ.js";import{D as Be}from"./Dropdown-BH_BuIwh.js";import{S as Gt}from"./StyledFab-BqTal21_.js";import{E as zt}from"./ErrorBoundary-WOMkE_83.js";import{T as ee}from"./TooltipWithParser-C72LCUcD.js";import{M as Wt}from"./MultiDropdown-OnTaU3K-.js";import{A as Ut,S as Jt,V as Kt,a as Yt,C as Xt}from"./index-BmqHKIDU.js";import{E as Qt}from"./ExpandTextDialog-Sszv9N4G.js";import{S as Zt}from"./Switch-BtbcRzr_.js";import{a as L}from"./assistants-C-o7l-z6.js";import{c as te}from"./chatflows-ITLPd47E.js";import{n as Re}from"./nodes-D-x6LTqi.js";import{d as eo}from"./documentstore-GQ_lrBF1.js";import{a as to}from"./IconSearch-BzBgax5m.js";import{I as oo}from"./ToolDialog-hiXiaWJY.js";import{I as ao}from"./IconDeviceFloppy-CcMo-Sl3.js";import{I as Ee}from"./IconTrash-BvhWIQ6v.js";import{I as so}from"./IconArrowsMaximize-BrsSDZNx.js";import"./CredentialInputHandler-NSWgGX5U.js";import"./CredentialListDialog-ooDI7A-3.js";import"./Input-C2v4FwXn.js";import"./ListItem-C9nlU6HX.js";import"./FormControl-Cb0ROeST.js";import"./main-BBsr8sqY.js";import"./IconAlertTriangle-Bdlxpe5D.js";import"./InputAdornment-D6_duzKN.js";import"./Autocomplete-2B99MXTa.js";import"./Close-CA_iFeNy.js";import"./TextField-BEeUeVUl.js";import"./InputLabel-HPVYUEFn.js";import"./Tooltip-9ICsuaYn.js";import"./Delete-CvnCkEIf.js";import"./IconPlus-DpyX5kZB.js";import"./Grid-DtMOPoeK.js";import"./toPropertyKey-hKuLU48H.js";import"./createStyled-BzRwilhm.js";import"./Skeleton-BQAmmov-.js";import"./KeyboardArrowRight-KQTKBFVE.js";import"./LastPage-CMvObEkB.js";import"./GridActionsCellItem-C4fgcfe6.js";import"./File-B2PWlg1I.js";import"./CodeEditor-BjDzi2Vy.js";import"./index-DhL3T6x0.js";import"./suggestionOption-CTRD7oqB.js";import"./TabPanel-C2EL9Kp7.js";import"./ExpandMore-BP5oMSwT.js";import"./MemoizedReactMarkdown-CNH2mkE4.js";import"./index-D--Rb2MU.js";import"./IconRefresh-B2aTlEaU.js";import"./AssistantDialog-BG0DIOgO.js";import"./v4-D8aEg3BZ.js";import"./Stepper-CvQjJ8b9.js";import"./LoadingButton-BHZSG_sF.js";import"./IconLanguage-Dreb5nKM.js";import"./string-3NetaFjT.js";import"./IconBulb-CwCq2_I0.js";import"./IconCopy-BBl1XuSo.js";import"./_baseAssignValue-D7-4vid5.js";import"./Tabs-DwCJa_eq.js";import"./apikey-DdsPjp8B.js";import"./config-CuKonRqx.js";import"./Table-CcAGPqUI.js";import"./IconExclamationCircle-BsAK4qbB.js";import"./react-datepicker-CbT3l_H_.js";import"./StatsCard-Dg5IN5gY.js";import"./Pagination-DyTukyc1.js";import"./CardMedia-DxratGiC.js";import"./SpeechToText-BX3-pddK.js";import"./ExportAsTemplateDialog-CN3tapJC.js";const $e={nodes:[{id:"bufferMemory_0",data:{id:"bufferMemory_0",label:"Buffer Memory",version:2,name:"bufferMemory",type:"BufferMemory",baseClasses:["BufferMemory","BaseChatMemory","BaseMemory"],category:"Memory",description:"Retrieve chat messages stored in database",inputParams:[{label:"Session Id",name:"sessionId",type:"string",description:'If not specified, a random id will be used. Learn <a target="_blank" href="https://docs.flowiseai.com/memory#ui-and-embedded-chat">more</a>',default:"",additionalParams:!0,optional:!0,id:"bufferMemory_0-input-sessionId-string"},{label:"Memory Key",name:"memoryKey",type:"string",default:"chat_history",additionalParams:!0,id:"bufferMemory_0-input-memoryKey-string"}],inputAnchors:[],inputs:{sessionId:"",memoryKey:"chat_history"},outputAnchors:[{id:"bufferMemory_0-output-bufferMemory-BufferMemory|BaseChatMemory|BaseMemory",name:"bufferMemory",label:"BufferMemory",description:"Retrieve chat messages stored in database",type:"BufferMemory | BaseChatMemory | BaseMemory"}],outputs:{}}},{id:"chatOpenAI_0",data:{id:"chatOpenAI_0",label:"ChatOpenAI",version:8,name:"chatOpenAI",type:"ChatOpenAI",baseClasses:["ChatOpenAI","BaseChatModel","BaseLanguageModel","Runnable"],category:"Chat Models",description:"Wrapper around OpenAI large language models that use the Chat endpoint",inputParams:[{label:"Connect Credential",name:"credential",type:"credential",credentialNames:["openAIApi"],id:"chatOpenAI_0-input-credential-credential"},{label:"Model Name",name:"modelName",type:"asyncOptions",loadMethod:"listModels",default:"gpt-4o-mini",id:"chatOpenAI_0-input-modelName-asyncOptions"},{label:"Temperature",name:"temperature",type:"number",step:.1,default:.9,optional:!0,id:"chatOpenAI_0-input-temperature-number"},{label:"Streaming",name:"streaming",type:"boolean",default:!0,optional:!0,additionalParams:!0,id:"chatOpenAI_0-input-streaming-boolean"},{label:"Max Tokens",name:"maxTokens",type:"number",step:1,optional:!0,additionalParams:!0,id:"chatOpenAI_0-input-maxTokens-number"},{label:"Top Probability",name:"topP",type:"number",step:.1,optional:!0,additionalParams:!0,id:"chatOpenAI_0-input-topP-number"},{label:"Frequency Penalty",name:"frequencyPenalty",type:"number",step:.1,optional:!0,additionalParams:!0,id:"chatOpenAI_0-input-frequencyPenalty-number"},{label:"Presence Penalty",name:"presencePenalty",type:"number",step:.1,optional:!0,additionalParams:!0,id:"chatOpenAI_0-input-presencePenalty-number"},{label:"Timeout",name:"timeout",type:"number",step:1,optional:!0,additionalParams:!0,id:"chatOpenAI_0-input-timeout-number"},{label:"BasePath",name:"basepath",type:"string",optional:!0,additionalParams:!0,id:"chatOpenAI_0-input-basepath-string"},{label:"Proxy Url",name:"proxyUrl",type:"string",optional:!0,additionalParams:!0,id:"chatOpenAI_0-input-proxyUrl-string"},{label:"Stop Sequence",name:"stopSequence",type:"string",rows:4,optional:!0,description:"List of stop words to use when generating. Use comma to separate multiple stop words.",additionalParams:!0,id:"chatOpenAI_0-input-stopSequence-string"},{label:"BaseOptions",name:"baseOptions",type:"json",optional:!0,additionalParams:!0,id:"chatOpenAI_0-input-baseOptions-json"},{label:"Allow Image Uploads",name:"allowImageUploads",type:"boolean",description:'Allow image input. Refer to the <a href="https://docs.flowiseai.com/using-flowise/uploads#image" target="_blank">docs</a> for more details.',default:!1,optional:!0,id:"chatOpenAI_0-input-allowImageUploads-boolean"},{label:"Image Resolution",description:"This parameter controls the resolution in which the model views the image.",name:"imageResolution",type:"options",options:[{label:"Low",name:"low"},{label:"High",name:"high"},{label:"Auto",name:"auto"}],default:"low",optional:!1,additionalParams:!0,id:"chatOpenAI_0-input-imageResolution-options"}],inputAnchors:[{label:"Cache",name:"cache",type:"BaseCache",optional:!0,id:"chatOpenAI_0-input-cache-BaseCache"}],inputs:{cache:"",modelName:"gpt-4o-mini",temperature:.9,streaming:!0,maxTokens:"",topP:"",frequencyPenalty:"",presencePenalty:"",timeout:"",basepath:"",proxyUrl:"",stopSequence:"",baseOptions:"",allowImageUploads:"",imageResolution:"low"},outputAnchors:[{id:"chatOpenAI_0-output-chatOpenAI-ChatOpenAI|BaseChatModel|BaseLanguageModel|Runnable",name:"chatOpenAI",label:"ChatOpenAI",description:"Wrapper around OpenAI large language models that use the Chat endpoint",type:"ChatOpenAI | BaseChatModel | BaseLanguageModel | Runnable"}],outputs:{}}},{id:"toolAgent_0",data:{id:"toolAgent_0",label:"Tool Agent",version:2,name:"toolAgent",type:"AgentExecutor",baseClasses:["AgentExecutor","BaseChain","Runnable"],category:"Agents",description:"Agent that uses Function Calling to pick the tools and args to call",inputParams:[{label:"System Message",name:"systemMessage",type:"string",default:"You are a helpful AI assistant.",description:"If Chat Prompt Template is provided, this will be ignored",rows:4,optional:!0,additionalParams:!0,id:"toolAgent_0-input-systemMessage-string"},{label:"Max Iterations",name:"maxIterations",type:"number",optional:!0,additionalParams:!0,id:"toolAgent_0-input-maxIterations-number"}],inputAnchors:[{label:"Tools",name:"tools",type:"Tool",list:!0,id:"toolAgent_0-input-tools-Tool"},{label:"Memory",name:"memory",type:"BaseChatMemory",id:"toolAgent_0-input-memory-BaseChatMemory"},{label:"Tool Calling Chat Model",name:"model",type:"BaseChatModel",description:"Only compatible with models that are capable of function calling: ChatOpenAI, ChatMistral, ChatAnthropic, ChatGoogleGenerativeAI, ChatVertexAI, GroqChat",id:"toolAgent_0-input-model-BaseChatModel"},{label:"Chat Prompt Template",name:"chatPromptTemplate",type:"ChatPromptTemplate",description:"Override existing prompt with Chat Prompt Template. Human Message must includes {input} variable",optional:!0,id:"toolAgent_0-input-chatPromptTemplate-ChatPromptTemplate"},{label:"Input Moderation",description:"Detect text that could generate harmful output and prevent it from being sent to the language model",name:"inputModeration",type:"Moderation",optional:!0,list:!0,id:"toolAgent_0-input-inputModeration-Moderation"}],inputs:{tools:[],memory:"{{bufferMemory_0.data.instance}}",model:"{{chatOpenAI_0.data.instance}}",chatPromptTemplate:"",systemMessage:"You are helpful assistant",inputModeration:"",maxIterations:""},outputAnchors:[{id:"toolAgent_0-output-toolAgent-AgentExecutor|BaseChain|Runnable",name:"toolAgent",label:"AgentExecutor",description:"Agent that uses Function Calling to pick the tools and args to call",type:"AgentExecutor | BaseChain | Runnable"}],outputs:{}}}],edges:[{source:"bufferMemory_0",sourceHandle:"bufferMemory_0-output-bufferMemory-BufferMemory|BaseChatMemory|BaseMemory",target:"toolAgent_0",targetHandle:"toolAgent_0-input-memory-BaseChatMemory",type:"buttonedge",id:"bufferMemory_0-bufferMemory_0-output-bufferMemory-BufferMemory|BaseChatMemory|BaseMemory-toolAgent_0-toolAgent_0-input-memory-BaseChatMemory"},{source:"chatOpenAI_0",sourceHandle:"chatOpenAI_0-output-chatOpenAI-ChatOpenAI|BaseChatModel|BaseLanguageModel|Runnable",target:"toolAgent_0",targetHandle:"toolAgent_0-input-model-BaseChatModel",type:"buttonedge",id:"chatOpenAI_0-chatOpenAI_0-output-chatOpenAI-ChatOpenAI|BaseChatModel|BaseLanguageModel|Runnable-toolAgent_0-toolAgent_0-input-model-BaseChatModel"}]},oe=i.memo(({...R})=>t.jsx("div",{children:t.jsx(Ht,{...R})}),(R,l)=>R.chatflow===l.chatflow);oe.displayName="MemoizedFullPageChat";oe.propTypes={chatflow:Dt.object};const va=()=>{const R=kt(),l=Pt(),ae=i.useRef(),I=ke(e=>e.canvas),ye=ke(e=>e.customization),M=G(L.getSpecificAssistant),j=G(L.getChatModels),D=G(L.getDocStores),F=G(L.getTools),k=G(te.getSpecificChatflow),{id:E}=Tt(),[Ne,He]=i.useState([]),[Le,Fe]=i.useState([]),[c,z]=i.useState({}),[$,qe]=i.useState({}),[W,U]=i.useState("You are helpful assistant"),[b,be]=i.useState(),[se,Ve]=i.useState([]),[u,P]=i.useState([]),[Ge,ze]=i.useState([]),[We,Ue]=i.useState([]),[f,N]=i.useState([]),[xe,we]=i.useState(!1),[Je,Ke]=i.useState({}),[Ye,Ce]=i.useState(!1),[Xe,Qe]=i.useState({}),[Ze,Ae]=i.useState(!1),[et,tt]=i.useState({}),[ot,je]=i.useState(!1),[at,st]=i.useState({}),[ne,re]=i.useState(!1),[nt,ie]=i.useState(!1),[rt,it]=i.useState({}),[lt,le]=i.useState(!1),[ct,dt]=i.useState({}),[Se,H]=i.useState(!1),[q,ce]=i.useState(!0),[ve,J]=i.useState(null),K=Ot(),{confirm:pt}=Lt();_t();const T=(...e)=>K($t(...e)),O=(...e)=>K(Nt(...e)),ut=({inputParam:e,newValue:a})=>{z(o=>{const s={...o};return s.inputs[e.name]=a,s.inputParams=Z(s),s})},mt=e=>({inputParam:a,newValue:o})=>{N(s=>{const r=[...s],n={...r[e]};return n.inputs[a.name]=o,n.inputParams=Z(n),r[e]=n,r})},de=()=>{T({message:"Please fill in all mandatory fields.",options:{key:new Date().getTime()+Math.random(),variant:"warning",action:e=>t.jsx(w,{style:{color:"white"},onClick:()=>O(e),children:t.jsx(v,{})})}})},pe=()=>{let e=!0;const a=(c.inputParams??[]).filter(o=>!o.hidden);for(const o of a)if(!o.optional&&(!c.inputs[o.name]||!c.credential)){if(o.type==="credential"&&!c.credential){e=!1;break}else if(o.type!=="credential"&&!c.inputs[o.name]){e=!1;break}}if(f.length>0)for(let o=0;o<f.length;o++){const s=f[o],r=(s.inputParams??[]).filter(n=>!n.hidden);for(const n of r)if(!n.optional&&(!s.inputs[n.name]||!s.credential)){if(n.type==="credential"&&!s.credential){e=!1;break}else if(n.type!=="credential"&&!s.inputs[n.name]){e=!1;break}}}return e},ht=()=>{let e=!0;if((!c||!c.name)&&(e=!1),e=pe(),u.length>0){for(let a=0;a<u.length;a++)if(!u[a].description){e=!1;break}}return e||de(),e},Ie=async()=>{if(ht()){H(!0);const e=await yt();if(!e)return;const a={id:E,name:$.name,flowData:JSON.stringify(e),type:"ASSISTANT"};try{let o;if(b?o=await te.updateChatflow(b,a):o=await te.createNewChatflow(a),o.data){be(o.data.id),K({type:Pe,chatflow:o.data});const s={...$,chatModel:c,instruction:W,flowId:o.data.id,documentStores:u,tools:f};(await L.updateAssistant(E,{details:JSON.stringify(s)})).data&&(H(!1),T({message:"Assistant saved successfully",options:{key:new Date().getTime()+Math.random(),variant:"success",action:n=>t.jsx(w,{style:{color:"white"},onClick:()=>O(n),children:t.jsx(v,{})})}}))}}catch(o){H(!1),T({message:`Failed to save assistant: ${typeof o.response.data=="object"?o.response.data.message:o.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:s=>t.jsx(w,{style:{color:"white"},onClick:()=>O(s),children:t.jsx(v,{})})}})}}},ft=async e=>{const a=[],o=[];for(let s=0;s<f.length;s++)try{const r=f[s],n=`${r.name}_${s}`,d=x.cloneDeep(r);x.set(d,"inputs",r.inputs);const p={id:n,data:{...d,id:n}};a.push(p);const h={source:n,sourceHandle:`${n}-output-${r.name}-Tool`,target:e,targetHandle:`${e}-input-tools-Tool`,type:"buttonedge",id:`${n}-${n}-output-${r.name}-Tool-${e}-${e}-input-tools-Tool`};o.push(h)}catch(r){console.error("Error adding tool",r)}return{nodes:a,edges:o}},gt=async e=>{const a=await Re.getSpecificNode("documentStoreVS"),o=await Re.getSpecificNode("retrieverTool"),s=[],r=[];for(let n=0;n<u.length;n++)try{const d=`documentStoreVS_${n}`,p=`retrieverTool_${n}`,h=x.cloneDeep(Q(a.data,d)),V=x.cloneDeep(Q(o.data,p));x.set(h,"inputs.selectedStore",u[n].id),x.set(h,"outputs.output","retriever");const C=se.find(Mt=>Mt.name===u[n].id),_=((C==null?void 0:C.label)||"").toLowerCase().replace(/ /g,"_").replace(/[^a-z0-9_-]/g,""),m=u[n].description||(C==null?void 0:C.description)||"";x.set(V,"inputs",{name:_,description:m,retriever:`{{${d}.data.instance}}`,returnSourceDocuments:u[n].returnSourceDocuments??!1});const y={id:d,data:{...h,id:d}};s.push(y);const A={id:p,data:{...V,id:p}};s.push(A);const vt={source:d,sourceHandle:`${d}-output-retriever-BaseRetriever`,target:p,targetHandle:`${p}-input-retriever-BaseRetriever`,type:"buttonedge",id:`${d}-${d}-output-retriever-BaseRetriever-${p}-${p}-input-retriever-BaseRetriever`};r.push(vt);const It={source:p,sourceHandle:`${p}-output-retrieverTool-RetrieverTool|DynamicTool|Tool|StructuredTool|Runnable`,target:e,targetHandle:`${e}-input-tools-Tool`,type:"buttonedge",id:`${p}-${p}-output-retrieverTool-RetrieverTool|DynamicTool|Tool|StructuredTool|Runnable-${e}-${e}-input-tools-Tool`};r.push(It)}catch(d){console.error("Error adding doc store",d)}return{nodes:s,edges:r}},yt=async()=>{var e;try{const a={},o=$e.nodes,s=$e.edges,r=`${c.name}_0`,n=(e=o.find(m=>m.data.category==="Chat Models"))==null?void 0:e.id;let d=o.filter(m=>m.data.category!=="Chat Models");const p={id:r,data:{...c,id:r}};d.push(p);const h=d.find(m=>m.data.name==="toolAgent"),V=h.id;x.set(h.data.inputs,"model",`{{${r}}}`),x.set(h.data.inputs,"systemMessage",`${W}`);const C=[];if(u.length>0){const m=u.map((y,A)=>`{{retrieverTool_${A}}}`);C.push(...m)}if(f.length>0){const m=f.map((y,A)=>`{{${f[A].id}}}`);C.push(...m)}x.set(h.data.inputs,"tools",C),d=d.map(m=>m.id===h.id?h:m);let _=s.map(m=>{const y={...m};return Object.keys(y).forEach(A=>{y[A].includes(n)&&(y[A]=y[A].replaceAll(n,r))}),y});if(u.length>0){const{nodes:m,edges:y}=await gt(V);d=[...d,...m],_=[..._,...y]}if(f.length>0){const{nodes:m,edges:y}=await ft(V);d=[...d,...m],_=[..._,...y]}return a.nodes=d,a.edges=_,a}catch(a){console.error("Error preparing config",a),T({message:`Failed to save assistant: ${typeof a.response.data=="object"?a.response.data.message:a.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:o=>t.jsx(w,{style:{color:"white"},onClick:()=>O(o),children:t.jsx(v,{})})}});return}},bt=e=>{re(!1),e==="deleteAssistant"?Me():e==="viewMessages"?(Qe({title:"View Messages",chatflow:I.chatflow,isChatflow:!1}),Ce(!0)):e==="viewLeads"?(tt({title:"View Leads",chatflow:I.chatflow}),Ae(!0)):e==="chatflowConfiguration"&&(st({title:"Assistant Configuration",chatflow:I.chatflow}),je(!0))},Me=async()=>{const e={title:"Delete",description:`Delete ${$.name}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await pt(e)&&E)try{(await L.deleteAssistant(E)).data&&b&&await te.deleteChatflow(b),R(-1)}catch(o){T({message:typeof o.response.data=="object"?o.response.data.message:o.response.data,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:s=>t.jsx(w,{style:{color:"white"},onClick:()=>O(s),children:t.jsx(v,{})})}})}},xt=e=>{dt({value:e,inputParam:{label:"Instructions",name:"instructions",type:"string"},confirmButtonName:"Save",cancelButtonName:"Cancel"}),le(!0)},wt=async e=>{var o,s;if(!pe()){de();return}try{H(!0);const r={name:c.name,inputs:c.inputs},n=await eo.generateDocStoreToolDesc(e,{selectedChatModel:r});if(n.data){H(!1);const d=((o=n.data)==null?void 0:o.content)||((s=n.data.kwargs)==null?void 0:s.content),p=u.map(h=>h.id===e?{...h,description:d}:h);P(p),T({message:"Document Store Tool Description generated successfully",options:{key:new Date().getTime()+Math.random(),variant:"success",action:h=>t.jsx(w,{style:{color:"white"},onClick:()=>O(h),children:t.jsx(v,{})})}})}}catch(r){console.error("Error generating doc store tool desc",r),H(!1),T({message:typeof r.response.data=="object"?r.response.data.message:r.response.data,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:n=>t.jsx(w,{style:{color:"white"},onClick:()=>O(n),children:t.jsx(v,{})})}})}},Ct=async()=>{if(!pe()){de();return}it({title:"Generate Instructions",description:"You can generate a prompt template by sharing basic details about your task.",data:{selectedChatModel:c}}),ie(!0)},At=()=>{Ke({title:"Embed in website or use as API",chatflowid:b,chatflowApiKeyId:I.chatflow.apikeyid,isSessionMemory:!0}),we(!0)},jt=e=>{const a=JSON.parse(e),o=[];for(const s of a){const r=u.find(p=>p.id===s),n=se.find(p=>p.name===s),d={id:s,name:(n==null?void 0:n.label)||"",description:(r==null?void 0:r.description)||(n==null?void 0:n.description)||"",returnSourceDocuments:(r==null?void 0:r.returnSourceDocuments)??!1};o.push(d)}P(o)},St=e=>{const a=u.filter(o=>o.id!==e);P(a)};i.useEffect(()=>{j.request(),D.request(),F.request()},[]),i.useEffect(()=>{if(D.data){const e=D.data.map(a=>({label:a.label,name:a.name,description:a.description}));Ve(e)}},[D.data]),i.useEffect(()=>{if(F.data){ze(F.data);const e=F.data.map(a=>({label:a.label,name:a.name,description:a.description}));Ue(e)}},[F.data]),i.useEffect(()=>{if(j.data){He(j.data);const e=j.data.map(a=>({label:a.label,name:a.name,imageSrc:`${me}/api/v1/node-icon/${a.name}`}));Fe(e),E&&(ce(!0),M.request(E))}},[j.data]),i.useEffect(()=>{if(M.data){ce(!1);try{const e=JSON.parse(M.data.details);qe(e),e.chatModel&&z(e.chatModel),e.instruction&&U(e.instruction),e.flowId&&(be(e.flowId),k.request(e.flowId)),e.documentStores&&P(e.documentStores),e.tools&&N(e.tools)}catch(e){console.error("Error parsing assistant details",e)}}},[M.data]),i.useEffect(()=>{if(k.data){const e=k.data;K({type:Pe,chatflow:e})}else k.error&&J(`Failed to retrieve: ${k.error.response.data.message}`)},[k.data,k.error]),i.useEffect(()=>{M.error&&(ce(!1),J(M.error))},[M.error]),i.useEffect(()=>{j.error&&J(j.error)},[j.error]),i.useEffect(()=>{D.error&&J(D.error)},[D.error]);const ue=()=>b&&!q?6:12,De=()=>window.innerHeight-130;return t.jsxs(t.Fragment,{children:[t.jsx(Bt,{children:ve?t.jsx(zt,{error:ve}):t.jsx(B,{flexDirection:"column",children:t.jsx(g,{children:t.jsxs(he,{container:!0,spacing:"2",children:[t.jsx(he,{item:!0,xs:12,md:ue(),lg:ue(),sm:ue(),children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",paddingRight:15},children:[t.jsx(g,{sx:{flexGrow:1,py:1.25,width:"100%"},children:t.jsxs(Rt,{disableGutters:!0,sx:{p:0,display:"flex",justifyContent:"space-between",width:"100%"},children:[t.jsxs(g,{sx:{display:"flex",alignItems:"center",flexDirection:"row"},children:[t.jsx(Gt,{size:"small",color:"secondary","aria-label":"back",title:"Back",onClick:()=>R(-1),children:t.jsx(to,{})}),t.jsx(S,{sx:{ml:2,mr:2},variant:"h3",children:($==null?void 0:$.name)??""})]}),t.jsx("div",{style:{flex:1}}),b&&!q&&t.jsx(Y,{title:"API Endpoint",sx:{borderRadius:"50%",mr:2},children:t.jsx(X,{variant:"rounded",sx:{...l.typography.commonAvatar,...l.typography.mediumAvatar,transition:"all .2s ease-in-out",background:l.palette.canvasHeader.deployLight,color:l.palette.canvasHeader.deployDark,"&:hover":{background:l.palette.canvasHeader.deployDark,color:l.palette.canvasHeader.deployLight}},color:"inherit",onClick:At,children:t.jsx(oo,{stroke:1.5,size:"1.3rem"})})}),t.jsx(fe,{permission:"assistants:create",children:t.jsx(Y,{title:"Save",sx:{borderRadius:"50%",mr:2},children:t.jsx(X,{variant:"rounded",sx:{...l.typography.commonAvatar,...l.typography.mediumAvatar,transition:"all .2s ease-in-out",background:l.palette.canvasHeader.saveLight,color:l.palette.canvasHeader.saveDark,"&:hover":{background:l.palette.canvasHeader.saveDark,color:l.palette.canvasHeader.saveLight}},color:"inherit",onClick:Ie,children:t.jsx(ao,{stroke:1.5,size:"1.3rem"})})})}),b&&!q&&t.jsx(Y,{ref:ae,title:"Settings",sx:{borderRadius:"50%"},children:t.jsx(X,{variant:"rounded",sx:{...l.typography.commonAvatar,...l.typography.mediumAvatar,transition:"all .2s ease-in-out",background:l.palette.canvasHeader.settingsLight,color:l.palette.canvasHeader.settingsDark,"&:hover":{background:l.palette.canvasHeader.settingsDark,color:l.palette.canvasHeader.settingsLight}},onClick:()=>re(!ne),children:t.jsx(Et,{stroke:1.5,size:"1.3rem"})})}),!b&&!q&&t.jsx(fe,{permission:"assistants:delete",children:t.jsx(Y,{ref:ae,title:"Delete Assistant",sx:{borderRadius:"50%"},children:t.jsx(X,{variant:"rounded",sx:{...l.typography.commonAvatar,...l.typography.mediumAvatar,transition:"all .2s ease-in-out",background:l.palette.error.light,color:l.palette.error.dark,"&:hover":{background:l.palette.error.dark,color:l.palette.error.light}},onClick:Me,children:t.jsx(Ee,{stroke:1.5,size:"1.3rem"})})})})]})}),t.jsxs(g,{sx:{p:2,mt:1,mb:1,border:1,borderColor:l.palette.grey[900]+25,borderRadius:2},children:[t.jsx("div",{style:{display:"flex",flexDirection:"row"},children:t.jsxs(S,{children:["Select Model",t.jsx("span",{style:{color:"red"},children:" *"})]})}),t.jsx(Be,{name:"chatModel",options:Le??[],onSelect:e=>{if(!e)z({});else{const a=Ne.find(o=>o.name===e);if(a){const o=`${a.name}_0`,s=x.cloneDeep(a),r=Q(s,o);z(r)}}},value:c?c==null?void 0:c.name:"choose an option"},JSON.stringify(c))]}),t.jsxs(g,{sx:{p:2,mt:1,mb:1,border:1,borderColor:l.palette.grey[900]+25,borderRadius:2},children:[t.jsxs(B,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[t.jsxs(S,{children:["Instructions",t.jsx("span",{style:{color:"red"},children:" *"})]}),t.jsx("div",{style:{flex:1}}),t.jsx(ge,{size:"small",sx:{height:25,width:25},title:"Expand",color:"secondary",onClick:()=>xt(W),children:t.jsx(so,{})}),(c==null?void 0:c.name)&&t.jsx(w,{title:"Generate instructions using model",sx:{borderRadius:20},size:"small",variant:"text",onClick:()=>Ct(),startIcon:t.jsx(Oe,{size:20}),children:"Generate"})]}),t.jsx(Te,{sx:{mt:1,width:"100%"},type:"text",multiline:!0,rows:6,value:W,onChange:e=>U(e.target.value)})]}),t.jsxs(g,{sx:{p:2,mt:1,mb:1,border:1,borderColor:l.palette.grey[900]+25,borderRadius:2},children:[t.jsxs(B,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[t.jsx(S,{children:"Knowledge (Document Stores)"}),t.jsx(ee,{title:"Give your assistant context about different document sources. Document stores must be upserted in advance."})]}),t.jsx(Wt,{name:JSON.stringify(u),options:se??[],onSelect:e=>{e?jt(e):P([])},value:u.map(e=>e.id)??"choose an option"},JSON.stringify(u)),u.length>0&&t.jsxs(B,{sx:{mt:3,position:"relative",alignItems:"center"},direction:"row",children:[t.jsxs(S,{children:["Describe Knowledge",t.jsx("span",{style:{color:"red"},children:" *"})]}),t.jsx(ee,{title:"Describe what the knowledge base is about, this is useful for the AI to know when and how to search for correct information"})]}),u.map((e,a)=>t.jsxs(g,{sx:{mt:1,mb:2},children:[t.jsxs(B,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[t.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",width:"max-content",height:"max-content",borderRadius:15,background:"rgb(254,252,191)",paddingLeft:15,paddingRight:15,paddingTop:5,paddingBottom:5,marginRight:10,marginBottom:10},children:[t.jsx("span",{style:{color:"rgb(116,66,16)",marginRight:10},children:e.name}),t.jsx(ge,{sx:{height:15,width:15,p:0},onClick:()=>St(e.id),children:t.jsx(v,{})})]}),t.jsx("div",{style:{flex:1}}),(c==null?void 0:c.name)&&t.jsx(w,{title:"Generate description using model",sx:{borderRadius:20},size:"small",variant:"text",onClick:()=>wt(e.id),startIcon:t.jsx(Oe,{size:20}),children:"Generate"})]}),t.jsx(Te,{sx:{mt:1,width:"100%"},type:"text",multiline:!0,rows:3,value:e.description,onChange:o=>{const s=[...u];s[a].description=o.target.value,P(s)}}),t.jsxs(B,{sx:{mt:2,position:"relative",alignItems:"center"},direction:"row",children:[t.jsx(S,{children:"Return Source Documents"}),t.jsx(ee,{title:"Return the actual source documents that were used to answer the question"})]}),t.jsx(Zt,{value:e.returnSourceDocuments??!1,onChange:o=>{const s=[...u];s[a].returnSourceDocuments=o,P(s)}})]},a))]}),c&&Object.keys(c).length>0&&t.jsx(g,{sx:{p:0,mt:1,mb:1,border:1,borderColor:l.palette.grey[900]+25,borderRadius:2},children:Z(c).filter(e=>!e.hidden&&e.display!==!1).map((e,a)=>t.jsx(_e,{inputParam:e,data:c,onNodeDataChange:ut},a))}),t.jsxs(g,{sx:{p:2,mt:1,mb:1,border:1,borderColor:l.palette.grey[900]+25,borderRadius:2},children:[t.jsxs(B,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[t.jsx(S,{children:"Tools"}),t.jsx(ee,{title:"Tools are actions that your assistant can perform"})]}),f.map((e,a)=>t.jsxs(g,{sx:{border:1,borderColor:l.palette.grey[900]+25,borderRadius:2,mt:2,mb:2},children:[t.jsxs(g,{sx:{pl:2,pr:2,pt:2,pb:0},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[t.jsxs(S,{children:["Tool",t.jsx("span",{style:{color:"red"},children:" *"})]}),t.jsx("div",{style:{flex:1}}),t.jsx(ge,{color:"error",sx:{height:15,width:15,p:0},onClick:()=>{const o=f.filter((s,r)=>r!==a);N(o)},children:t.jsx(Ee,{})})]}),t.jsx(Be,{name:e.name,options:We??[],onSelect:o=>{if(o){const s=Ge.find(r=>r.name===o);if(s){const r=`${s.name}_${a}`,n=x.cloneDeep(s),d=Q(n,r),p=[...f];p[a]=d,N(p)}}else{const s=[...f];s[a]={},N(s)}},value:(e==null?void 0:e.name)||"choose an option"},JSON.stringify(e))]}),e&&Object.keys(e).length===0&&t.jsx(g,{sx:{pl:2,pr:2,pt:0,pb:2}}),e&&Object.keys(e).length>0&&t.jsx(g,{sx:{p:0,mt:2,mb:1},children:Z(e).filter(o=>!o.hidden&&o.display!==!1).map((o,s)=>t.jsx(_e,{inputParam:o,data:e,onNodeDataChange:mt(a)},s))})]},a)),t.jsx(w,{fullWidth:!0,title:"Add Tool",sx:{mt:1,mb:1,borderRadius:20},variant:"outlined",onClick:()=>N([...f,{}]),children:"Add Tool"})]}),c&&Object.keys(c).length>0&&t.jsx(fe,{permission:"assistants:create",children:t.jsx(w,{fullWidth:!0,title:"Save Assistant",sx:{mt:1,mb:1,borderRadius:20,background:"linear-gradient(45deg, #673ab7 30%, #1e88e5 90%)"},variant:"contained",onClick:Ie,children:"Save Assistant"})})]})}),b&&!q&&t.jsx(he,{item:!0,xs:12,md:6,lg:6,sm:6,children:t.jsxs(g,{sx:{mt:2},children:[ye.isDarkMode&&t.jsx(oe,{chatflowid:b,chatflow:I.chatflow,apiHost:me,chatflowConfig:{},theme:{button:{backgroundColor:"#32353b",iconColor:"#ffffff"},chatWindow:{height:De(),showTitle:!0,backgroundColor:"#23262c",title:"  Preview",botMessage:{backgroundColor:"#32353b",textColor:"#ffffff"},userMessage:{backgroundColor:"#191b1f",textColor:"#ffffff"},textInput:{backgroundColor:"#32353b",textColor:"#ffffff"},footer:{showFooter:!1}}}}),!ye.isDarkMode&&t.jsx(oe,{chatflowid:b,chatflow:I.chatflow,apiHost:me,chatflowConfig:{},theme:{button:{backgroundColor:"#eeeeee",iconColor:"#333333"},chatWindow:{height:De(),showTitle:!0,backgroundColor:"#fafafa",title:"  Preview",botMessage:{backgroundColor:"#ffffff",textColor:"#303235"},userMessage:{backgroundColor:"#f7f8ff",textColor:"#303235"},textInput:{backgroundColor:"#ffffff",textColor:"#303235"},footer:{showFooter:!1}}}})]})})]})})})}),Se&&t.jsx(qt,{open:Se}),xe&&t.jsx(Ut,{show:xe,dialogProps:Je,onCancel:()=>we(!1)}),ne&&t.jsx(Jt,{chatflow:I.chatflow,isSettingsOpen:ne,anchorEl:ae.current,onClose:()=>re(!1),onSettingsItemClick:bt,isCustomAssistant:!0}),t.jsx(Kt,{show:Ye,dialogProps:Xe,onCancel:()=>Ce(!1)}),t.jsx(Yt,{show:Ze,dialogProps:et,onCancel:()=>Ae(!1)}),t.jsx(Xt,{show:ot,dialogProps:at,onCancel:()=>je(!1)},"chatflowConfiguration"),t.jsx(Vt,{show:nt,dialogProps:rt,onCancel:()=>ie(!1),onConfirm:e=>{U(e),ie(!1)}}),t.jsx(Qt,{show:lt,dialogProps:ct,onCancel:()=>le(!1),onConfirm:e=>{U(e),le(!1)}}),t.jsx(Ft,{})]})};export{va as default};
