import{p as te,b7 as ie,r as a,c as v,u as re,bi as ne,cT as oe,j as e,B as r,S as C,aA as le,a4 as ce,l as t,z as D,C as T,aa as de,n as O,bh as R}from"./index-B1XR3Coy.js";import{z as S,p as he}from"./validation-DNbaeON5.js";import{I as x}from"./Input-C2v4FwXn.js";import{B as ue}from"./BackdropLoader-C982mQas.js";import{a as pe}from"./auth-w0XUAhtD.js";import{A as xe,G as me,a as ge,l as fe}from"./auth0-C7knQvrB.js";import{A as z,I as je}from"./IconExclamationCircle-BsAK4qbB.js";import{I as ye}from"./IconCircleCheck-CKqsC1lm.js";import{T as F}from"./TextField-BEeUeVUl.js";import{I as M}from"./Icon-BOcLJSmQ.js";import"./ListItem-C9nlU6HX.js";import"./FormControl-Cb0ROeST.js";import"./Close-CA_iFeNy.js";import"./InputLabel-HPVYUEFn.js";const we=S.object({username:S.string().min(1,"Name is required"),email:S.string().min(1,"Email is required").email("Invalid email address"),password:he,confirmPassword:S.string().min(1,"Confirm Password is required")}).refine(l=>l.password===l.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),Ue=()=>{te();const{isEnterpriseLicensed:l,isOpenSource:N}=ie(),H={label:"Organization",name:"organization",type:"text",placeholder:"Acme"},$={label:"Username",name:"username",type:"text",placeholder:"John Doe"},_={label:"Password",name:"password",type:"password",placeholder:"********"},J={label:"Confirm Password",name:"confirmPassword",type:"password",placeholder:"********"},K={label:"EMail",name:"email",type:"email",placeholder:"user@company.com"},[m,U]=a.useState(""),[g,k]=a.useState(""),[G,L]=a.useState(""),[A,q]=a.useState(""),[E,Y]=a.useState(""),[b,Q]=a.useState(""),[P,V]=a.useState(""),[W,h]=a.useState(!1),[f,c]=a.useState(""),[B,X]=a.useState(void 0),[j,Z]=a.useState(!1),u=v(pe.login),i=v(R.registerAccount),y=v(R.getBasicAuth),ee=re(),p=v(fe.getLoginMethods),[n,se]=a.useState([]),ae=async s=>{s.preventDefault();const o=we.safeParse({orgName:E,username:A,email:m,password:g,confirmPassword:G});if(o.success){if(h(!0),c(""),j)try{const d=await R.checkBasicAuth({username:b,password:P});if(!d||!d.data||d.data.message!=="Authentication successful"){c("Authentication failed. Please check your existing credentials."),h(!1);return}}catch{c("Authentication failed. Please check your existing credentials."),h(!1);return}const w={user:{name:A,email:m,type:"pro",credential:g}};l&&(w.organization={name:E}),await i.request(w)}else{const w=o.error.errors.map(d=>d.message);c(w.join(", "))}};a.useEffect(()=>{if(i.error){const s=typeof i.error.response.data=="object"?i.error.response.data.message:i.error.response.data;let o="";l?o=`Error in registering organization. Please contact your administrator. (${s})`:o=`Error in registering account: ${s}`,c(o),h(!1)}},[i.error]),a.useEffect(()=>{y.data&&y.data.isUsernamePasswordSet===!0&&Z(!0)},[y.data]),a.useEffect(()=>{N?y.request():p.request()},[]),a.useEffect(()=>{p.data&&p.data.providers&&se(p.data.providers.map(s=>s))},[p.data]),a.useEffect(()=>{i.data&&(c(void 0),L(""),k(""),q(""),U(""),X(i.data.message),setTimeout(()=>{const s={email:m,password:g};u.request(s)},1e3))},[i.data]),a.useEffect(()=>{var s;u.data&&(h(!1),ne.dispatch(oe(u.data)),localStorage.setItem("username",u.data.name),ee(((s=location.state)==null?void 0:s.path)||"/chatflows"))},[u.data]);const I=s=>{window.location.href=`/api/v1/${s}/login`};return e.jsxs(e.Fragment,{children:[e.jsx(r,{sx:{width:"100%",maxHeight:"100vh",overflowY:"auto",display:"flex",flexDirection:"column",alignItems:"center",padding:"24px"},children:e.jsxs(C,{flexDirection:"column",sx:{width:"480px",gap:3},children:[f&&e.jsx(z,{icon:e.jsx(je,{}),variant:"filled",severity:"error",children:f.split(", ").length>0?e.jsx(le,{dense:!0,sx:{py:0},children:f.split(", ").map((s,o)=>e.jsx(ce,{primary:s,primaryTypographyProps:{color:"#fff !important"}},o))}):f}),B&&e.jsx(z,{icon:e.jsx(ye,{}),variant:"filled",severity:"success",children:B}),e.jsx(C,{sx:{gap:1},children:e.jsx(t,{variant:"h1",children:"Setup Account"})}),j&&e.jsx(z,{severity:"info",children:"Application authentication now requires email and password. Contact administrator to setup an account."}),(N||l)&&e.jsx(t,{variant:"caption",children:"Account setup does not make any external connections, your data stays securely on your locally hosted server."}),e.jsx("form",{onSubmit:ae,children:e.jsxs(C,{sx:{width:"100%",flexDirection:"column",alignItems:"left",justifyContent:"center",gap:2},children:[j&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{sx:{mb:1},children:["Existing Username",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(F,{fullWidth:!0,placeholder:"Existing Username",value:b,onChange:s=>Q(s.target.value)}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Existing username that was set as FLOWISE_USERNAME environment variable"})})]}),e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{sx:{mb:1},children:["Existing Password",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(F,{fullWidth:!0,type:"password",placeholder:"Existing Password",value:P,onChange:s=>V(s.target.value)}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Existing password that was set as FLOWISE_PASSWORD environment variable"})})]}),e.jsx(D,{children:e.jsx(T,{label:"New Account Details",size:"small"})})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Organization Name:",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(x,{inputParam:H,placeholder:"Organization Name",onChange:s=>Y(s),value:E,showDialog:!1})]}),e.jsx(r,{children:e.jsx(D,{children:e.jsx(T,{label:"Account Administrator",size:"small"})})})]}),e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Administrator Name",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(x,{inputParam:$,placeholder:"Display Name",onChange:s=>q(s),value:A,showDialog:!1}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Is used for display purposes only."})})]}),e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Administrator Email",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(x,{inputParam:K,onChange:s=>U(s),type:"email",value:m,showDialog:!1}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Kindly use a valid email address. Will be used as login id."})})]}),e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Password",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(x,{inputParam:_,onChange:s=>k(s),value:g}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Password must be at least 8 characters long and contain at least one lowercase letter, one uppercase letter, one digit, and one special character."})})]}),e.jsxs(r,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(t,{children:["Confirm Password",e.jsx("span",{style:{color:"red"},children:" *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(x,{inputParam:J,onChange:s=>L(s),value:G}),e.jsx(t,{variant:"caption",children:e.jsx("i",{children:"Reconfirm your password. Must match the password typed above."})})]}),e.jsx(de,{variant:"contained",style:{borderRadius:12,height:40,marginRight:5},type:"submit",disabled:j&&(!b||!P),children:"Sign Up"}),n&&n.length>0&&e.jsx(D,{sx:{width:"100%"},children:"OR"}),n&&n.map(s=>s==="azure"&&e.jsx(O,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>I(s),startIcon:e.jsx(M,{children:e.jsx("img",{src:xe,alt:"MicrosoftSSO",width:20,height:20})}),children:"Sign Up With Microsoft"},s)),n&&n.map(s=>s==="google"&&e.jsx(O,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>I(s),startIcon:e.jsx(M,{children:e.jsx("img",{src:me,alt:"GoogleSSO",width:20,height:20})}),children:"Sign Up With Google"},s)),n&&n.map(s=>s==="auth0"&&e.jsx(O,{variant:"outlined",style:{borderRadius:12,height:45,marginRight:5,lineHeight:0},onClick:()=>I(s),startIcon:e.jsx(M,{children:e.jsx("img",{src:ge,alt:"Auth0SSO",width:20,height:20})}),children:"Sign Up With Auth0 by Okta"},s))]})})]})}),W&&e.jsx(ue,{open:W})]})};export{Ue as default};
