import{af as ee,t as te,M as W,R as re,u as oe,a as se,o as ae,r as s,Q as ie,p as ne,ak as ce,c as k,aq as de,ar as le,j as e,S as pe,ad as me,aj as c,B as g,l as m,a1 as ue,a8 as he,d as xe,as as P,ag as fe,ah as ge,n as F,E as $,J as ve,K as ye}from"./index-B1XR3Coy.js";import{R as je}from"./main-BBsr8sqY.js";import{d as Se}from"./DynamicFeed-qKNr2bwA.js";import{c as ke}from"./chunks_empty-fFmvGjOz.js";import{B as Ce}from"./BackdropLoader-C982mQas.js";import{C as be}from"./ConfirmDialog-Bksga_et.js";import{E as De}from"./ExpandedChunkDialog-C2wgrYw6.js";import{V as we}from"./ViewHeader-jo2V0q71.js";import{D as Ee}from"./DocStoreInputHandler-9-EYgHTZ.js";import{d as C}from"./documentstore-GQ_lrBF1.js";import{n as Ie}from"./nodes-D-x6LTqi.js";import{v as Re}from"./v4-D8aEg3BZ.js";import{I as Te}from"./IconDeviceFloppy-CcMo-Sl3.js";import{b as Ve}from"./IconSearch-BzBgax5m.js";import"./CodeEditor-BjDzi2Vy.js";import"./index-DhL3T6x0.js";import"./IconTrash-BvhWIQ6v.js";import"./IconLanguage-Dreb5nKM.js";import"./StyledFab-BqTal21_.js";import"./Dropdown-BH_BuIwh.js";import"./Autocomplete-2B99MXTa.js";import"./Close-CA_iFeNy.js";import"./FormControl-Cb0ROeST.js";import"./TextField-BEeUeVUl.js";import"./InputLabel-HPVYUEFn.js";import"./MultiDropdown-OnTaU3K-.js";import"./CredentialInputHandler-NSWgGX5U.js";import"./CredentialListDialog-ooDI7A-3.js";import"./TooltipWithParser-C72LCUcD.js";import"./index-D--Rb2MU.js";import"./Tooltip-9ICsuaYn.js";import"./Input-C2v4FwXn.js";import"./ListItem-C9nlU6HX.js";import"./Switch-BtbcRzr_.js";import"./IconArrowsMaximize-BrsSDZNx.js";import"./IconAlertTriangle-Bdlxpe5D.js";import"./InputAdornment-D6_duzKN.js";import"./Delete-CvnCkEIf.js";import"./IconPlus-DpyX5kZB.js";import"./Grid-DtMOPoeK.js";import"./toPropertyKey-hKuLU48H.js";import"./createStyled-BzRwilhm.js";import"./Skeleton-BQAmmov-.js";import"./KeyboardArrowRight-KQTKBFVE.js";import"./LastPage-CMvObEkB.js";import"./GridActionsCellItem-C4fgcfe6.js";import"./File-B2PWlg1I.js";import"./suggestionOption-CTRD7oqB.js";import"./TabPanel-C2EL9Kp7.js";import"./ExpandMore-BP5oMSwT.js";import"./MemoizedReactMarkdown-CNH2mkE4.js";import"./ExpandTextDialog-Sszv9N4G.js";import"./LoadingButton-BHZSG_sF.js";import"./IconRefresh-B2aTlEaU.js";import"./ToolDialog-hiXiaWJY.js";import"./ExportAsTemplateDialog-CN3tapJC.js";import"./AssistantDialog-BG0DIOgO.js";import"./assistants-C-o7l-z6.js";import"./Stepper-CvQjJ8b9.js";import"./string-3NetaFjT.js";import"./IconBulb-CwCq2_I0.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var qe=ee("outline","file-stack","IconFileStack",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4",key:"svg-1"}],["path",{d:"M5 21h14",key:"svg-2"}],["path",{d:"M5 18h14",key:"svg-3"}],["path",{d:"M5 15h14",key:"svg-4"}]]);const Ae=te(W)(({theme:x})=>({background:x.palette.card.main,color:x.darkTextPrimary,overflow:"auto",position:"relative",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)",cursor:"pointer","&:hover":{background:x.palette.card.hover,boxShadow:"0 2px 14px 0 rgb(32 40 45 / 20%)"},maxHeight:"250px",minHeight:"250px",maxWidth:"100%",overflowWrap:"break-word",whiteSpace:"pre-line",padding:1})),Ot=()=>{const x=re(t=>t.customization),b=oe(),O=se(),D=ae(),f=s.useRef(null),{hasAssignedWorkspace:H}=ie();ne();const w=(...t)=>D(ve(...t)),E=(...t)=>D(ye(...t)),{storeId:j}=ce(),[d,I]=s.useState([]),[R,l]=s.useState(!1),[L,T]=s.useState(!1),[Q,_]=s.useState({}),[u,z]=s.useState({}),[v,G]=s.useState(""),[V,q]=s.useState(-1),[A,B]=s.useState(void 0),h=k(C.getSpecificDocumentStore),i=k(C.queryVectorStore),y=k(Ie.getSpecificNode),[o,M]=s.useState({}),K=({inputParam:t,newValue:r})=>{M(p=>{const n={...p};return n.inputs[t.name]=r,n.inputParams=P(n),n})},J=(t,r)=>{const n={data:{selectedChunk:d.find(a=>a.id===t),selectedChunkNumber:r}};_(n),T(!0)},U=t=>{const r=t.isComposing||t.keyCode===229;t.key==="Enter"&&v&&!r?!t.shiftKey&&v&&(f.current&&f.current.blur(),N()):t.key==="Enter"&&t.preventDefault()},N=()=>{l(!0);const t={query:v,storeId:j,inputs:o.inputs};i.request(t)},X=async()=>{var r,p,n;l(!0);const t={storeId:j};o.inputs&&(t.vectorStoreConfig={},t.vectorStoreName=o.name,Object.keys(o.inputs).map(a=>{a==="FLOWISE_CREDENTIAL_ID"?t.vectorStoreConfig.credential=o.inputs[a]:t.vectorStoreConfig[a]=o.inputs[a]}));try{const a=await C.updateVectorStoreConfig(t);l(!1),a.data&&w({message:"Vector Store Config Successfully Updated",options:{key:new Date().getTime()+Math.random(),variant:"success",action:S=>e.jsx(F,{style:{color:"white"},onClick:()=>E(S),children:e.jsx($,{})})}})}catch(a){l(!1);const S=((r=a.response)==null?void 0:r.data)||`${(p=a.response)==null?void 0:p.status}: ${(n=a.response)==null?void 0:n.statusText}`;w({message:`Failed to update vector store config: ${S}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:Z=>e.jsx(F,{style:{color:"white"},onClick:()=>E(Z),children:e.jsx($,{})})}})}};s.useEffect(()=>{i.data&&(I(i.data.docs),q(i.data.timeTaken),B(void 0),l(!1),f.current&&f.current.focus())},[i.data]),s.useEffect(()=>{var t,r;if(i.error){if((r=(t=i.error.response)==null?void 0:t.data)!=null&&r.message){const p=i.error.response.data.message;B(p.replace("documentStoreServices.queryVectorStore - ","")),I([]),q(-1)}l(!1)}},[i.error]),s.useEffect(()=>{if(y.data){const t=y.data;Y(t)}},[y.data]);const Y=t=>{const r=de.cloneDeep(le(t,Re()));u.vectorStoreConfig&&(r.inputs=u.vectorStoreConfig.config,r.credential=u.vectorStoreConfig.config.credential),M(r)};return s.useEffect(()=>{h.request(j)},[]),s.useEffect(()=>{if(h.data){if(!H(h.data.workspaceId)){b("/unauthorized");return}z(h.data);const t=h.data.vectorStoreConfig;t&&y.request(t.name),l(!1)}},[h.data]),e.jsxs(e.Fragment,{children:[e.jsx(W,{style:{position:"relative"},children:e.jsxs(pe,{flexDirection:"column",sx:{gap:1},children:[e.jsx(we,{isBackButton:!0,search:!1,title:(u==null?void 0:u.name)||"Document Store",description:"Retrieval Playground - Test your vector store retrieval settings",onBack:()=>b(-1),children:e.jsx(me,{permissionId:"documentStores:upsert-config",variant:"outlined",color:"secondary",sx:{borderRadius:2,height:"100%"},startIcon:e.jsx(Te,{}),onClick:X,children:"Save Config"})}),e.jsx("div",{style:{width:"100%"}}),e.jsx("div",{children:e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{sx:{ml:1,mr:1},item:!0,xs:12,sm:12,md:12,lg:12,children:e.jsxs(g,{children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(m,{variant:"overline",children:["Enter your Query",e.jsx("span",{style:{color:"red"},children:"Â *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(ue,{size:"small",multiline:!0,rows:4,sx:{mt:1},type:"string",fullWidth:!0,inputRef:f,onChange:t=>G(t.target.value),onKeyDown:U,value:v??"",endAdornment:e.jsx(he,{variant:"contained",onClick:N,children:e.jsx(Ve,{})})})]})}),e.jsxs(c,{sx:{ml:1,mr:1,mt:1},container:!0,spacing:1,children:[e.jsx(c,{item:!0,xs:12,sm:4,md:4,children:e.jsx(g,{children:e.jsx(c,{container:!0,spacing:"2",children:e.jsx(c,{item:!0,xs:12,md:12,lg:12,sm:12,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",paddingRight:15,paddingTop:5},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",flexDirection:"row",p:1},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:o.label?e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:o.label??"embeddings",src:`${xe}/api/v1/node-icon/${o==null?void 0:o.name}`}):e.jsx(Se,{color:"black"})}),e.jsx(m,{sx:{ml:2},variant:"h3",children:o.label}),e.jsx("div",{style:{flex:1}})]}),o&&Object.keys(o).length>0&&P(o).filter(t=>!t.hidden&&t.display!==!1).map((t,r)=>e.jsx(Ee,{data:o,inputParam:t,isAdditionalParams:t.additionalParams,onNodeDataChange:K},r))]})})})})}),e.jsxs(c,{item:!0,xs:12,sm:8,md:8,children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",flexDirection:"row",p:1,paddingTop:2,marginBottom:4},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:e.jsx(qe,{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"}})}),e.jsxs(m,{sx:{ml:2},variant:"h3",children:["Retrieved Documents",V>-1&&e.jsxs(m,{variant:"body2",sx:{color:"gray"},children:["Count: ",d.length,". Time taken: ",V," millis."]}),A&&e.jsx(m,{variant:"body2",sx:{color:"gray"},children:A})]}),e.jsx("div",{style:{flex:1}})]}),!d.length&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:[e.jsx(g,{sx:{mt:5,p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"16vh",width:"auto"},src:ke,alt:"chunks_emptySVG"})}),e.jsx("div",{children:"No Documents Retrieved"})]}),e.jsx(c,{container:!0,spacing:2,children:(d==null?void 0:d.length)>0&&d.map((t,r)=>e.jsx(c,{item:!0,lg:6,md:6,sm:6,xs:6,children:e.jsx(Ae,{content:!1,onClick:()=>J(t.id,t.chunkNo),sx:{border:1,borderColor:O.palette.grey[900]+25,borderRadius:2},children:e.jsx(fe,{children:e.jsxs(ge,{sx:{p:2},children:[e.jsx(m,{sx:{wordWrap:"break-word",mb:1},variant:"h5",children:`#${t.chunkNo}. Characters: ${t.pageContent.length}`}),e.jsx(m,{sx:{wordWrap:"break-word"},variant:"body2",children:t.pageContent}),e.jsx(je,{theme:x.isDarkMode?"ocean":"rjv-default",style:{paddingTop:10},src:t.metadata||{},name:null,quotesOnKeys:!1,enableClipboard:!1,displayDataTypes:!1,collapsed:!0})]})})})},r))})]})]})]})})]})}),e.jsx(be,{}),e.jsx(De,{show:L,dialogProps:Q,onCancel:()=>T(!1),isReadOnly:!0}),R&&e.jsx(Ce,{open:R})]})};export{Ot as default};
