import{u as K,a as Q,b as Z,R as ee,p as te,r as o,o as ae,c as se,j as e,M as re,S as T,e as oe,B as ie,U as ne,V as ce,W as le,X as de,O as me,L as s,a6 as i,Y as xe,b6 as he,a8 as P,n as B,E as A,J as pe,K as je}from"./index-B1XR3Coy.js";import{m as ue}from"./moment-9Y6NtRWJ.js";import{u as fe,C as ge}from"./ConfirmDialog-Bksga_et.js";import{A as De}from"./AddEditDatasetDialog-6N0MF0-z.js";import{V as Ce}from"./ViewHeader-jo2V0q71.js";import{E as Se}from"./ErrorBoundary-WOMkE_83.js";import{S as f,a as n}from"./TableStyles-Bn4d_qd9.js";import{D as be,T as we}from"./TablePagination-Dfhg7VLc.js";import{d as I}from"./dataset-gYqR4wmQ.js";import{e as ve}from"./empty_datasets-sHG3vrEn.js";import{I as ye}from"./IconPlus-DpyX5kZB.js";import{S as r}from"./Skeleton-BQAmmov-.js";import{I as ke}from"./IconSearch-BzBgax5m.js";import{I as Ee}from"./IconTrash-BvhWIQ6v.js";import"./File-B2PWlg1I.js";import"./FormControl-Cb0ROeST.js";import"./Switch-BtbcRzr_.js";import"./TooltipWithParser-C72LCUcD.js";import"./index-D--Rb2MU.js";import"./Tooltip-9ICsuaYn.js";import"./StyledFab-BqTal21_.js";import"./IconCopy-BBl1XuSo.js";import"./Pagination-DyTukyc1.js";import"./LastPage-CMvObEkB.js";const Qe=()=>{const N=K(),x=Q(),{confirm:R}=fe(),{error:g}=Z(),M=ee(t=>t.customization);te();const D=(...t)=>S(pe(...t)),C=(...t)=>S(je(...t)),[L,F]=o.useState(""),S=ae(),[b,w]=o.useState(!0),[v,Y]=o.useState([]),[_,l]=o.useState(!1),[V,y]=o.useState({}),c=se(I.getAllDatasets),[h,$]=o.useState(1),[p,W]=o.useState(be),[q,G]=o.useState(0),U=(t,a)=>{$(t),W(a),j(t,a)},j=(t,a)=>{w(!0);const E={page:t||h,limit:a||p};c.request(E)},d=t=>{N(`/dataset_rows/${t.id}?page=1&limit=10`)},z=t=>{F(t.target.value)},H=()=>{y({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",data:{}}),l(!0)},O=t=>{y({type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Save",data:t}),l(!0)},X=async t=>{const a={title:"Delete",description:`Delete dataset ${t.name}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await R(a))try{(await I.deleteDataset(t.id)).data&&(D({message:"Dataset deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:u=>e.jsx(B,{style:{color:"white"},onClick:()=>C(u),children:e.jsx(A,{})})}}),k())}catch(m){D({message:`Failed to delete dataset: ${typeof m.response.data=="object"?m.response.data.message:m.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:u=>e.jsx(B,{style:{color:"white"},onClick:()=>C(u),children:e.jsx(A,{})})}})}},k=()=>{l(!1),j()};function J(t){return t.name.toLowerCase().indexOf(L.toLowerCase())>-1}return o.useEffect(()=>{j(h,p)},[]),o.useEffect(()=>{var t,a;c.data&&(Y((t=c.data)==null?void 0:t.data),G((a=c.data)==null?void 0:a.total))},[c.data]),o.useEffect(()=>{w(c.loading)},[c.loading]),e.jsxs(e.Fragment,{children:[e.jsx(re,{children:g?e.jsx(Se,{error:g}):e.jsxs(T,{flexDirection:"column",sx:{gap:3},children:[e.jsx(Ce,{isBackButton:!1,isEditButton:!1,onSearchChange:z,search:!0,title:"Datasets",description:"",children:e.jsx(oe,{permissionId:"datasets:create",variant:"contained",sx:{borderRadius:2,height:"100%"},onClick:H,startIcon:e.jsx(ye,{}),children:"Add New"})}),!b&&v.length<=0?e.jsxs(T,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(ie,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:ve,alt:"empty_datasetSVG"})}),e.jsx("div",{children:"No Datasets Yet"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{sx:{border:1,borderColor:x.palette.grey[900]+25,borderRadius:2},component:ce,children:e.jsxs(le,{sx:{minWidth:650},children:[e.jsx(de,{sx:{backgroundColor:M.isDarkMode?x.palette.common.black:x.palette.grey[100],height:56},children:e.jsxs(me,{children:[e.jsx(s,{children:"Name"}),e.jsx(s,{children:"Description"}),e.jsx(s,{children:"Rows"}),e.jsx(s,{children:"Last Updated"}),e.jsx(i,{permission:"datasets:update,datasets:create",children:e.jsx(s,{children:" "})}),e.jsx(i,{permission:"datasets:delete",children:e.jsx(s,{children:" "})})]})}),e.jsx(xe,{children:b?e.jsxs(e.Fragment,{children:[e.jsxs(f,{children:[e.jsx(n,{children:e.jsx(r,{variant:"text"})}),e.jsx(n,{children:e.jsx(r,{variant:"text"})}),e.jsx(n,{children:e.jsx(r,{variant:"text"})}),e.jsx(n,{children:e.jsx(r,{variant:"text"})}),e.jsx(i,{permission:"datasets:update,datasets:create",children:e.jsx(r,{variant:"text"})}),e.jsx(i,{permission:"datasets:delete",children:e.jsx(r,{variant:"text"})})]}),e.jsxs(f,{children:[e.jsx(n,{children:e.jsx(r,{variant:"text"})}),e.jsx(n,{children:e.jsx(r,{variant:"text"})}),e.jsx(n,{children:e.jsx(r,{variant:"text"})}),e.jsx(n,{children:e.jsx(r,{variant:"text"})}),e.jsx(i,{permission:"datasets:update,datasets:create",children:e.jsx(r,{variant:"text"})}),e.jsx(i,{permission:"datasets:delete",children:e.jsx(r,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:v.filter(J).map((t,a)=>e.jsxs(f,{hover:!0,sx:{cursor:"pointer","&:last-child td, &:last-child th":{border:0}},children:[e.jsx(s,{onClick:()=>d(t),component:"th",scope:"row",children:t.name}),e.jsx(s,{onClick:()=>d(t),style:{wordWrap:"break-word",flexWrap:"wrap",width:"40%"},children:he(t==null?void 0:t.description,200)}),e.jsx(s,{onClick:()=>d(t),children:t==null?void 0:t.rowCount}),e.jsx(s,{onClick:()=>d(t),children:ue(t.updatedDate).format("MMMM Do YYYY, hh:mm A")}),e.jsx(i,{permission:"datasets:update,datasets:create",children:e.jsx(s,{children:e.jsx(P,{title:"Edit",color:"primary",onClick:()=>O(t),children:e.jsx(ke,{})})})}),e.jsx(i,{permission:"datasets:delete",children:e.jsx(s,{children:e.jsx(P,{title:"Delete",color:"error",onClick:()=>X(t),children:e.jsx(Ee,{})})})})]},a))})})]})}),e.jsx(we,{currentPage:h,limit:p,total:q,onChange:U})]})]})}),e.jsx(De,{show:_,dialogProps:V,onCancel:()=>l(!1),onConfirm:k}),e.jsx(ge,{})]})};export{Qe as default};
