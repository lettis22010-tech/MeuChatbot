import{a as dt,o as ct,p as xt,u as pt,R as Re,b as ut,b7 as ht,r as o,c as P,j as e,M as mt,S as O,B as s,g as Z,l as a,n as c,b8 as ee,b9 as h,ba as Oe,bb as gt,aa as te,bc as Fe,a1 as F,bd as yt,D as Be,h as $e,k as Le,be as ae,bf as Ne,m as qe,av as w,bg as jt,bh as Ue,E as j,bi as We,bj as Qe,J as ft,K as bt}from"./index-B1XR3Coy.js";import{v as vt}from"./validation-DNbaeON5.js";import{E as St}from"./ErrorBoundary-WOMkE_83.js";import{V as wt}from"./ViewHeader-jo2V0q71.js";import{S as z}from"./settings-ClEiD2Lp.js";import{S as I}from"./Skeleton-BQAmmov-.js";import{T as Ye}from"./TextField-BEeUeVUl.js";import"./IconCopy-BBl1XuSo.js";import"./StyledFab-BqTal21_.js";import"./IconSearch-BzBgax5m.js";import"./FormControl-Cb0ROeST.js";import"./InputLabel-HPVYUEFn.js";const Ke=(p,B)=>Math.min(p/B*100,100),Ot=()=>{var ve,Se,we,Ce,Pe,Ie,De,ke,Ae,_e,Me,ze,Ee,Te;const p=dt(),B=ct();xt();const se=pt(),r=Re(t=>t.auth.user),Ve=Re(t=>t.customization),{error:ie,setError:ne}=ut(),{isCloud:Q}=ht(),[He,Je]=o.useState(!0),[re,oe]=o.useState(""),[le,de]=o.useState(""),[Y,ce]=o.useState(""),[D,Xe]=o.useState(""),[$,Ge]=o.useState(""),[d,Ze]=o.useState(null),[K,xe]=o.useState(!1),[pe,ue]=o.useState(!1),[m,E]=o.useState(0),[n,L]=o.useState(null),[v,he]=o.useState(!1),[me,V]=o.useState(!1),[H,T]=o.useState(!1),[J,X]=o.useState(!1),[ge,et]=o.useState(0),[f,tt]=o.useState(0),[N,at]=o.useState(0),[q,st]=o.useState(0),k=o.useMemo(()=>{var t,i;return d?Ke((t=d.predictions)==null?void 0:t.usage,(i=d.predictions)==null?void 0:i.limit):0},[d]),A=o.useMemo(()=>{var t,i;return d?Ke((t=d.storage)==null?void 0:t.usage,(i=d.storage)==null?void 0:i.limit):0},[d]),g=(...t)=>B(ft(...t)),y=(...t)=>B(bt(...t)),b=P(w.getUserById),U=P(jt.getPricingPlans),u=P(w.getAdditionalSeatsQuantity),S=P(w.getAdditionalSeatsProration),l=P(w.getCustomerDefaultSource),it=P(w.updateAdditionalSeats),W=P(w.getCurrentUsage);o.useEffect(()=>{Q&&(b.request(r.id),U.request(),u.request(r==null?void 0:r.activeOrganizationSubscriptionId),W.request())},[Q]),o.useEffect(()=>{Je(b.loading)},[b.loading]),o.useEffect(()=>{var t,i,x;try{b.data&&(oe(((t=b.data)==null?void 0:t.name)||""),de(((i=b.data)==null?void 0:i.email)||""),ce(((x=b.data)==null?void 0:x.email)||""))}catch(C){console.error(C)}},[b.data]),o.useEffect(()=>{W.data&&Ze(W.data)},[W.data]),o.useEffect(()=>{(H||J)&&(E(0),l.request(r==null?void 0:r.activeOrganizationCustomerId))},[H,J]),o.useEffect(()=>{S.data&&L(S.data)},[S.data]),o.useEffect(()=>{var t,i,x;if(!u.loading&&u.data){const C=((t=u.data)==null?void 0:t.includedSeats)||1,M=((i=u.data)==null?void 0:i.quantity)||0,lt=((x=u.data)==null?void 0:x.totalOrgUsers)||1;et(C),tt(M),at(lt),st(C+M)}},[u.data,u.loading]);const _=o.useMemo(()=>{if(!U.data)return"";const t=U.data.find(i=>i.prodId===(r==null?void 0:r.activeOrganizationProductId));return(t==null?void 0:t.title)||""},[U.data,r==null?void 0:r.activeOrganizationProductId]),nt=async()=>{ue(!0);try{const t={email:Y};(await Ue.cancelSubscription(t)).status===200&&g({message:`Instruction to cancel subscription has been sent to ${Y}`,options:{key:new Date().getTime()+Math.random(),variant:"success",action:x=>e.jsx(c,{style:{color:"white"},onClick:()=>y(x),children:e.jsx(j,{})})}})}catch{g({message:"Failed to access billing portal",options:{key:new Date().getTime()+Math.random(),variant:"error",action:i=>e.jsx(c,{style:{color:"white"},onClick:()=>y(i),children:e.jsx(j,{})})}})}finally{ue(!1)}},G=async()=>{var t;xe(!0);try{const i=await Ue.getBillingData();(t=i.data)!=null&&t.url&&window.open(i.data.url,"_blank")}catch{g({message:"Failed to access billing portal",options:{key:new Date().getTime()+Math.random(),variant:"error",action:x=>e.jsx(c,{style:{color:"white"},onClick:()=>y(x),children:e.jsx(j,{})})}})}finally{xe(!1)}},rt=async()=>{try{const t={id:r.id,name:re,email:le},i=await w.updateUser(t);i.data&&(We.dispatch(Qe(i.data)),g({message:"Profile updated",options:{key:new Date().getTime()+Math.random(),variant:"success",action:x=>e.jsx(c,{style:{color:"white"},onClick:()=>y(x),children:e.jsx(j,{})})}}))}catch(t){ne(t),g({message:`Failed to update profile: ${typeof t.response.data=="object"?t.response.data.message:t.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:i=>e.jsx(c,{style:{color:"white"},onClick:()=>y(i),children:e.jsx(j,{})})}})}},ot=async()=>{try{const t=[];D!==$&&t.push("New Password and Confirm Password do not match");const i=vt(D);if(i.length>0&&t.push(...i),t.length>0){g({message:t.join(", "),options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:M=>e.jsx(c,{style:{color:"white"},onClick:()=>y(M),children:e.jsx(j,{})})}});return}const x={id:r.id,password:D},C=await w.updateUser(x);C.data&&(We.dispatch(Qe(C.data)),g({message:"Password updated",options:{key:new Date().getTime()+Math.random(),variant:"success",action:M=>e.jsx(c,{style:{color:"white"},onClick:()=>y(M),children:e.jsx(j,{})})}}))}catch(t){ne(t),g({message:`Failed to update password: ${typeof t.response.data=="object"?t.response.data.message:t.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:i=>e.jsx(c,{style:{color:"white"},onClick:()=>y(i),children:e.jsx(j,{})})}})}},ye=async t=>{try{if(he(!0),!(n!=null&&n.prorationDate))throw new Error("No proration date available");await it.request(r==null?void 0:r.activeOrganizationSubscriptionId,t,n.prorationDate),g({message:"Seats updated successfully",options:{key:new Date().getTime()+Math.random(),variant:"success",action:i=>e.jsx(c,{style:{color:"white"},onClick:()=>y(i),children:e.jsx(j,{})})}}),u.request(r==null?void 0:r.activeOrganizationSubscriptionId)}catch(i){console.error("Error updating seats:",i),g({message:`Failed to update seats: ${typeof i.response.data=="object"?i.response.data.message:i.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:x=>e.jsx(c,{style:{color:"white"},onClick:()=>y(x),children:e.jsx(j,{})})}})}finally{he(!1),L(null),X(!1),T(!1),E(0)}},je=(t,i)=>{E(t);const x=i==="add"?f+t:f-t;r!=null&&r.activeOrganizationSubscriptionId&&S.request(r.activeOrganizationSubscriptionId,x)},fe=()=>{v||(L(null),T(!1),E(0))},be=()=>{v||(L(null),X(!1),E(0))},R=Math.min(f,q-N);return e.jsxs(mt,{maxWidth:"md",children:[ie?e.jsx(St,{error:ie}):e.jsxs(O,{flexDirection:"column",sx:{gap:4},children:[e.jsx(wt,{title:"Account Settings"}),He&&!b.data?e.jsxs(s,{display:"flex",flexDirection:"column",gap:Z,children:[e.jsx(I,{width:"25%",height:32}),e.jsxs(s,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(I,{width:"20%"}),e.jsx(I,{variant:"rounded",height:56})]}),e.jsxs(s,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(I,{width:"20%"}),e.jsx(I,{variant:"rounded",height:56})]}),e.jsxs(s,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(I,{width:"20%"}),e.jsx(I,{variant:"rounded",height:56})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{title:"Subscription & Billing",children:e.jsxs(s,{sx:{width:"100%",display:"grid",gridTemplateColumns:"repeat(3, 1fr)"},children:[e.jsxs(s,{sx:{gridColumn:"span 2 / span 2",display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"center",gap:1,px:2.5,py:2},children:[_&&e.jsxs(O,{sx:{alignItems:"center"},flexDirection:"row",children:[e.jsx(a,{variant:"body2",children:"Current Organization Plan:"}),e.jsx(a,{sx:{ml:1,color:p.palette.success.dark},variant:"h3",children:_.toUpperCase()})]}),e.jsx(a,{sx:{opacity:Ve.isDarkMode?.7:1},variant:"body2",color:"text.secondary",children:"Update your billing details and subscription"})]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"end",px:2.5,py:2,gap:2},children:[e.jsx(c,{variant:"outlined",endIcon:!K&&e.jsx(ee,{}),disabled:!r.isOrganizationAdmin||K,onClick:G,sx:{borderRadius:2,height:40},children:K?e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(h,{size:16,color:"inherit"}),"Loading"]}):"Billing"}),e.jsx(c,{variant:"contained",sx:{mr:1,ml:2,minWidth:160,height:40,borderRadius:15,background:t=>`linear-gradient(90deg, ${t.palette.primary.main} 10%, ${t.palette.secondary.main} 100%)`,color:t=>t.palette.secondary.contrastText,boxShadow:"0 2px 4px rgba(0,0,0,0.2)",transition:"all 0.3s ease","&:hover":{background:t=>`linear-gradient(90deg, ${Oe(t.palette.primary.main,.1)} 10%, ${Oe(t.palette.secondary.main,.1)} 100%)`,boxShadow:"0 4px 8px rgba(0,0,0,0.3)"}},endIcon:e.jsx(gt,{}),disabled:!r.isOrganizationAdmin,onClick:()=>V(!0),children:"Change Plan"})]})]})}),e.jsx(z,{title:"Seats",children:e.jsxs(s,{sx:{width:"100%",display:"grid",gridTemplateColumns:"repeat(3, 1fr)"},children:[e.jsxs(s,{sx:{gridColumn:"span 2 / span 2",display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"center",gap:1,px:2.5,py:2},children:[e.jsxs(O,{sx:{alignItems:"center"},flexDirection:"row",children:[e.jsx(a,{variant:"body2",children:"Seats Included in Plan:"}),e.jsx(a,{sx:{ml:1,color:"inherit"},variant:"h3",children:u.loading?e.jsx(h,{size:16}):ge})]}),e.jsxs(O,{sx:{alignItems:"center"},flexDirection:"row",children:[e.jsx(a,{variant:"body2",children:"Additional Seats Purchased:"}),e.jsx(a,{sx:{ml:1,color:p.palette.success.dark},variant:"h3",children:u.loading?e.jsx(h,{size:16}):f})]}),e.jsxs(O,{sx:{alignItems:"center"},flexDirection:"row",children:[e.jsx(a,{variant:"body2",children:"Occupied Seats:"}),e.jsx(a,{sx:{ml:1,color:"inherit"},variant:"h3",children:u.loading?e.jsx(h,{size:16}):`${N}/${q}`})]})]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"end",gap:2,px:2.5,py:2},children:[((ve=u.data)==null?void 0:ve.quantity)>0&&_.toUpperCase()==="PRO"&&e.jsx(c,{variant:"outlined",disabled:!r.isOrganizationAdmin||!((Se=u.data)!=null&&Se.quantity),onClick:()=>{T(!0)},color:"error",sx:{borderRadius:2,height:40},children:"Remove Seats"}),e.jsx(te,{variant:"contained",disabled:!r.isOrganizationAdmin,onClick:()=>{_.toUpperCase()==="PRO"?X(!0):V(!0)},title:"Add Seats is available only for PRO plan",sx:{borderRadius:2,height:40},children:"Add Seats"})]})]})}),e.jsx(z,{title:"Usage",children:e.jsxs(s,{sx:{width:"100%",display:"grid",gridTemplateColumns:"repeat(2, 1fr)"},children:[e.jsxs(s,{sx:{p:2.5,borderRight:1,borderColor:p.palette.grey[900]+25},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(a,{variant:"h3",children:"Predictions"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:`${((we=d==null?void 0:d.predictions)==null?void 0:we.usage)||0} / ${((Ce=d==null?void 0:d.predictions)==null?void 0:Ce.limit)||0}`})]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(s,{sx:{width:"100%",mr:1},children:e.jsx(Fe,{sx:{height:10,borderRadius:5,"& .MuiLinearProgress-bar":{backgroundColor:t=>k>90?t.palette.error.main:k>75?t.palette.warning.main:k>50?t.palette.success.light:t.palette.success.main}},value:k>100?100:k,variant:"determinate"})}),e.jsx(a,{variant:"body2",color:"text.secondary",children:`${k.toFixed(2)}%`})]})]}),e.jsxs(s,{sx:{p:2.5},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(a,{variant:"h3",children:"Storage"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:`${(((Pe=d==null?void 0:d.storage)==null?void 0:Pe.usage)||0).toFixed(2)}MB / ${(((Ie=d==null?void 0:d.storage)==null?void 0:Ie.limit)||0).toFixed(2)}MB`})]}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(s,{sx:{width:"100%",mr:1},children:e.jsx(Fe,{sx:{height:10,borderRadius:5,"& .MuiLinearProgress-bar":{backgroundColor:t=>A>90?t.palette.error.main:A>75?t.palette.warning.main:A>50?t.palette.success.light:t.palette.success.main}},value:A>100?100:A,variant:"determinate"})}),e.jsx(a,{variant:"body2",color:"text.secondary",children:`${A.toFixed(2)}%`})]})]})]})}),e.jsx(z,{action:e.jsx(te,{onClick:rt,sx:{borderRadius:2,height:40},variant:"contained",children:"Save"}),title:"Profile",children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:Z,px:2.5,py:2},children:[e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(a,{variant:"body1",children:"Name"}),e.jsx(F,{id:"name",type:"string",fullWidth:!0,placeholder:"Your Name",name:"name",onChange:t=>oe(t.target.value),value:re})]}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(a,{variant:"body1",children:"Email Address"}),e.jsx(F,{id:"email",type:"string",fullWidth:!0,placeholder:"Email Address",name:"email",onChange:t=>de(t.target.value),value:le})]})]})}),!r.isSSO&&e.jsx(z,{action:e.jsx(te,{disabled:!D||!$||D!==$,onClick:ot,sx:{borderRadius:2,height:40},variant:"contained",children:"Save"}),title:"Security",children:e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:Z,px:2.5,py:2},children:[e.jsxs(s,{sx:{gridColumn:"span 2 / span 2",display:"flex",flexDirection:"column",gap:1},children:[e.jsx(a,{variant:"body1",children:"New Password"}),e.jsx(F,{id:"newPassword",type:"password",fullWidth:!0,placeholder:"New Password",name:"newPassword",onChange:t=>Xe(t.target.value),value:D}),e.jsx(a,{variant:"caption",children:e.jsx("i",{children:"Password must be at least 8 characters long and contain at least one lowercase letter, one uppercase letter, one digit, and one special character."})})]}),e.jsxs(s,{sx:{gridColumn:"span 2 / span 2",display:"flex",flexDirection:"column",gap:1},children:[e.jsx(a,{variant:"body1",children:"Confirm Password"}),e.jsx(F,{id:"confirmPassword",type:"password",fullWidth:!0,placeholder:"Confirm Password",name:"confirmPassword",onChange:t=>Ge(t.target.value),value:$})]})]})}),e.jsx(z,{title:"Cancel Previous Subscription",children:e.jsxs(s,{sx:{width:"100%",display:"grid",gridTemplateColumns:"repeat(3, 1fr)"},children:[e.jsxs(s,{sx:{gridColumn:"span 2 / span 2",display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"center",gap:1,px:2.5,py:2},children:[e.jsx(a,{variant:"body2",children:"Migrate from existing cloud subscription?"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"If you have an existing cloud app like <your-app>.app.flowiseai.com, after finished migrating your work, you can cancel the previous subscription. We'll send you an email with a link to cancel your previous subscription."}),e.jsx(s,{sx:{display:"flex",flexDirection:"column",gap:1,width:"100%"},children:e.jsx(F,{id:"email",type:"string",fullWidth:!0,placeholder:"Email Address",name:"email",onChange:t=>ce(t.target.value),value:Y})})]}),e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"end",px:2.5,py:2,gap:2},children:e.jsx(c,{variant:"outlined",disabled:!r.isOrganizationAdmin||pe,onClick:nt,sx:{borderRadius:2,height:40},children:pe?e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(h,{size:16,color:"inherit"}),"Loading"]}):"Send Instructions"})})]})})]})]}),me&&Q&&e.jsx(yt,{open:me,onClose:t=>{V(!1),t&&(se("/"),se(0))}}),e.jsxs(Be,{fullWidth:!0,maxWidth:"sm",open:H,onClose:fe,children:[e.jsx($e,{variant:"h4",children:"Remove Additional Seats"}),e.jsx(Le,{children:e.jsxs(s,{sx:{mt:2,display:"flex",flexDirection:"column",gap:3},children:[R===0?e.jsxs(a,{color:"error",sx:{p:2,borderRadius:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ae,{size:20}),"You must remove users from your organization before removing seats."]}):e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2,backgroundColor:p.palette.background.paper,borderRadius:1,p:2},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",children:"Occupied Seats"}),e.jsx(a,{variant:"body2",children:N})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",children:"Empty Seats"}),e.jsx(a,{variant:"body2",children:R})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",children:"Number of Empty Seats to Remove"}),e.jsx(Ye,{size:"small",type:"number",value:m,onChange:t=>{const i=Math.max(0,Math.min(R,parseInt(t.target.value)||0));je(i,"remove")},onKeyDown:t=>{(t.key==="-"||t.key==="e")&&t.preventDefault()},InputProps:{inputProps:{min:0,max:R,step:1}},sx:{width:"70px"},disabled:!l.data})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pt:1.5,borderTop:`1px solid ${p.palette.divider}`},children:[e.jsx(a,{variant:"h5",children:"New Total Seats"}),e.jsx(a,{variant:"h5",children:q-m})]})]}),S.loading&&e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(h,{size:16})}),l.loading?e.jsx(h,{size:20}):(ke=(De=l.data)==null?void 0:De.invoice_settings)!=null&&ke.default_payment_method?e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1,p:2},children:[e.jsx(a,{variant:"subtitle2",children:"Payment Method"}),e.jsx(s,{sx:{display:"flex",alignItems:"center",gap:1},children:l.data.invoice_settings.default_payment_method.card&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{size:20,stroke:1.5,color:p.palette.primary.main}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(a,{sx:{textTransform:"capitalize"},children:l.data.invoice_settings.default_payment_method.card.brand}),e.jsxs(a,{children:["••••"," ",l.data.invoice_settings.default_payment_method.card.last4]}),e.jsxs(a,{color:"text.secondary",children:["(expires"," ",l.data.invoice_settings.default_payment_method.card.exp_month,"/",l.data.invoice_settings.default_payment_method.card.exp_year,")"]})]})]})})]}):e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2,p:2},children:[e.jsxs(a,{color:"error",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ae,{size:20}),"No payment method found"]}),e.jsx(c,{variant:"contained",endIcon:e.jsx(ee,{}),onClick:()=>{T(!1),G()},children:"Add Payment Method in Billing Portal"})]}),n&&e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2,backgroundColor:p.palette.background.paper,borderRadius:1,p:2},children:[e.jsxs(a,{variant:"body2",color:"text.secondary",children:[new Date(n.currentPeriodStart*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric"})," ","-"," ",new Date(n.currentPeriodEnd*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",children:_}),e.jsxs(a,{variant:"body2",children:[n.currency," ",Math.max(0,n.basePlanAmount).toFixed(2)]})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(s,{children:[e.jsx(a,{variant:"body2",children:"Additional Seats Left (Prorated)"}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Qty ",f-m]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsxs(a,{variant:"body2",children:[n.currency," ",Math.max(0,n.additionalSeatsProratedAmount).toFixed(2)]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[n.currency," ",n.seatPerUnitPrice.toFixed(2)," each"]})]})]}),n.prorationAmount<0&&e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",children:"Credit balance"}),e.jsxs(a,{variant:"body2",color:n.prorationAmount<0?"success.main":"error.main",children:[n.currency," ",n.prorationAmount<0?"+":"",Math.abs(n.prorationAmount).toFixed(2)]})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pt:1.5,borderTop:`1px solid ${p.palette.divider}`},children:[e.jsx(a,{variant:"h5",children:"Due today"}),e.jsxs(a,{variant:"h5",children:[n.currency," ",Math.max(0,n.prorationAmount).toFixed(2)]})]}),n.prorationAmount<0&&e.jsx(a,{variant:"body2",sx:{color:"info.main",fontStyle:"italic"},children:"Your available credit will automatically apply to your next invoice."})]})]})}),((_e=(Ae=l.data)==null?void 0:Ae.invoice_settings)==null?void 0:_e.default_payment_method)&&e.jsxs(qe,{children:[e.jsx(c,{onClick:fe,disabled:v,children:"Cancel"}),e.jsx(c,{variant:"outlined",onClick:()=>ye(f-m),disabled:l.loading||!l.data||S.loading||v||m===0||R===0,color:"error",children:v?e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(h,{size:16,color:"inherit"}),"Updating..."]}):"Remove Seats"})]})]}),e.jsxs(Be,{fullWidth:!0,maxWidth:"sm",open:J,onClose:be,children:[e.jsx($e,{variant:"h4",children:"Add Additional Seats"}),e.jsx(Le,{children:e.jsxs(s,{sx:{mt:2,display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2,backgroundColor:p.palette.background.paper,borderRadius:1,p:2},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",children:"Occupied Seats"}),e.jsx(a,{variant:"body2",children:N})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",children:"Seats Included with Plan"}),e.jsx(a,{variant:"body2",children:ge})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",children:"Additional Seats Purchased"}),e.jsx(a,{variant:"body2",children:f})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",children:"Number of Additional Seats to Add"}),e.jsx(Ye,{size:"small",type:"number",value:m,onChange:t=>{const i=Math.max(0,parseInt(t.target.value)||0);je(i,"add")},onKeyDown:t=>{(t.key==="-"||t.key==="e")&&t.preventDefault()},InputProps:{inputProps:{min:0}},sx:{width:"70px"},disabled:!l.data})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pt:1.5,borderTop:`1px solid ${p.palette.divider}`},children:[e.jsx(a,{variant:"h5",children:"New Total Seats"}),e.jsx(a,{variant:"h5",children:q+m})]})]}),S.loading&&e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(h,{size:16})}),l.loading?e.jsx(h,{size:20}):(ze=(Me=l.data)==null?void 0:Me.invoice_settings)!=null&&ze.default_payment_method?e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:1,p:2},children:[e.jsx(a,{variant:"subtitle2",children:"Payment Method"}),e.jsx(s,{sx:{display:"flex",alignItems:"center",gap:1},children:l.data.invoice_settings.default_payment_method.card&&e.jsxs(e.Fragment,{children:[e.jsx(Ne,{size:20,stroke:1.5,color:p.palette.primary.main}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(a,{sx:{textTransform:"capitalize"},children:l.data.invoice_settings.default_payment_method.card.brand}),e.jsxs(a,{children:["••••"," ",l.data.invoice_settings.default_payment_method.card.last4]}),e.jsxs(a,{color:"text.secondary",children:["(expires"," ",l.data.invoice_settings.default_payment_method.card.exp_month,"/",l.data.invoice_settings.default_payment_method.card.exp_year,")"]})]})]})})]}):e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2,p:2},children:[e.jsxs(a,{color:"error",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ae,{size:20}),"No payment method found"]}),e.jsx(c,{variant:"contained",endIcon:e.jsx(ee,{}),onClick:()=>{T(!1),G()},children:"Add Payment Method in Billing Portal"})]}),n&&e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:2,backgroundColor:p.palette.background.paper,borderRadius:1,p:2},children:[e.jsxs(a,{variant:"body2",color:"text.secondary",children:[new Date(n.currentPeriodStart*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric"})," ","-"," ",new Date(n.currentPeriodEnd*1e3).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",children:_}),e.jsxs(a,{variant:"body2",children:[n.currency," ",n.basePlanAmount.toFixed(2)]})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(s,{children:[e.jsx(a,{variant:"body2",children:"Additional Seats (Prorated)"}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Qty ",m+f]})]}),e.jsxs(s,{sx:{textAlign:"right"},children:[e.jsxs(a,{variant:"body2",children:[n.currency," ",n.additionalSeatsProratedAmount.toFixed(2)]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[n.currency," ",n.seatPerUnitPrice.toFixed(2)," each"]})]})]}),n.creditBalance!==0&&e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(a,{variant:"body2",children:"Applied account balance"}),e.jsxs(a,{variant:"body2",color:n.creditBalance<0?"success.main":"error.main",children:[n.currency," ",n.creditBalance.toFixed(2)]})]}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pt:1.5,borderTop:`1px solid ${p.palette.divider}`},children:[e.jsx(a,{variant:"h5",children:"Due today"}),e.jsxs(a,{variant:"h5",children:[n.currency," ",Math.max(0,n.prorationAmount+n.creditBalance).toFixed(2)]})]}),n.prorationAmount===0&&n.creditBalance<0&&e.jsx(a,{variant:"body2",sx:{color:"info.main",fontStyle:"italic"},children:"Your available credit will automatically apply to your next invoice."})]})]})}),((Te=(Ee=l.data)==null?void 0:Ee.invoice_settings)==null?void 0:Te.default_payment_method)&&e.jsxs(qe,{children:[e.jsx(c,{onClick:be,disabled:v,children:"Cancel"}),e.jsx(c,{variant:"contained",onClick:()=>ye(m+f),disabled:l.loading||!l.data||S.loading||v||m===0,children:v?e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(h,{size:16,color:"inherit"}),"Updating..."]}):"Add Seats"})]})]})]})};export{Ot as default};
