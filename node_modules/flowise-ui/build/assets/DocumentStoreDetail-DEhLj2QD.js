import{P as I,o as Te,a as se,r as n,c as Y,q as ft,H as Ie,j as e,D as oe,h as re,k as ne,B as ie,a1 as gt,E as F,aA as jt,aB as yt,d as V,l as U,s as le,aq as vt,ar as Ct,a7 as St,a3 as bt,U as Me,V as ze,W as Le,Y as Ne,O as K,L as Ve,m as Dt,n as E,S as q,ag as kt,f as W,i as H,t as de,N as Re,v as wt,w as It,R as Rt,u as _t,Q as _e,p as Et,b as At,ak as $t,M as Tt,$ as Mt,e as zt,x as Oe,a2 as A,a6 as w,z as Be,ax as Lt,C as ae,aa as Nt,X as Vt,ac as T,aC as Ot,J as Bt,K as Ft}from"./index-B1XR3Coy.js";import{D as Pt,A as qt}from"./AddDocStoreDialog-BZe2F3X3.js";import{B as Ut}from"./BackdropLoader-C982mQas.js";import{d as P}from"./documentstore-GQ_lrBF1.js";import{I as Ee}from"./InputAdornment-D6_duzKN.js";import{b as Wt}from"./IconSearch-BzBgax5m.js";import{E as Ht}from"./ErrorBoundary-WOMkE_83.js";import{V as Gt}from"./ViewHeader-jo2V0q71.js";import{d as Fe}from"./ExpandMore-BP5oMSwT.js";import{T as Pe}from"./Table-CcAGPqUI.js";import{n as Jt}from"./nodes-D-x6LTqi.js";import{v as Yt}from"./v4-D8aEg3BZ.js";import{A as qe,d as Ue,e as We,M as Kt}from"./MemoizedReactMarkdown-CNH2mkE4.js";import{u as Xt,C as Qt}from"./ConfirmDialog-Bksga_et.js";import{d as He}from"./Delete-CvnCkEIf.js";import{d as Zt}from"./Edit-BFCL8ZvY.js";import{I as ea}from"./IconRefresh-B2aTlEaU.js";import{I as Ae}from"./IconPlus-DpyX5kZB.js";import{S as C}from"./Skeleton-BQAmmov-.js";import"./IconCopy-BBl1XuSo.js";import"./StyledFab-BqTal21_.js";import"./TooltipWithParser-C72LCUcD.js";import"./index-D--Rb2MU.js";import"./Tooltip-9ICsuaYn.js";import"./toPropertyKey-hKuLU48H.js";const Ge=({show:a,dialogProps:o,onCancel:m,onDocLoaderSelected:j})=>{const $=document.getElementById("portal"),S=Te(),p=se(),[f,d]=n.useState(""),[M,b]=n.useState([]),h=Y(P.getDocumentLoaders),R=c=>{d(c)};function D(c){return c.name.toLowerCase().indexOf(f.toLowerCase())>-1}n.useEffect(()=>{o.documentLoaders&&b(o.documentLoaders)},[o]),n.useEffect(()=>{h.request()},[]),n.useEffect(()=>{h.data&&b(h.data)},[h.data]),n.useEffect(()=>(S(a?{type:ft}:{type:Ie}),()=>S({type:Ie})),[a,S]);const z=a?e.jsxs(oe,{fullWidth:!0,maxWidth:"md",open:a,onClose:m,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(re,{sx:{fontSize:"1rem",p:3,pb:0},id:"alert-dialog-title",children:o.title}),e.jsxs(ne,{sx:{display:"flex",flexDirection:"column",gap:2,maxHeight:"75vh",position:"relative",px:3,pb:3},children:[e.jsx(ie,{sx:{backgroundColor:p.palette.background.paper,pt:2,position:"sticky",top:0,zIndex:10},children:e.jsx(gt,{sx:{width:"100%",pr:2,pl:2,position:"sticky"},id:"input-search-credential",value:f,onChange:c=>R(c.target.value),placeholder:"Search",startAdornment:e.jsx(Ee,{position:"start",children:e.jsx(Wt,{stroke:1.5,size:"1rem",color:p.palette.grey[500]})}),endAdornment:e.jsx(Ee,{position:"end",sx:{cursor:"pointer",color:p.palette.grey[500],"&:hover":{color:p.palette.grey[900]}},title:"Clear Search",children:e.jsx(F,{stroke:1.5,size:"1rem",onClick:()=>R(""),style:{cursor:"pointer"}})}),"aria-describedby":"search-helper-text",inputProps:{"aria-label":"weight"}})}),e.jsx(jt,{sx:{width:"100%",display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,py:0,zIndex:9,borderRadius:"10px",[p.breakpoints.down("md")]:{maxWidth:370}},children:[...M].filter(D).map(c=>e.jsxs(yt,{alignItems:"center",onClick:()=>j(c.name),sx:{border:1,borderColor:p.palette.grey[900]+25,borderRadius:2,display:"flex",alignItems:"center",justifyContent:"start",textAlign:"left",gap:1,p:2},children:[e.jsx("div",{style:{width:50,height:50,borderRadius:"50%",backgroundColor:"white",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:c.name,src:`${V}/api/v1/node-icon/${c.name}`})}),e.jsx(U,{children:c.label})]},c.name))})]})]}):null;return le.createPortal(z,$)};Ge.propTypes={show:I.bool,dialogProps:I.object,onCancel:I.func,onDocLoaderSelected:I.func};const Je=({show:a,dialogProps:o,onCancel:m,onDelete:j})=>{const $=document.getElementById("portal"),[S,p]=n.useState({}),[f,d]=n.useState(!1),[M,b]=n.useState([]),[h,R]=n.useState([]),D=Y(Jt.getSpecificNode),z=r=>(i,t)=>{const v={...S};v[r]=t,p(v)};n.useEffect(()=>{if(o.recordManagerConfig){const r=o.recordManagerConfig.name;if(r&&D.request(r),o.vectorStoreConfig){const i=o.vectorStoreConfig.name;i&&D.request(i)}}return()=>{p({}),d(!1),b([]),R([])}},[o]),n.useEffect(()=>{if(D.data){const r=vt.cloneDeep(Ct(D.data,Yt()));let i="vectorStoreConfig";r.category==="Record Manager"&&(i="recordManagerConfig");const t=[];for(const v in o[i].config){const x=r.inputParams.find(L=>L.name===v);if(!x||x.type==="credential")continue;let _={};const y=o[i].config[v];y&&(typeof y=="string"&&y.startsWith("{{")&&y.endsWith("}}")||(_={label:x==null?void 0:x.label,name:x==null?void 0:x.name,type:x==null?void 0:x.type,value:y},t.push(_)))}i==="vectorStoreConfig"?b([{label:r.label,name:r.name,category:r.category,id:r.id,paramValues:t}]):i==="recordManagerConfig"&&R([{label:r.label,name:r.name,category:r.category,id:r.id,paramValues:t}])}},[D.data]);const c=a?e.jsxs(oe,{fullWidth:!0,maxWidth:o.recordManagerConfig?"md":"sm",open:a,onClose:m,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(re,{sx:{fontSize:"1rem",p:3,pb:0},id:"alert-dialog-title",children:o.title}),e.jsxs(ne,{sx:{display:"flex",flexDirection:"column",gap:2,maxHeight:"75vh",position:"relative",px:3,pb:3},children:[e.jsx("span",{style:{marginTop:"20px"},children:o.description}),o.type==="STORE"&&o.recordManagerConfig&&e.jsx(St,{control:e.jsx(bt,{checked:f,onChange:r=>d(r.target.checked)}),label:"Remove data from vector store and record manager"}),f&&e.jsxs("div",{children:[e.jsx(Me,{component:ze,children:e.jsx(Le,{sx:{minWidth:650},"aria-label":"simple table",children:e.jsx(Ne,{children:e.jsx(K,{sx:{"& td":{border:0}},children:e.jsx(Ve,{sx:{pb:0,pt:0},colSpan:6,children:e.jsx(ie,{children:[...M,...h].map((r,i)=>e.jsxs(qe,{expanded:S[r.name]||!0,onChange:z(r.name),disableGutters:!0,children:[e.jsx(Ue,{expandIcon:e.jsx(Fe,{}),"aria-controls":`nodes-accordian-${r.name}`,id:`nodes-accordian-header-${r.name}`,children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx("div",{style:{width:40,height:40,marginRight:10,borderRadius:"50%",backgroundColor:"white"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:r.name,src:`${V}/api/v1/node-icon/${r.name}`})}),e.jsx(U,{variant:"h5",children:r.label})]})}),e.jsx(We,{children:r.paramValues[0]&&e.jsx(Pe,{sx:{minWidth:150},rows:r.paramValues,columns:Object.keys(r.paramValues[0])})})]},i))})})})})})}),e.jsx("span",{style:{marginTop:"30px",fontStyle:"italic",color:"#b35702"},children:"* Only data that were upserted with Record Manager will be deleted from vector store"})]})]}),e.jsxs(Dt,{sx:{pr:3,pb:3},children:[e.jsx(E,{onClick:m,color:"primary",children:"Cancel"}),e.jsx(E,{variant:"contained",onClick:()=>j(o.type,o.file,f),color:"error",children:"Delete"})]})]}):null;return le.createPortal(c,$)};Je.propTypes={show:I.bool,dialogProps:I.object,onCancel:I.func,onDelete:I.func};const Ye=({show:a,dialogProps:o,onCancel:m})=>{const[j,$]=n.useState({}),[S,p]=n.useState(""),f=se(),[d,M]=n.useState({}),b=Y(P.getDocumentStoreConfig),h=()=>`With the Upsert API, you can choose an existing document and reuse the same configuration for upserting.

\`\`\`python
import requests
import json

API_URL = "${V}/api/v1/document-store/upsert/${o.storeId}"
API_KEY = "your_api_key_here"

# use form data to upload files
form_data = {
    "files": ('my-another-file.pdf', open('my-another-file.pdf', 'rb'))
}

body_data = {
    "docId": "${o.loaderId}",
    "metadata": {}, # Add additional metadata to the document chunks
    "replaceExisting": True, # Replace existing document with the new upserted chunks
    "createNewDocStore": False, # Create a new document store
    "splitter": json.dumps({"config":{"chunkSize":20000}}) # Override existing configuration
    # "loader": "",
    # "vectorStore": "",
    # "embedding": "",
    # "recordManager": "",
    # "docStore": ""
}

headers = {
    "Authorization": f"Bearer {BEARER_TOKEN}"
}

def query(form_data):
    response = requests.post(API_URL, files=form_data, data=body_data, headers=headers)
    print(response)
    return response.json()

output = query(form_data)
print(output)
\`\`\`

\`\`\`javascript
// use FormData to upload files
let formData = new FormData();
formData.append("files", input.files[0]);
formData.append("docId", "${o.loaderId}");
formData.append("splitter", JSON.stringify({"config":{"chunkSize":20000}}));
// Add additional metadata to the document chunks
formData.append("metadata", "{}");
// Replace existing document with the new upserted chunks
formData.append("replaceExisting", "true");
// Create a new document store
formData.append("createNewDocStore", "false");
// Override existing configuration
// formData.append("loader", "");
// formData.append("embedding", "");
// formData.append("vectorStore", "");
// formData.append("recordManager", "");
// formData.append("docStore", "");

async function query(formData) {
    const response = await fetch(
        "${V}/api/v1/document-store/upsert/${o.storeId}",
        {
            method: "POST",
            headers: {
                "Authorization": "Bearer <your_api_key_here>"
            },
            body: formData
        }
    );
    const result = await response.json();
    return result;
}

query(formData).then((response) => {
    console.log(response);
});
\`\`\`

\`\`\`bash
curl -X POST ${V}/api/v1/document-store/upsert/${o.storeId} \\
  -H "Authorization: Bearer <your_api_key_here>" \\
  -F "files=@<file-path>" \\
  -F "docId=${o.loaderId}" \\
  -F "splitter={"config":{"chunkSize":20000}}" \\
  -F "metadata={}" \\
  -F "replaceExisting=true" \\
  -F "createNewDocStore=false" \\
  # Override existing configuration:
  # -F "loader=" \\
  # -F "embedding=" \\
  # -F "vectorStore=" \\
  # -F "recordManager=" \\
  # -F "docStore="
\`\`\`
`,R=()=>`With the Upsert API, you can choose an existing document and reuse the same configuration for upserting.
 
\`\`\`python
import requests

API_URL = "${V}/api/v1/document-store/upsert/${o.storeId}"
API_KEY = "your_api_key_here"

headers = {
    "Authorization": f"Bearer {BEARER_TOKEN}"
}

def query(payload):
    response = requests.post(API_URL, json=payload, headers=headers)
    return response.json()

output = query({
    "docId": "${o.loaderId}",
    "metadata": "{}", # Add additional metadata to the document chunks
    "replaceExisting": True, # Replace existing document with the new upserted chunks
    "createNewDocStore": False, # Create a new document store
    # Override existing configuration
    "loader": {
        "config": {
            "text": "This is a new text"
        }
    },
    "splitter": {
        "config": {
            "chunkSize": 20000
        }
    },
    # embedding: {},
    # vectorStore: {},
    # recordManager: {}
    # docStore: {}
})
print(output)
\`\`\`

\`\`\`javascript
async function query(data) {
    const response = await fetch(
        "${V}/api/v1/document-store/upsert/${o.storeId}",
        {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer <your_api_key_here>"
            },
            body: JSON.stringify(data)
        }
    );
    const result = await response.json();
    return result;
}

query({
    "docId": "${o.loaderId},
    "metadata": "{}", // Add additional metadata to the document chunks
    "replaceExisting": true, // Replace existing document with the new upserted chunks
    "createNewDocStore": false, // Create a new document store
    // Override existing configuration
    "loader": {
        "config": {
            "text": "This is a new text"
        }
    },
    "splitter": {
        "config": {
            "chunkSize": 20000
        }
    },
    // embedding: {},
    // vectorStore: {},
    // recordManager: {}
    // docStore: {}
}).then((response) => {
    console.log(response);
});
\`\`\`

\`\`\`bash
curl -X POST ${V}/api/v1/document-store/upsert/${o.storeId} \\
  -H "Content-Type: application/json" \\
  -H "Authorization: Bearer <your_api_key_here>" \\
  -d '{
        "docId": "${o.loaderId}",
        "metadata": "{}",
        "replaceExisting": true,
        "createNewDocStore": false,
        "loader": {
            "config": {
                "text": "This is a new text"
            }
        },
        "splitter": {
            "config": {
                "chunkSize": 20000
            }
        }
        // Override existing configuration
        // "embedding": {},
        // "vectorStore": {},
        // "recordManager": {}
        // "docStore": {}
      }'

\`\`\`
`,D=i=>{const t={},v=new Set;let x=!1;i.forEach(_=>{const{node:y,nodeId:L,label:X,name:G,type:J}=_;G==="files"&&(x=!0),v.add(y),t[y]||(t[y]={nodeIds:[],params:[]}),t[y].nodeIds.includes(L)||t[y].nodeIds.push(L);const O={label:X,name:G,type:J};t[y].params.some(Q=>JSON.stringify(Q)===JSON.stringify(O))||t[y].params.push(O)});for(const _ in t)t[_].nodeIds.sort();$(t),p(x?h():R())},z=i=>(t,v)=>{const x={...d};x[i]=v,M(x)};n.useEffect(()=>{b.data&&D(b.data)},[b.data]),n.useEffect(()=>{a&&o&&b.request(o.storeId,o.loaderId)},[a,o]);const c=document.getElementById("portal"),r=a?e.jsxs(oe,{onClose:m,open:a,fullWidth:!0,maxWidth:"lg","aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(re,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:o.title}),e.jsxs(ne,{children:[e.jsx(Kt,{children:S}),e.jsx(U,{sx:{mt:3,mb:1},children:"You can override existing configurations:"}),e.jsx(q,{direction:"column",spacing:2,sx:{width:"100%",my:2},children:e.jsx(kt,{sx:{borderColor:f.palette.primary[200]+75,p:2},variant:"outlined",children:Object.keys(j).sort().map(i=>e.jsxs(qe,{expanded:d[i]||!1,onChange:z(i),disableGutters:!0,children:[e.jsx(Ue,{expandIcon:e.jsx(Fe,{}),"aria-controls":`nodes-accordian-${i}`,id:`nodes-accordian-header-${i}`,children:e.jsxs(q,{flexDirection:"row",sx:{gap:2,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(U,{variant:"h5",children:i}),j[i].nodeIds.length>0&&j[i].nodeIds.map((t,v)=>e.jsx("div",{style:{display:"flex",flexDirection:"row",width:"max-content",borderRadius:15,background:"rgb(254,252,191)",padding:5,paddingLeft:10,paddingRight:10},children:e.jsx("span",{style:{color:"rgb(116,66,16)",fontSize:"0.825rem"},children:t})},v))]})}),e.jsx(We,{children:e.jsx(Pe,{rows:j[i].params.map(t=>{const{node:v,nodeId:x,..._}=t;return _}),columns:Object.keys(j[i].params[0]).slice(-3)})})]},i))})})]})]}):null;return le.createPortal(r,c)};Ye.propTypes={show:I.bool,dialogProps:I.object,onCancel:I.func};var ce={},ta=H;Object.defineProperty(ce,"__esModule",{value:!0});var ue=ce.default=void 0,aa=ta(W()),sa=e,oa=(0,aa.default)((0,sa.jsx)("path",{d:"M10 4h4v4h-4zM4 16h4v4H4zm0-6h4v4H4zm0-6h4v4H4zm10 8.42V10h-4v4h2.42zm6.88-1.13-1.17-1.17c-.16-.16-.42-.16-.58 0l-.88.88L20 12.75l.88-.88c.16-.16.16-.42 0-.58zM11 18.25V20h1.75l6.67-6.67-1.75-1.75zM16 4h4v4h-4z"}),"AppRegistration");ue=ce.default=oa;var pe={},ra=H;Object.defineProperty(pe,"__esModule",{value:!0});var he=pe.default=void 0,na=ra(W()),ia=e,la=(0,na.default)((0,ia.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 14h-3v3h-2v-3H8v-2h3v-3h2v3h3v2zm-3-7V3.5L18.5 9H13z"}),"NoteAdd");he=pe.default=la;var me={},da=H;Object.defineProperty(me,"__esModule",{value:!0});var Ke=me.default=void 0,ca=da(W()),ua=e,pa=(0,ca.default)((0,ua.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"}),"Search");Ke=me.default=pa;var xe={},ha=H;Object.defineProperty(xe,"__esModule",{value:!0});var Xe=xe.default=void 0,ma=ha(W()),xa=e,fa=(0,ma.default)((0,xa.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"}),"Refresh");Xe=xe.default=fa;var fe={},ga=H;Object.defineProperty(fe,"__esModule",{value:!0});var Qe=fe.default=void 0,ja=ga(W()),ya=e,va=(0,ja.default)((0,ya.jsx)("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"}),"Code");Qe=fe.default=va;const Ca="/assets/doc_store_details_empty-B8g8M--k.svg",l=de(Ve)(({theme:a})=>({borderColor:a.palette.grey[900]+25,padding:"6px 16px",[`&.${Re.head}`]:{color:a.palette.grey[900]},[`&.${Re.body}`]:{fontSize:14,height:64}})),$e=de(K)(()=>({"&:last-child td, &:last-child th":{border:0}})),Ze=de(a=>e.jsx(wt,{elevation:0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},...a}))(({theme:a})=>({"& .MuiPaper-root":{borderRadius:6,marginTop:a.spacing(1),minWidth:180,boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px","& .MuiMenu-list":{padding:"4px 0"},"& .MuiMenuItem-root":{"& .MuiSvgIcon-root":{fontSize:18,color:a.palette.text.secondary,marginRight:a.spacing(1.5)},"&:active":{backgroundColor:It(a.palette.primary.main,a.palette.action.selectedOpacity)}}}})),Ga=()=>{var be,De,ke,we;const a=se(),o=Rt(s=>s.customization),m=_t(),j=Te(),{hasAssignedWorkspace:$}=_e();Et();const{confirm:S}=Xt(),p=(...s)=>j(Bt(...s)),f=(...s)=>j(Ft(...s)),{error:d,setError:M}=At(),{hasPermission:b}=_e(),h=Y(P.getSpecificDocumentStore),[R,D]=n.useState(!0),[z,c]=n.useState(!1),[r,i]=n.useState(!1),[t,v]=n.useState({}),[x,_]=n.useState({}),[y,L]=n.useState(!1),[X,G]=n.useState({}),[J,O]=n.useState(!1),[Q,ge]=n.useState({}),[je,ye]=n.useState(!1),[tt,at]=n.useState({}),[ve,Z]=n.useState(null),ee=!!ve,{storeId:N}=$t(),st=s=>{m("/document-stores/"+N+"/"+s)},Ce=s=>{m("/document-stores/chunks/"+N+"/"+s)},ot=s=>{m("/document-stores/query/"+s)},rt=s=>{L(!1),m("/document-stores/"+N+"/"+s)},nt=s=>{m("/document-stores/vector/"+s)},Se=()=>{G({title:"Select Document Loader"}),L(!0)},it=async s=>{try{await P.deleteVectorStoreDataFromStore(s)}catch(g){console.error(g)}},lt=async(s,g,B)=>{if(c(!0),O(!1),s==="STORE"){B&&await it(N);try{const u=await P.deleteDocumentStore(N);c(!1),u.data&&(p({message:"Store, Loader and associated document chunks deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:k=>e.jsx(E,{style:{color:"white"},onClick:()=>f(k),children:e.jsx(F,{})})}}),m("/document-stores/"))}catch(u){c(!1),M(u),p({message:`Failed to delete Document Store: ${typeof u.response.data=="object"?u.response.data.message:u.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:k=>e.jsx(E,{style:{color:"white"},onClick:()=>f(k),children:e.jsx(F,{})})}})}}else if(s==="LOADER")try{const u=await P.deleteLoaderFromStore(N,g.id);c(!1),u.data&&(p({message:"Loader and associated document chunks deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:k=>e.jsx(E,{style:{color:"white"},onClick:()=>f(k),children:e.jsx(F,{})})}}),te())}catch(u){M(u),c(!1),p({message:`Failed to delete Document Loader: ${typeof u.response.data=="object"?u.response.data.message:u.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:k=>e.jsx(E,{style:{color:"white"},onClick:()=>f(k),children:e.jsx(F,{})})}})}},dt=(s,g,B)=>{const u={title:"Delete",description:`Delete Loader ${s.loaderName} ? This will delete all the associated document chunks.`,vectorStoreConfig:g,recordManagerConfig:B,type:"LOADER",file:s};ge(u),O(!0)},ct=(s,g)=>{var u;const B={title:"Delete",description:`Delete Store ${(u=h.data)==null?void 0:u.name} ? This will delete all the associated loaders and document chunks.`,vectorStoreConfig:s,recordManagerConfig:g,type:"STORE"};ge(B),O(!0)},ut=async s=>{if(await S({title:"Refresh all loaders and upsert all chunks?",description:"This will re-process all loaders and upsert all chunks. This action might take some time.",confirmButtonName:"Refresh",cancelButtonName:"Cancel"})){Z(null),c(!0);try{(await P.refreshLoader(s)).data&&p({message:"Document store refresh successfully!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:k=>e.jsx(E,{style:{color:"white"},onClick:()=>f(k),children:e.jsx(F,{})})}}),c(!1)}catch(u){c(!1),p({message:`Failed to refresh document store: ${typeof u.response.data=="object"?u.response.data.message:u.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:k=>e.jsx(E,{style:{color:"white"},onClick:()=>f(k),children:e.jsx(F,{})})}})}}},pt=()=>{const g={title:"Edit Document Store",type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Update",data:{name:t.name,description:t.description,id:t.id}};_(g),i(!0)},te=()=>{i(!1),h.request(N)},ht=s=>{s.preventDefault(),s.stopPropagation(),Z(s.currentTarget)},mt=(s,g)=>{at({title:"Upsert API",storeId:s,loaderId:g}),ye(!0)},xt=()=>{Z(null)};return n.useEffect(()=>{h.request(N)},[]),n.useEffect(()=>{if(h.data){const s=h.data.workspaceId;if(!$(s)){m("/unauthorized");return}v(h.data)}},[h.data]),n.useEffect(()=>{D(h.loading)},[h.loading]),e.jsxs(e.Fragment,{children:[e.jsx(Tt,{children:d?e.jsx(Ht,{error:d}):e.jsxs(q,{flexDirection:"column",sx:{gap:3},children:[e.jsxs(Gt,{isBackButton:!0,isEditButton:b("documentStores:create,documentStores:update"),search:!1,title:t==null?void 0:t.name,description:t==null?void 0:t.description,onBack:()=>m("/document-stores"),onEdit:()=>pt(),children:[((t==null?void 0:t.status)==="STALE"||(t==null?void 0:t.status)==="UPSERTING")&&e.jsx(Mt,{permissionId:"documentStores:view",onClick:te,size:"small",color:"primary",title:"Refresh Document Store",children:e.jsx(ea,{})}),e.jsx(zt,{permissionId:"documentStores:add-loader",variant:"contained",sx:{ml:2,minWidth:200,borderRadius:2,height:"100%",color:"white"},startIcon:e.jsx(Ae,{}),onClick:Se,children:"Add Document Loader"}),e.jsx(E,{id:"document-store-header-action-button","aria-controls":ee?"document-store-header-menu":void 0,"aria-haspopup":"true","aria-expanded":ee?"true":void 0,variant:"outlined",disableElevation:!0,color:"secondary",onClick:ht,sx:{minWidth:150},endIcon:e.jsx(Oe,{}),children:"More Actions"}),e.jsxs(Ze,{id:"document-store-header-menu",MenuListProps:{"aria-labelledby":"document-store-header-menu-button"},anchorEl:ve,open:ee,onClose:xt,children:[e.jsxs(A,{disabled:(t==null?void 0:t.totalChunks)<=0||(t==null?void 0:t.status)==="UPSERTING",onClick:()=>Ce("all"),disableRipple:!0,children:[e.jsx(ue,{}),"View & Edit Chunks"]}),e.jsx(w,{permission:"documentStores:upsert-config",children:e.jsxs(A,{disabled:(t==null?void 0:t.totalChunks)<=0||(t==null?void 0:t.status)==="UPSERTING",onClick:()=>nt(t.id),disableRipple:!0,children:[e.jsx(he,{}),"Upsert All Chunks"]})}),e.jsxs(A,{disabled:(t==null?void 0:t.totalChunks)<=0||(t==null?void 0:t.status)!=="UPSERTED",onClick:()=>ot(t.id),disableRipple:!0,children:[e.jsx(Ke,{}),"Retrieval Query"]}),e.jsx(w,{permission:"documentStores:upsert-config",children:e.jsxs(A,{disabled:(t==null?void 0:t.totalChunks)<=0||(t==null?void 0:t.status)!=="UPSERTED",onClick:()=>ut(t.id),disableRipple:!0,title:"Re-process all loaders and upsert all chunks",children:[e.jsx(Xe,{}),"Refresh"]})}),e.jsx(Be,{sx:{my:.5}}),e.jsxs(A,{onClick:()=>ct(t.vectorStoreConfig,t.recordManagerConfig),disableRipple:!0,children:[e.jsx(He,{}),"Delete"]})]})]}),e.jsx(Pt,{status:t==null?void 0:t.status}),((De=(be=h.data)==null?void 0:be.whereUsed)==null?void 0:De.length)>0&&e.jsxs(q,{flexDirection:"row",sx:{gap:2,alignItems:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{paddingLeft:"15px",paddingRight:"15px",paddingTop:"10px",paddingBottom:"10px",fontSize:"0.9rem",width:"max-content",display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Lt,{style:{marginRight:5},size:17}),"Chatflows Used:"]}),h.data.whereUsed.map((s,g)=>e.jsx(ae,{clickable:!0,style:{width:"max-content",borderRadius:"25px",boxShadow:o.isDarkMode?"0 2px 14px 0 rgb(255 255 255 / 10%)":"0 2px 14px 0 rgb(32 40 45 / 10%)"},label:s.name,onClick:()=>m("/canvas/"+s.id)},g))]}),!R&&t&&!((ke=t==null?void 0:t.loaders)!=null&&ke.length)?e.jsxs(q,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(ie,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"16vh",width:"auto"},src:Ca,alt:"doc_store_details_emptySVG"})}),e.jsx("div",{children:"No Document Added Yet"}),e.jsx(Nt,{variant:"contained",sx:{borderRadius:2,height:"100%",mt:2,color:"white"},startIcon:e.jsx(Ae,{}),onClick:Se,children:"Add Document Loader"})]}):e.jsx(Me,{sx:{border:1,borderColor:a.palette.grey[900]+25,borderRadius:2},component:ze,children:e.jsxs(Le,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(Vt,{sx:{backgroundColor:o.isDarkMode?a.palette.common.black:a.palette.grey[100],height:56},children:e.jsxs(K,{children:[e.jsx(l,{children:" "}),e.jsx(l,{children:"Loader"}),e.jsx(l,{children:"Splitter"}),e.jsx(l,{children:"Source(s)"}),e.jsx(l,{children:"Chunks"}),e.jsx(l,{children:"Chars"}),e.jsx(w,{permission:"documentStores:preview-process,documentStores:delete-loader",children:e.jsx(l,{children:"Actions"})})]})}),e.jsx(Ne,{children:R?e.jsxs(e.Fragment,{children:[e.jsxs($e,{children:[e.jsx(l,{children:e.jsx(C,{variant:"text"})}),e.jsx(l,{children:e.jsx(C,{variant:"text"})}),e.jsx(l,{children:e.jsx(C,{variant:"text"})}),e.jsx(l,{children:e.jsx(C,{variant:"text"})}),e.jsx(l,{children:e.jsx(C,{variant:"text"})}),e.jsx(l,{children:e.jsx(C,{variant:"text"})}),e.jsx(w,{permission:"documentStores:preview-process,documentStores:delete-loader",children:e.jsx(l,{children:e.jsx(C,{variant:"text"})})})]}),e.jsxs($e,{children:[e.jsx(l,{children:e.jsx(C,{variant:"text"})}),e.jsx(l,{children:e.jsx(C,{variant:"text"})}),e.jsx(l,{children:e.jsx(C,{variant:"text"})}),e.jsx(l,{children:e.jsx(C,{variant:"text"})}),e.jsx(l,{children:e.jsx(C,{variant:"text"})}),e.jsx(l,{children:e.jsx(C,{variant:"text"})}),e.jsx(w,{permission:"documentStores:preview-process,documentStores:delete-loader",children:e.jsx(l,{children:e.jsx(C,{variant:"text"})})})]})]}):e.jsx(e.Fragment,{children:(t==null?void 0:t.loaders)&&(t==null?void 0:t.loaders.length)>0&&(t==null?void 0:t.loaders.map((s,g)=>e.jsx(et,{index:g,loader:s,theme:a,onEditClick:()=>st(s.id),onViewChunksClick:()=>Ce(s.id),onDeleteClick:()=>dt(s,t==null?void 0:t.vectorStoreConfig,t==null?void 0:t.recordManagerConfig),onChunkUpsert:()=>m(`/document-stores/vector/${t.id}/${s.id}`),onViewUpsertAPI:()=>mt(t.id,s.id)},g)))})})]})}),((we=h.data)==null?void 0:we.status)==="STALE"&&e.jsx("div",{style:{width:"100%",textAlign:"center",marginTop:"20px"},children:e.jsx(U,{color:"warning",style:{color:"darkred",fontWeight:500,fontStyle:"italic",fontSize:12},children:"Some files are pending processing. Please Refresh to get the latest status."})})]})}),r&&e.jsx(qt,{dialogProps:x,show:r,onCancel:()=>i(!1),onConfirm:te}),y&&e.jsx(Ge,{show:y,dialogProps:X,onCancel:()=>L(!1),onDocLoaderSelected:rt}),J&&e.jsx(Je,{show:J,dialogProps:Q,onCancel:()=>O(!1),onDelete:lt}),je&&e.jsx(Ye,{show:je,dialogProps:tt,onCancel:()=>ye(!1)}),z&&e.jsx(Ut,{open:z}),e.jsx(Qt,{})]})};function et(a){var f;const[o,m]=n.useState(null),j=!!o,$=d=>{d.preventDefault(),d.stopPropagation(),m(d.currentTarget)},S=()=>{m(null)},p=d=>d&&typeof d=="string"&&d.includes("base64")?Ot(d):d&&typeof d=="string"&&d.startsWith("[")&&d.endsWith("]")?JSON.parse(d).join(", "):d;return e.jsx(e.Fragment,{children:e.jsxs(K,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0},cursor:"pointer"},children:[e.jsx(l,{onClick:a.onViewChunksClick,scope:"row",style:{width:"5%"},children:e.jsx("div",{style:{display:"flex",width:"20px",height:"20px",backgroundColor:((f=a.loader)==null?void 0:f.status)==="SYNC"?"#00e676":"#ffe57f",borderRadius:"50%"}})}),e.jsx(l,{onClick:a.onViewChunksClick,scope:"row",children:a.loader.loaderName}),e.jsx(l,{onClick:a.onViewChunksClick,children:a.loader.splitterName??"None"}),e.jsx(l,{onClick:a.onViewChunksClick,children:p(a.loader.source)}),e.jsx(l,{onClick:a.onViewChunksClick,children:a.loader.totalChunks&&e.jsx(ae,{variant:"outlined",size:"small",label:a.loader.totalChunks.toLocaleString()})}),e.jsx(l,{onClick:a.onViewChunksClick,children:a.loader.totalChars&&e.jsx(ae,{variant:"outlined",size:"small",label:a.loader.totalChars.toLocaleString()})}),e.jsx(w,{permission:"documentStores:preview-process,documentStores:delete-loader",children:e.jsx(l,{children:e.jsxs("div",{children:[e.jsx(E,{id:"document-store-action-button","aria-controls":j?"document-store-action-customized-menu":void 0,"aria-haspopup":"true","aria-expanded":j?"true":void 0,disableElevation:!0,onClick:d=>$(d),endIcon:e.jsx(Oe,{}),children:"Options"}),e.jsxs(Ze,{id:"document-store-actions-customized-menu",MenuListProps:{"aria-labelledby":"document-store-actions-customized-button"},anchorEl:o,open:j,onClose:S,children:[e.jsx(w,{permission:"documentStores:preview-process",children:e.jsxs(A,{onClick:a.onEditClick,disableRipple:!0,children:[e.jsx(Zt,{}),"Preview & Process"]})}),e.jsx(w,{permission:"documentStores:preview-process",children:e.jsxs(A,{onClick:a.onViewChunksClick,disableRipple:!0,children:[e.jsx(ue,{}),"View & Edit Chunks"]})}),e.jsx(w,{permission:"documentStores:preview-process",children:e.jsxs(A,{onClick:a.onChunkUpsert,disableRipple:!0,children:[e.jsx(he,{}),"Upsert Chunks"]})}),e.jsx(w,{permission:"documentStores:preview-process",children:e.jsxs(A,{onClick:a.onViewUpsertAPI,disableRipple:!0,children:[e.jsx(Qe,{}),"View API"]})}),e.jsx(Be,{sx:{my:.5}}),e.jsx(w,{permission:"documentStores:delete-loader",children:e.jsxs(A,{onClick:a.onDeleteClick,disableRipple:!0,children:[e.jsx(He,{}),"Delete"]})})]})]})})})]},a.index)})}et.propTypes={loader:T.any,index:T.number,open:T.bool,theme:T.any,onViewChunksClick:T.func,onEditClick:T.func,onDeleteClick:T.func,onChunkUpsert:T.func,onViewUpsertAPI:T.func};export{Ga as default};
