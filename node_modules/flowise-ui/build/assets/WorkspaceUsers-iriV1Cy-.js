import{af as re,t as be,bu as Ce,P as M,R as H,o as oe,p as ne,r as n,c as G,q as we,H as J,j as e,D as Se,h as Ue,k as De,B as ie,l as Re,m as Ee,aa as Ae,s as Oe,au as le,n as S,E as U,J as ce,K as de,a as Be,u as Te,b as We,M as Ne,S as K,ad as Me,e as Z,U as Pe,V as Le,W as Ve,X as Fe,O as $e,a3 as Q,Y as ze,C as P,_ as qe,a8 as ee,av as se}from"./index-B1XR3Coy.js";import{a as t,S as _}from"./TableStyles-Bn4d_qd9.js";import{C as pe,u as _e}from"./ConfirmDialog-Bksga_et.js";import{E as He}from"./ErrorBoundary-WOMkE_83.js";import{V as Ge}from"./ViewHeader-jo2V0q71.js";import{I as Ye}from"./InviteUsersDialog-Cjo8M445.js";import{r as Xe,I as Je}from"./role-BJZr6s4d.js";import{a as Ke,A as Ze}from"./Autocomplete-2B99MXTa.js";import{T as Qe}from"./TextField-BEeUeVUl.js";import{e as es}from"./empty_datasets-sHG3vrEn.js";import{S as u}from"./Skeleton-BQAmmov-.js";import{I as te}from"./IconSearch-BzBgax5m.js";import"./IconCopy-BBl1XuSo.js";import"./StyledFab-BqTal21_.js";import"./IconCircleCheck-CKqsC1lm.js";import"./Tooltip-9ICsuaYn.js";import"./Close-CA_iFeNy.js";import"./FormControl-Cb0ROeST.js";import"./InputLabel-HPVYUEFn.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ss=re("outline","unlink","IconUnlink",[["path",{d:"M17 22v-2",key:"svg-0"}],["path",{d:"M9 15l6 -6",key:"svg-1"}],["path",{d:"M11 6l.463 -.536a5 5 0 0 1 7.071 7.072l-.534 .464",key:"svg-2"}],["path",{d:"M13 18l-.397 .534a5.068 5.068 0 0 1 -7.127 0a4.972 4.972 0 0 1 0 -7.071l.524 -.463",key:"svg-3"}],["path",{d:"M20 17h2",key:"svg-4"}],["path",{d:"M2 7h2",key:"svg-5"}],["path",{d:"M7 2v2",key:"svg-6"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ae=re("outline","user-plus","IconUserPlus",[["path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0",key:"svg-0"}],["path",{d:"M16 19h6",key:"svg-1"}],["path",{d:"M19 16v6",key:"svg-2"}],["path",{d:"M6 21v-2a4 4 0 0 1 4 -4h4",key:"svg-3"}]]);const ts=be(Ce)({boxShadow:"0px 8px 10px -5px rgb(0 0 0 / 20%), 0px 16px 24px 2px rgb(0 0 0 / 14%), 0px 6px 30px 5px rgb(0 0 0 / 12%)",borderRadius:"10px",[`& .${Ke.listbox}`]:{boxSizing:"border-box","& ul":{padding:10,margin:10}}}),ue=({show:j,dialogProps:d,onCancel:L,onConfirm:D})=>{const R=document.getElementById("portal"),y=H(a=>a.auth.user),m=oe();ne();const b=(...a)=>m(ce(...a)),E=(...a)=>m(de(...a)),[v,A]=n.useState(""),[p,O]=n.useState({}),[B,V]=n.useState([]),[i,f]=n.useState(""),k=G(Xe.getAllRolesByOrganizationId);n.useEffect(()=>{if(k.data){const a=k.data.map(l=>({id:l.id,name:l.name,label:l.name,description:l.description}));if(V(a),d.type==="EDIT"&&d.data&&d.data.role&&d.data.role.name){const l=a.find(C=>C.name===d.data.role.name);l&&f(l)}}},[k.data]),n.useEffect(()=>(d.data&&(k.request(y.activeOrganizationId),O(d.data.user),A(d.data.user.email)),()=>{A(""),O({})}),[d]),n.useEffect(()=>(m(j?{type:we}:{type:J}),()=>m({type:J})),[j,m]);const I=async()=>{try{const a={userId:p.id,workspaceId:d.data.workspaceId,organizationId:y.activeOrganizationId,roleId:i.id,updatedBy:y.id},l=await le.updateWorkspaceUserRole(a);l.data&&(b({message:"WorkspaceUser Details Updated",options:{key:new Date().getTime()+Math.random(),variant:"success",action:C=>e.jsx(S,{style:{color:"white"},onClick:()=>E(C),children:e.jsx(U,{})})}}),D(l.data.id))}catch(a){b({message:`Failed to update WorkspaceUser: ${typeof a.response.data=="object"?a.response.data.message:a.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:l=>e.jsx(S,{style:{color:"white"},onClick:()=>E(l),children:e.jsx(U,{})})}})}},F=(a,l)=>{f(l)},T=j?e.jsxs(Se,{fullWidth:!0,maxWidth:"sm",open:j,onClose:L,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Ue,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Je,{style:{marginRight:"10px"}}),"Change Workspace Role - "," ",v||""," ",p.name?`(${p.name})`:""]})}),e.jsx(De,{children:e.jsxs(ie,{sx:{p:1},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsxs(Re,{children:["New Role to Assign",e.jsx("span",{style:{color:"red"},children:"Â *"})]}),e.jsx("div",{style:{flexGrow:1}})]}),e.jsx(Ze,{size:"small",sx:{mt:1},onChange:F,getOptionLabel:a=>a.label||"",options:B,renderInput:a=>e.jsx(Qe,{...a,variant:"outlined",placeholder:"Select Role"}),value:i,PopperComponent:ts})]})}),e.jsx(Ee,{sx:{px:3,pb:2},children:e.jsx(Ae,{variant:"contained",onClick:()=>I(),id:"btn_confirmEditUser",children:d.confirmButtonName})}),e.jsx(pe,{})]}):null;return Oe.createPortal(T,R)};ue.propTypes={show:M.bool,dialogProps:M.object,onCancel:M.func,onConfirm:M.func};const Is=()=>{const j=Be(),d=H(s=>s.customization),L=H(s=>s.auth.user),D=Te(),R=oe();ne();const{error:y,setError:m}=We(),[b,E]=n.useState(""),[v,A]=n.useState({}),[p,O]=n.useState([]),[B,V]=n.useState(!0),[i,f]=n.useState([]),[k,I]=n.useState(!1),[F,T]=n.useState({}),[a,l]=n.useState(!1),[C,xe]=n.useState({}),$=(...s)=>R(ce(...s)),z=(...s)=>R(de(...s)),{confirm:he}=_e(),x=G(se.getAllUsersByWorkspaceId),W=G(le.getWorkspaceById),N=document.location.pathname.toString().split("/"),w=N[N.length-1]==="workspace-users"?"":N[N.length-1],me=s=>{if(s.target.checked){const r=(p||[]).filter(o=>!o.isOrgOwner).map(o=>({userId:o.userId,name:o.user.name,email:o.user.email}));f(r);return}f([])},ge=(s,r)=>{const o=i.findIndex(c=>c.userId===r.userId);let h=[];o===-1?h=h.concat(i,{userId:r.userId,name:r.user.name,email:r.user.email}):o===0?h=h.concat(i.slice(1)):o===i.length-1?h=h.concat(i.slice(0,-1)):o>0&&(h=h.concat(i.slice(0,o),i.slice(o+1))),f(h)},je=s=>i.findIndex(r=>r.userId===s)!==-1,Y=()=>{T({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Send Invite",data:v}),I(!0)},X=s=>{s.status.toUpperCase()==="INVITED"?fe(s):ke(s)},fe=s=>{const r={type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Update Invite",data:{...s,isWorkspaceUser:!0},disableWorkspaceSelection:!0};T(r),I(!0)},ke=s=>{const o={type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Update Role",data:{...s,assignedRoles:[{role:s.role,active:!0}],workspaceId:w}};xe(o),l(!0)},ye=async()=>{const r={title:"Remove Users",description:`Remove the following users from the workspace?
${i.map(c=>c.name?`${c.name} (${c.email})`:c.email).join(", ")}`,confirmButtonName:"Remove",cancelButtonName:"Cancel"};if(p.find(c=>i.some(g=>g.userId===c.id)&&c.isOrgOwner===!0)){$({message:"Organization owner cannot be removed from workspace.",options:{key:new Date().getTime()+Math.random(),variant:"error",action:c=>e.jsx(S,{style:{color:"white"},onClick:()=>z(c),children:e.jsx(U,{})})}});return}if(await he(r)){try{const c=i.map(g=>se.deleteWorkspaceUser(w,g.userId));if(await Promise.all(c),$({message:`${i.length} User(s) removed from workspace.`,options:{key:new Date().getTime()+Math.random(),variant:"success",action:g=>e.jsx(S,{style:{color:"white"},onClick:()=>z(g),children:e.jsx(U,{})})}}),i.some(g=>g.userId===L.id)){D("/",{replace:!0}),D(0);return}q()}catch(c){$({message:`Failed to unlink users: ${typeof c.response.data=="object"?c.response.data.message:c.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:g=>e.jsx(S,{style:{color:"white"},onClick:()=>z(g),children:e.jsx(U,{})})}})}f([])}},q=()=>{I(!1),l(!1),x.request(w)},ve=s=>{E(s.target.value)};function Ie(s){var r,o;return((r=s.user.name)==null?void 0:r.toLowerCase().indexOf(b.toLowerCase()))>-1||((o=s.user.email)==null?void 0:o.toLowerCase().indexOf(b.toLowerCase()))>-1}return n.useEffect(()=>{W.request(w),x.request(w)},[]),n.useEffect(()=>{W.data&&A(W.data)},[W.data]),n.useEffect(()=>{if(x.data){const s=x.data||[],r=s.find(o=>o.isOrgOwner);r&&(s.splice(s.indexOf(r),1),s.unshift(r)),O(s)}},[x.data]),n.useEffect(()=>{x.error&&m(x.error)},[x.error,m]),n.useEffect(()=>{V(x.loading)},[x.loading]),e.jsxs(e.Fragment,{children:[e.jsx(Ne,{children:y?e.jsx(He,{error:y}):e.jsxs(K,{flexDirection:"column",sx:{gap:3},children:[e.jsx(Ge,{isBackButton:!0,isEditButton:!1,onBack:()=>window.history.back(),search:p.length>0,onSearchChange:ve,searchPlaceholder:"Search Users",title:((v==null?void 0:v.name)||"")+": Workspace Users",description:"Manage workspace users and permissions.",children:p.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{permissionId:"workspace:unlink-user",sx:{borderRadius:2,height:"100%"},variant:"outlined",disabled:i.length===0,onClick:ye,color:"error",startIcon:e.jsx(ss,{}),children:"Remove Users"}),e.jsx(Z,{permissionId:"workspace:add-user",variant:"contained",sx:{borderRadius:2,height:"100%"},onClick:Y,startIcon:e.jsx(ae,{}),children:"Add User"})]})}),!B&&(p==null?void 0:p.length)<=0?e.jsxs(K,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(ie,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:es,alt:"empty_datasetSVG"})}),e.jsx("div",{children:"No Assigned Users Yet"}),e.jsx(Z,{permissionId:"workspace:add-user",variant:"contained",sx:{borderRadius:2,height:"100%",mt:2,color:"white"},startIcon:e.jsx(ae,{}),onClick:Y,children:"Add User"})]}):e.jsx(e.Fragment,{children:e.jsx(Pe,{sx:{border:1,borderColor:j.palette.grey[900]+25,borderRadius:2},component:Le,children:e.jsxs(Ve,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(Fe,{sx:{backgroundColor:d.isDarkMode?j.palette.common.black:j.palette.grey[100],height:56},children:e.jsxs($e,{children:[e.jsx(t,{padding:"checkbox",children:e.jsx(Q,{color:"primary",checked:i.length===(p||[]).length-1,onChange:me,inputProps:{"aria-label":"select all"}})}),e.jsx(t,{children:"Email/Name"}),e.jsx(t,{children:"Role"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Last Login"}),e.jsx(t,{children:" "})]})}),e.jsx(ze,{children:B?e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})})]}),e.jsxs(_,{children:[e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})}),e.jsx(t,{children:e.jsx(u,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:(p||[]).filter(Ie).map((s,r)=>e.jsxs(_,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(t,{padding:"checkbox",children:s.isOrgOwner?null:e.jsx(Q,{color:"primary",checked:je(s.userId),onChange:o=>ge(o,s),inputProps:{"aria-labelledby":s.userId}})}),e.jsxs(t,{children:[s.user.name&&e.jsxs(e.Fragment,{children:[s.user.name,e.jsx("br",{})]}),s.user.email]}),e.jsx(t,{children:s.isOrgOwner?e.jsx(P,{size:"small",label:"ORGANIZATION OWNER"}):s.role.name}),e.jsx(t,{children:s.isOrgOwner?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[s.status.toUpperCase()==="ACTIVE"&&e.jsx(P,{color:"success",label:s.status.toUpperCase()}),s.status.toUpperCase()==="INVITED"&&e.jsx(P,{color:"warning",label:s.status.toUpperCase()}),s.status.toUpperCase()==="INACTIVE"&&e.jsx(P,{color:"error",label:s.status.toUpperCase()})]})}),e.jsx(t,{children:s.lastLogin?qe(s.lastLogin).format("DD/MM/YYYY HH:mm"):"Never"}),e.jsxs(t,{children:[!s.isOrgOwner&&s.status.toUpperCase()==="INVITED"&&e.jsx(ee,{title:"Edit",color:"primary",onClick:()=>X(s),children:e.jsx(te,{})}),!s.isOrgOwner&&s.status.toUpperCase()==="ACTIVE"&&e.jsx(ee,{title:"Change Role",color:"primary",onClick:()=>X(s),children:e.jsx(te,{})})]})]},r))})})]})})})]})}),k&&e.jsx(Ye,{show:k,dialogProps:F,onCancel:()=>I(!1),onConfirm:q}),a&&e.jsx(ue,{show:a,dialogProps:C,onCancel:()=>l(!1),onConfirm:q}),e.jsx(pe,{})]})};export{Is as default};
