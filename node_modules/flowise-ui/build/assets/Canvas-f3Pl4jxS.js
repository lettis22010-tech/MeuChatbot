import{af as Ve,r as u,az as q,P as z,a as ze,A as xe,j as t,b4 as it,o as qe,R as Te,p as Ye,E as Q,bu as rt,cF as lt,V as _e,c6 as ct,M as dt,l as pt,B as V,w as mt,ba as ft,c8 as ht,n as ee,J as Ze,u as ut,cS as gt,bI as yt,c as ge,cX as wt,d8 as Ct,ar as Oe,cV as xt,al as ye,cY as He,aq as re,cZ as vt,am as bt,K as Nt,d9 as kt,bL as Fe,c$ as jt,d0 as St}from"./index-B1XR3Coy.js";import{C as Dt,I as Mt,a as At,B as Et}from"./style-BgWmVXbp.js";import{E as It,A as Ft,S as $t,I as Tt,a as zt}from"./EditNodeDialog-guRnCdCZ.js";import{h as Je,e as ve,k as Rt,d as Bt,l as Lt,z as Pt,P as _t,s as Ue,m as Ot,p as Ht,n as Wt,o as Vt,g as qt,q as Yt,u as Zt,b as Jt,R as Ut,c as Gt}from"./DocStoreInputHandler-9-EYgHTZ.js";import{u as Xt,C as Kt,A as Qt,I as eo,a as to}from"./usePrompt-DI6ewMaj.js";import{u as oo,C as no}from"./ConfirmDialog-Bksga_et.js";import{S as ao,F as so}from"./StyledFab-BqTal21_.js";import{I as io}from"./IconExclamationCircle-BsAK4qbB.js";import{i as ro}from"./index-BmqHKIDU.js";import{n as lo}from"./nodes-D-x6LTqi.js";import{c as we}from"./chatflows-ITLPd47E.js";import"./NodeInfoDialog-BBny0-Sx.js";import"./Table-CcAGPqUI.js";import"./TooltipWithParser-C72LCUcD.js";import"./index-D--Rb2MU.js";import"./Tooltip-9ICsuaYn.js";import"./config-CuKonRqx.js";import"./StopCircle-i-Eq3mUR.js";import"./ButtonGroup-glLVEjXK.js";import"./IconCopy-BBl1XuSo.js";import"./IconTrash-BvhWIQ6v.js";import"./Input-C2v4FwXn.js";import"./ListItem-C9nlU6HX.js";import"./FormControl-Cb0ROeST.js";import"./TextField-BEeUeVUl.js";import"./InputLabel-HPVYUEFn.js";import"./Dropdown-BH_BuIwh.js";import"./Autocomplete-2B99MXTa.js";import"./Close-CA_iFeNy.js";import"./MultiDropdown-OnTaU3K-.js";import"./CredentialInputHandler-NSWgGX5U.js";import"./CredentialListDialog-ooDI7A-3.js";import"./Switch-BtbcRzr_.js";import"./main-BBsr8sqY.js";import"./IconArrowsMaximize-BrsSDZNx.js";import"./IconAlertTriangle-Bdlxpe5D.js";import"./InputAdornment-D6_duzKN.js";import"./IconSearch-BzBgax5m.js";import"./Delete-CvnCkEIf.js";import"./IconPlus-DpyX5kZB.js";import"./Grid-DtMOPoeK.js";import"./toPropertyKey-hKuLU48H.js";import"./createStyled-BzRwilhm.js";import"./Skeleton-BQAmmov-.js";import"./KeyboardArrowRight-KQTKBFVE.js";import"./LastPage-CMvObEkB.js";import"./GridActionsCellItem-C4fgcfe6.js";import"./File-B2PWlg1I.js";import"./CodeEditor-BjDzi2Vy.js";import"./index-DhL3T6x0.js";import"./suggestionOption-CTRD7oqB.js";import"./TabPanel-C2EL9Kp7.js";import"./ExpandMore-BP5oMSwT.js";import"./MemoizedReactMarkdown-CNH2mkE4.js";import"./BackdropLoader-C982mQas.js";import"./ExpandTextDialog-Sszv9N4G.js";import"./LoadingButton-BHZSG_sF.js";import"./IconRefresh-B2aTlEaU.js";import"./ToolDialog-hiXiaWJY.js";import"./ExportAsTemplateDialog-CN3tapJC.js";import"./AssistantDialog-BG0DIOgO.js";import"./assistants-C-o7l-z6.js";import"./v4-D8aEg3BZ.js";import"./Stepper-CvQjJ8b9.js";import"./IconLanguage-Dreb5nKM.js";import"./documentstore-GQ_lrBF1.js";import"./string-3NetaFjT.js";import"./IconBulb-CwCq2_I0.js";import"./SaveChatflowDialog-C2LCggZV.js";import"./react-datepicker-CbT3l_H_.js";import"./moment-9Y6NtRWJ.js";import"./vectorstore-BUOpP3fi.js";import"./IconChevronsUp-iPfKij1q.js";import"./IconChevronLeft-Dkfa8829.js";import"./IconDeviceFloppy-CcMo-Sl3.js";import"./llamaindex-B_JSDULd.js";import"./Tabs-DwCJa_eq.js";import"./NodeExecutionDetails-DAbNicF8.js";import"./IconClock-eC9b3RM9.js";import"./ToggleButtonGroup-D1WH89Fe.js";import"./CardMedia-DxratGiC.js";import"./IconCircleXFilled-eMwzVwFM.js";import"./_baseAssignValue-D7-4vid5.js";import"./apikey-DdsPjp8B.js";import"./StatsCard-Dg5IN5gY.js";import"./Pagination-DyTukyc1.js";import"./SpeechToText-BX3-pddK.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var co=Ve("outline","checkbox","IconCheckbox",[["path",{d:"M9 11l3 3l8 -8",key:"svg-0"}],["path",{d:"M20 12v6a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h9",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var po=Ve("outline","checklist","IconChecklist",[["path",{d:"M9.615 20h-2.615a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8",key:"svg-0"}],["path",{d:"M14 19l2 2l4 -4",key:"svg-1"}],["path",{d:"M9 8h4",key:"svg-2"}],["path",{d:"M9 12h2",key:"svg-3"}]]);const Ge=({id:e,x:o,y:a,width:p,height:m,style:r,color:s,strokeColor:d,strokeWidth:i,className:l,borderRadius:f,shapeRendering:x,onClick:C,selected:g})=>{const{background:b,backgroundColor:y}=r||{},A=s||b||y;return q.createElement("rect",{className:Je(["react-flow__minimap-node",{selected:g},l]),x:o,y:a,rx:f,ry:f,width:p,height:m,fill:A,stroke:d,strokeWidth:i,shapeRendering:x,onClick:C?j=>C(j,e):void 0})};Ge.displayName="MiniMapNode";var mo=u.memo(Ge);const fo=e=>e.nodeOrigin,ho=e=>e.getNodes().filter(o=>!o.hidden&&o.width&&o.height),$e=e=>e instanceof Function?e:()=>e;function uo({nodeStrokeColor:e="transparent",nodeColor:o="#e2e2e2",nodeClassName:a="",nodeBorderRadius:p=5,nodeStrokeWidth:m=2,nodeComponent:r=mo,onClick:s}){const d=ve(ho,Ue),i=ve(fo),l=$e(o),f=$e(e),x=$e(a),C=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return q.createElement(q.Fragment,null,d.map(g=>{const{x:b,y}=Rt(g,i).positionAbsolute;return q.createElement(r,{key:g.id,x:b,y,width:g.width,height:g.height,style:g.style,selected:g.selected,className:x(g),color:l(g),borderRadius:p,strokeColor:f(g),strokeWidth:m,shapeRendering:C,onClick:s,id:g.id})}))}var go=u.memo(uo);const yo=200,wo=150,Co=e=>{const o=e.getNodes(),a={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:a,boundingRect:o.length>0?Wt(Vt(o,e.nodeOrigin),a):a,rfId:e.rfId}},xo="react-flow__minimap-desc";function Xe({style:e,className:o,nodeStrokeColor:a="transparent",nodeColor:p="#e2e2e2",nodeClassName:m="",nodeBorderRadius:r=5,nodeStrokeWidth:s=2,nodeComponent:d,maskColor:i="rgb(240, 240, 240, 0.6)",maskStrokeColor:l="none",maskStrokeWidth:f=1,position:x="bottom-right",onClick:C,onNodeClick:g,pannable:b=!1,zoomable:y=!1,ariaLabel:A="React Flow mini map",inversePan:j=!1,zoomStep:w=10,offsetScale:E=5}){const D=Bt(),H=u.useRef(null),{boundingRect:F,viewBB:$,rfId:Ne}=ve(Co,Ue),le=(e==null?void 0:e.width)??yo,te=(e==null?void 0:e.height)??wo,ke=F.width/le,oe=F.height/te,ne=Math.max(ke,oe),ce=ne*le,fe=ne*te,R=E*ne,ae=F.x-(ce-F.width)/2-R,he=F.y-(fe-F.height)/2-R,se=ce+R*2,Y=fe+R*2,L=`${xo}-${Ne}`,P=u.useRef(0);P.current=ne,u.useEffect(()=>{if(H.current){const T=Lt(H.current),Z=_=>{const{transform:J,d3Selection:G,d3Zoom:U}=D.getState();if(_.sourceEvent.type!=="wheel"||!G||!U)return;const pe=-_.sourceEvent.deltaY*(_.sourceEvent.deltaMode===1?.05:_.sourceEvent.deltaMode?1:.002)*w,me=J[2]*Math.pow(2,pe);U.scaleTo(G,me)},de=_=>{const{transform:J,d3Selection:G,d3Zoom:U,translateExtent:pe,width:me,height:ue}=D.getState();if(_.sourceEvent.type!=="mousemove"||!G||!U)return;const ie=P.current*Math.max(1,J[2])*(j?-1:1),X={x:J[0]-_.sourceEvent.movementX*ie,y:J[1]-_.sourceEvent.movementY*ie},De=[[0,0],[me,ue]],Me=Ot.translate(X.x,X.y).scale(J[2]),Ae=U.constrain()(Me,De,pe);U.transform(G,Ae)},Se=Pt().on("zoom",b?de:null).on("zoom.wheel",y?Z:null);return T.call(Se),()=>{T.on("zoom",null)}}},[b,y,j,w]);const W=C?T=>{const Z=Ht(T);C(T,{x:Z[0],y:Z[1]})}:void 0,je=g?(T,Z)=>{const de=D.getState().nodeInternals.get(Z);g(T,de)}:void 0;return q.createElement(_t,{position:x,style:e,className:Je(["react-flow__minimap",o]),"data-testid":"rf__minimap"},q.createElement("svg",{width:le,height:te,viewBox:`${ae} ${he} ${se} ${Y}`,role:"img","aria-labelledby":L,ref:H,onClick:W},A&&q.createElement("title",{id:L},A),q.createElement(go,{onClick:je,nodeColor:p,nodeStrokeColor:a,nodeBorderRadius:r,nodeClassName:m,nodeStrokeWidth:s,nodeComponent:d}),q.createElement("path",{className:"react-flow__minimap-mask",d:`M${ae-R},${he-R}h${se+R*2}v${Y+R*2}h${-se-R*2}z
        M${$.x},${$.y}h${$.width}v${$.height}h${-$.width}z`,fill:i,fillRule:"evenodd",stroke:l,strokeWidth:f,pointerEvents:"none"})))}Xe.displayName="MiniMap";var vo=u.memo(Xe);const Re=({root:e,particles:o,decay:a,rotate:p,lifetime:m,fps:r,updateParticle:s,onFinish:d})=>{const i=m;let l=0,f=0;const x=1e3/r,C=g=>{f||(f=g);const b=g-f;if(b>=x&&(f=g-b%x,o.forEach(y=>s(y,l/i,a,p)),l+=1,l>=i)){o.forEach(y=>{y.element.parentNode===e&&e.removeChild(y.element)}),d();return}window.requestAnimationFrame(C)};window.requestAnimationFrame(C)},{PI:Ce}=Math,We=e=>e*(Ce/180),be=(e,o)=>{const a=Math.ceil(e),p=Math.floor(o);return Math.floor(Math.random()*(p-a))+a},Be=(e,o,a,p)=>{const m=We(e),r=We(o),{random:s}=Math;return{x:0,y:0,z:0,height:0,wobble:s()*10,velocity:a*.5+s()*a,angle2D:-m+(.5*r-s()*r),angle3D:-(Ce/4)+s()*(Ce/2),tiltAngle:s()*Ce,differentiator:p}},bo=e=>{const o=document.getElementById(e);return o||console.error(`Element with an ID of ${e} could not be found. Please provide a valid ID.`),o},No=["#A45BF1","#25C6F6","#72F753","#F76C88","#F5F770"],Ke=[-.6,-.3,0,.3,.6],ko=(e,o,a,p,m,r)=>Array.from({length:o}).map((s,d)=>{const i=document.createElement("span");return i.style["background-color"]=r[d%r.length],i.style.width=`${a}px`,i.style.height=`${a}px`,i.style.position=m,i.style.zIndex=`${p}`,e.appendChild(i),{element:i,differentiator:be(0,Ke.length)}}),jo=(e,o,a)=>{const{x:p,y:m,tiltAngle:r,wobble:s,angle2D:d,angle3D:i,velocity:l,differentiator:f}=e.physics;e.physics.x+=Math.cos(d)*l,e.physics.y+=Math.sin(d)*l,e.physics.z+=Math.sin(i)*l,e.physics.wobble+=.05,e.physics.velocity*=a,e.physics.y+=3.5,e.physics.tiltAngle+=.15;const x=p+(Ke[f]*o*s*s+20*(f%2?Math.sin(s/4):Math.cos(s/4))),C=m+5*Math.sin(s);e.element.style.transform=`translate3d(${x}px, ${C}px, 0) rotate3d(1, 1, 1, ${f%2?r:-1*r}rad)`,e.element.style.scale=`${1-.2*o}`,o>.5&&(e.element.style.opacity=`${2-2*o}`)},So=(e,o,a)=>{const p=a||{},{elementCount:m=50,elementSize:r=8,colors:s=No,angle:d=90,spread:i=45,decay:l=.94,lifetime:f=200,startVelocity:x=35,zIndex:C=0,position:g="fixed",fps:b=60,onAnimationComplete:y}=p,A=ko(e,m,r,C,g,s).map(({element:j,differentiator:w})=>({element:j,physics:Be(d,i,x,w)}));Re({root:e,particles:A,decay:l,lifetime:f,fps:b,updateParticle:jo,onFinish:()=>{typeof y=="function"&&y(),o()}})},Do=["🤓","😊","🥳"],Qe=[-.6,-.3,0,.3,.6],Mo=(e,o,a,p,m,r)=>Array.from({length:o}).map((s,d)=>{const i=document.createElement("span");return i.innerHTML=r[d%r.length],i.style.fontSize=`${a+be(0,4)}px`,i.style.position=m,i.style.zIndex=`${p}`,e.appendChild(i),{element:i,differentiator:be(0,Qe.length)}}),Ao=(e,o,a,p)=>{const{x:m,y:r,tiltAngle:s,angle2D:d,velocity:i,differentiator:l,wobble:f}=e.physics;e.physics.x+=Math.cos(d)*i,e.physics.y+=Math.sin(d)*i,e.physics.wobble+=0,e.physics.velocity*=a,e.physics.y+=5,e.physics.tiltAngle+=.05;const x=`translate3d(${m+(Qe[l]*o*f*f+20*Math.sin(f/4))}px, ${r}px, 0)`,C=p?`rotate3d(0, 0, 1, ${l%2?s:-1*s}rad)`:"";e.element.style.transform=[x,C].filter(Boolean).join(" "),o>.5&&(e.element.style.opacity=`${2-2*o}`)},Eo=(e,o,a)=>{const p=a||{},{elementCount:m=20,elementSize:r=25,emoji:s=Do,angle:d=90,spread:i=45,decay:l=.94,lifetime:f=200,startVelocity:x=35,zIndex:C=0,position:g="fixed",rotate:b=!0,fps:y=60,onAnimationComplete:A}=p,j=Mo(e,m,r,C,g,s).map(({element:w,differentiator:E})=>({element:w,physics:Be(d,i,x,E)}));Re({root:e,particles:j,decay:l,rotate:b,lifetime:f,fps:y,updateParticle:Ao,onFinish:()=>{typeof A=="function"&&A(),o()}})};var Io=`<svg width="100%" viewBox="0 0 976 3040" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M489.693 1269.49C489.773 1378.79 410.493 1466.8 389.107 1571.11C384.147 1595.33 382.893 1620.12 386.187 1644.64C389.44 1668.83 399.28 1691.16 409.04 1713.29C419.253 1736.44 429.28 1760.11 429.453 1785.83C429.64 1812.27 416.307 1836.8 408.933 1861.59C396 1905.15 409.613 1948.88 425.213 1989.73C442.04 2033.83 461.387 2077.87 456.6 2126.17C453.92 2153.15 444.147 2179.13 434.2 2204.13C424.173 2229.35 413.72 2254.28 405.507 2280.17C389.213 2331.51 379.493 2385.83 378.267 2439.72C377.693 2464.89 380.333 2490.25 388.667 2514.11C397.053 2538.09 412.6 2558.75 424.733 2580.84C449.907 2626.64 458.453 2681 451.053 2732.52C443.853 2782.56 414.227 2825.99 408.893 2876.35C404.44 2918.39 416.733 2961.63 440.08 2996.53C450.373 3011.91 463.267 3025.44 477.867 3036.75C480.773 3039 484.88 3034.95 481.947 3032.68C446.147 3004.96 423.24 2964.2 415.907 2919.71C412.107 2896.61 413.627 2872.95 419.427 2850.35C426.053 2824.51 438.067 2800.36 446.667 2775.17C462.44 2729 463.147 2678.51 450.92 2631.45C444.733 2607.64 434.453 2585.4 421.893 2564.32C407.933 2540.91 394.307 2518.68 388.32 2491.71C382.493 2465.45 383.413 2438 385.56 2411.37C387.853 2382.85 392.467 2354.56 398.827 2326.67C405 2299.61 413.253 2273.05 423.107 2247.12C432.533 2222.27 443.533 2198.05 451.867 2172.8C459.707 2149.04 464.387 2124.29 463 2099.23C461.773 2077.19 455.64 2055.65 448.467 2034.89C433.587 1991.8 411.307 1949.77 409.413 1903.37C408.36 1877.76 417.12 1854.67 425.587 1830.97C433.68 1808.33 437.44 1786.41 432.787 1762.6C428.307 1739.63 417.333 1718.23 408.12 1696.91C397.267 1671.77 390.413 1646.41 390.013 1618.89C388.387 1509.52 469.707 1420.85 490.813 1316.72C493.973 1301.19 495.467 1285.33 495.453 1269.49C495.453 1265.77 489.693 1265.77 489.693 1269.49" stroke="#7A7E82" stroke-width="4"/>
<path d="M555.653 1298.41H423.52C415.173 1298.41 408.413 1305.17 408.413 1313.52C408.413 1321.85 415.173 1328.63 423.52 1328.63H555.653C564 1328.63 570.76 1321.85 570.76 1313.52C570.76 1305.17 564 1298.41 555.653 1298.41Z" fill="currentColor"/>
<path d="M555.653 1298.41H423.52C415.173 1298.41 408.413 1305.17 408.413 1313.52C408.413 1321.85 415.173 1328.63 423.52 1328.63H555.653C564 1328.63 570.76 1321.85 570.76 1313.52C570.76 1305.17 564 1298.41 555.653 1298.41Z" fill="black" fill-opacity="0.1"/>
<path d="M975.133 528.947C975.133 820.667 756.973 1255.43 487.853 1255.43C218.733 1255.43 0.559814 820.667 0.559814 528.947C0.559814 237.227 218.733 0.733359 487.853 0.733359C756.973 0.733359 975.133 237.227 975.133 528.947Z" fill="currentColor"/>
<path d="M549.04 1298.41C531.293 1285.91 519.893 1269.95 512.587 1254.2C504.387 1255.01 496.147 1255.43 487.853 1255.43C481.04 1255.43 474.28 1255.15 467.546 1254.6C460.226 1270.21 448.867 1286.01 431.253 1298.41H549.04Z" fill="currentColor"/>
<path d="M211.413 569.213C193.787 569.213 175.947 564.4 160.92 555.24C128.133 535.293 108.133 498.56 101.147 460.827C97.0133 438.533 96.9468 415.827 99.1068 393.214C120.627 308.28 168.453 234.48 233.467 183.733C246.947 173.213 261.16 163.693 276.027 155.267C280.347 152.813 284.72 150.467 289.147 148.2C291.707 147.373 294.347 146.92 297.12 146.92C301.347 146.92 305.907 147.974 311.067 150.414C332.773 160.64 334.36 192.213 323.693 213.72C313.04 235.226 294.187 251.8 283.413 273.253C262 315.88 276.48 366.707 287.347 413.147C298.213 459.6 302.427 515.373 267.8 548.187C252.707 562.48 232.227 569.213 211.413 569.213" fill="white" fill-opacity="0.2"/>
<path d="M785.133 110.4C863.72 204.187 911.613 328.747 911.613 465.414C911.613 757.147 693.44 1191.89 424.32 1191.89C350.973 1191.89 281.413 1159.6 219.013 1106.71C296.067 1196.16 388.48 1255.43 487.853 1255.43C756.973 1255.43 975.133 820.667 975.133 528.947C975.133 358.547 900.693 206.987 785.133 110.4Z" fill="black" fill-opacity="0.1"/>
</svg>`;const Fo=["#A45BF1","#25C6F6","#72F753","#F76C88","#F5F770"],et=[-.6,-.3,0,.3,.6],$o=(e,o,a)=>{o.parentNode===a&&a.removeChild(o)},To=(e,o,a,p,m,r)=>Array.from({length:o}).map((s,d)=>{const i=document.createElement("span");return i.innerHTML=Io,i.style.width=`${a}px`,i.style.position=m,i.style.color=r[d%r.length],i.style.zIndex=`${p}`,i.addEventListener("click",l=>{$o(l,i,e)},{once:!0}),e.appendChild(i),{element:i,differentiator:be(0,et.length)}}),zo=(e,o,a)=>{const{x:p,y:m,tiltAngle:r,angle2D:s,velocity:d,differentiator:i,wobble:l}=e.physics;e.physics.x+=Math.cos(s)*.5*d,e.physics.y+=Math.sin(s)*.5*d,e.physics.wobble+=0,e.physics.velocity*=a,e.physics.tiltAngle+=.1;const f=p+(et[i]*o*l*l+20*Math.sin(l));e.element.style.transform=`translate3d(${f}px, ${m}px, 0) rotate3d(0, 0, 1, ${i%2?Math.sin(r/4)/3:Math.cos(r/4)/3}rad)`,e.element.style.scale=`${1-.2*o}`,o>.5&&(e.element.style.opacity=`${2-2*o}`)},Ro=(e,o,a)=>{const p=a||{},{angle:m=90,decay:r=.999,spread:s=50,startVelocity:d=3,elementCount:i=10,elementSize:l=20,lifetime:f=600,zIndex:x=0,position:C="fixed",colors:g=Fo,fps:b=60,onAnimationComplete:y}=p,A=To(e,i,l,x,C,g).map(({element:j,differentiator:w})=>({element:j,physics:Be(m,s,d,w)}));Re({root:e,particles:A,decay:r,lifetime:f,fps:b,updateParticle:zo,onFinish:()=>{typeof y=="function"&&y(),o()}})},Bo=(e,o,a)=>{const[p,m]=u.useState(!1),r=()=>{m(!1)};return{reward:u.useCallback(()=>{const s=bo(e);if(s)switch(m(!0),o){case"confetti":So(s,r,a);break;case"emoji":Eo(s,r,a);break;case"balloons":Ro(s,r,a);break;default:console.error(`${o} is not a valid react-rewards type.`)}},[a,e,o]),isAnimating:p}};function tt({transform:e,isHumanInput:o,label:a,color:p}){return t.jsx("div",{style:{position:"absolute",background:"transparent",left:o?20:10,paddingTop:1,color:p,fontSize:"0.5rem",fontWeight:700,transform:e,zIndex:1e3},className:"nodrag nopan",children:a})}tt.propTypes={transform:z.string,isHumanInput:z.bool,label:z.string,color:z.string};const ot=({fromX:e,fromY:o,toX:a,toY:p,fromPosition:m,toPosition:r})=>{var g;const[s]=qt({sourceX:e,sourceY:o,sourcePosition:m,targetX:a,targetY:p,targetPosition:r}),{connectionHandleId:d}=ve(),i=ze(),l=(d||"").split("_")[0]||"",f=l==="humanInputAgentflow"||l==="conditionAgentflow"||l==="conditionAgentAgentflow",x=()=>{let b;if(l==="conditionAgentflow"||l==="conditionAgentAgentflow"){const y=d.split("-").pop();b=(isNaN(y)?0:y).toString()}if(l==="humanInputAgentflow"){const y=d.split("-").pop();b=(isNaN(y)?0:y).toString(),b=b==="0"?"proceed":"reject"}return b},C=((g=xe.find(b=>b.name===(d||"").split("_")[0]||""))==null?void 0:g.color)??i.palette.primary.main;return t.jsxs("g",{children:[t.jsx("path",{fill:"none",stroke:C,strokeWidth:1.5,className:"animated",d:s}),t.jsxs("g",{transform:`translate(${a-10}, ${p-10}) scale(0.8)`,children:[t.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),t.jsx("path",{d:"M12 2c5.523 0 10 4.477 10 10a10 10 0 0 1 -20 0c0 -5.523 4.477 -10 10 -10m-.293 6.293a1 1 0 0 0 -1.414 0l-.083 .094a1 1 0 0 0 .083 1.32l2.292 2.293l-2.292 2.293a1 1 0 0 0 1.414 1.414l3 -3a1 1 0 0 0 0 -1.414z",fill:C})]}),f&&t.jsx(Yt,{children:t.jsx(tt,{color:C,isHumanInput:l==="humanInputAgentflow",label:x(),transform:`translate(-50%, 0%) translate(${e}px,${o}px)`})})]})};ot.propTypes={fromX:z.number,fromY:z.number,toX:z.number,toY:z.number,fromPosition:z.any,toPosition:z.any};const Lo=u.memo(ot),Po="/assets/validate_empty-BoEkQrnY.svg",_o=e=>it.get(`/validation/${e}`),Oo={checkValidation:_o},nt=({chatflowid:e,hidden:o})=>{const a=ze(),p=qe(),m=Te(w=>w.customization);Ye();const r=(...w)=>p(Ze(...w)),[s,d]=u.useState(!1),[i,l]=u.useState([]),[f,x]=u.useState(!1),C=u.useRef(null),g=u.useRef(s),b=w=>{C.current&&C.current.contains(w.target)||d(!1)},y=()=>{d(w=>!w)},A=async()=>{if(e)try{x(!0);const w=await Oo.checkValidation(e);l(w.data),w.data.length===0&&r({message:"No issues found in your flow!",options:{key:new Date().getTime()+Math.random(),variant:"success",autoHideDuration:3e3}})}catch(w){console.error(w),r({message:w.message||"Failed to validate flow",options:{key:new Date().getTime()+Math.random(),variant:"error",autoHideDuration:3e3}})}finally{x(!1)}};u.useEffect(()=>{g.current===!0&&s===!1&&C.current.focus(),g.current=s},[s,e]);const j=w=>{const E=w.name,D=xe.find(H=>H.name===E);return D?t.jsx(V,{sx:{width:"28px",height:"28px",borderRadius:"4px",backgroundColor:D.color,display:"flex",alignItems:"center",justifyContent:"center",color:"white"},children:t.jsx(D.icon,{size:16})}):t.jsx(V,{sx:{width:"28px",height:"28px",borderRadius:"4px",backgroundColor:w.type==="LLM"?"#4747d1":"#f97316",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},children:w.type==="LLM"?t.jsx("span",{children:"ℓ"}):t.jsx(ro,{size:16})})};return t.jsxs(t.Fragment,{children:[!o&&t.jsx(ao,{sx:{position:"absolute",right:80,top:20},ref:C,size:"small",color:"teal","aria-label":"validation",title:"Validate Nodes",onClick:y,children:s?t.jsx(Q,{}):t.jsx(po,{})}),t.jsx(rt,{placement:"bottom-end",open:s&&!o,anchorEl:C.current,role:void 0,transition:!0,disablePortal:!0,popperOptions:{modifiers:[{name:"offset",options:{offset:[80,14]}}]},sx:{zIndex:1e3},children:({TransitionProps:w})=>t.jsx(lt,{in:s,...w,children:t.jsx(_e,{children:t.jsx(ct,{onClickAway:b,children:t.jsxs(dt,{elevation:16,border:!1,content:!1,sx:{p:2,width:"400px",maxWidth:"100%"},boxShadow:!0,shadow:a.shadows[16],children:[t.jsxs(pt,{variant:"h4",sx:{mt:1,mb:2},children:["Checklist (",i.length,")"]}),t.jsx(V,{sx:{maxHeight:"60vh",overflowY:"auto",pr:1,mr:-1},children:i.length>0?i.map((E,D)=>t.jsxs(_e,{elevation:0,sx:{p:2,mb:2,backgroundColor:m.isDarkMode?a.palette.background.paper:a.palette.background.neutral,borderRadius:"8px",border:`1px solid ${mt("#FFB938",m.isDarkMode?.3:.5)}`},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[j(E),t.jsx("div",{style:{fontWeight:500},children:E.label||E.name})]}),t.jsx(V,{sx:{mt:2}}),E.issues.map((H,F)=>t.jsxs(V,{sx:{pt:2,px:2,pb:F===E.issues.length-1?2:1,backgroundColor:m.isDarkMode?ft("#FFB938",.85):ht("#FFB938",.9),display:"flex",alignItems:"center",gap:2},children:[t.jsx(io,{color:"#FFB938",size:20,style:{minWidth:"20px",width:"20px",height:"20px",flexShrink:0}}),t.jsx("span",{children:H})]},F))]},D)):t.jsx(V,{sx:{p:2,height:"auto",display:"flex",justifyContent:"center",alignItems:"center"},children:t.jsx("img",{style:{objectFit:"cover",height:"15vh",width:"auto"},src:Po,alt:"validate_empty"})})}),t.jsx(V,{sx:{display:"flex",justifyContent:"center",mt:2,mb:1},children:t.jsx(ee,{variant:"contained",color:"teal",onClick:A,disabled:f,startIcon:f?null:t.jsx(co,{size:18}),sx:{color:"white",minWidth:"120px"},children:f?"Validating...":"Validate Flow"})})]})})})})})]})};nt.propTypes={chatflowid:z.string,hidden:z.bool};const Ho=u.memo(nt),Wo={agentFlow:Ft,stickyNote:$t,iteration:Tt},Vo={agentFlow:zt},ja=()=>{const e=ze(),o=ut(),a=Te(n=>n.customization),{state:p}=gt(),m=p?p.templateFlowData:"",r=document.location.pathname.toString().split("/"),s=r[r.length-1]==="canvas"||r[r.length-1]==="agentcanvas"?"":r[r.length-1],d=r.includes("agentcanvas")?"Agent":"Chatflow",{confirm:i}=oo(),l=qe(),f=Te(n=>n.canvas),[x,C]=u.useState(f),[g,b]=u.useState(null),{reactFlowInstance:y,setReactFlowInstance:A}=u.useContext(yt);Ye();const j=(...n)=>l(Ze(...n)),w=(...n)=>l(Nt(...n)),[E,D,H]=Zt(),[F,$,Ne]=Jt(),[le,te]=u.useState(null),[ke,oe]=u.useState(!1),[ne,ce]=u.useState(!1),[fe,R]=u.useState({}),[ae,he]=u.useState(!1),se=u.useRef(null),Y=ge(lo.getAllNodes),L=ge(we.createNewChatflow),P=ge(we.updateChatflow),W=ge(we.getSpecificChatflow),je=n=>{var M,B;if(!kt(n,y))return;const c=n.sourceHandle.split("_")[0],h=n.targetHandle.split("_")[0],v=((M=xe.find(I=>I.name===h))==null?void 0:M.color)??e.palette.primary.main,N=((B=xe.find(I=>I.name===c))==null?void 0:B.color)??e.palette.primary.main;let k;if(c==="conditionAgentflow"||c==="conditionAgentAgentflow"){const I=n.sourceHandle.split("-").pop();k=(isNaN(I)?0:I).toString()}c==="humanInputAgentflow"&&(k=n.sourceHandle.split("-").pop(),k=k==="0"?"proceed":"reject");const O=y.getNodes().find(I=>I.id===n.source),S=y.getNodes().find(I=>I.id===n.target),Ee=(O==null?void 0:O.parentNode)&&(S==null?void 0:S.parentNode)&&O.parentNode===S.parentNode,K={...n,data:{...n.data,sourceColor:N,targetColor:v,edgeLabel:k,isHumanInput:c==="humanInputAgentflow"},...Ee&&{zIndex:9999},type:"agentFlow",id:`${n.source}-${n.sourceHandle}-${n.target}-${n.targetHandle}`};$(I=>Gt(K,I))},T=n=>{try{const c=JSON.parse(n),h=c.nodes||[];D(h),$(c.edges||[]),setTimeout(()=>X(),0)}catch(c){console.error(c)}},Z=async()=>{const n={title:"Delete",description:`Delete ${d} ${g.name}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await i(n))try{await we.deleteChatflow(g.id),localStorage.removeItem(`${g.id}_INTERNAL`),o("/agentflows")}catch(h){j({message:typeof h.response.data=="object"?h.response.data.message:h.response.data,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:v=>t.jsx(ee,{style:{color:"white"},onClick:()=>w(v),children:t.jsx(Q,{})})}})}},de=n=>{if(y){const c=y.getNodes().map(N=>{const k=re.cloneDeep(N.data);return Object.prototype.hasOwnProperty.call(k.inputs,Fe)&&(k.credential=k.inputs[Fe],k.inputs=re.omit(k.inputs,[Fe])),N.data={...k,selected:!1,status:void 0},N}),h=y.toObject();h.nodes=c;const v=JSON.stringify(h);if(g.id){const N={name:n,flowData:v};P.request(g.id,N)}else{const N={name:n,deployed:!1,isPublic:!1,flowData:v,type:"AGENTFLOW"};L.request(N)}}},Se=u.useCallback((n,c)=>{te(c),D(h=>h.map(v=>(v.id===c.id?v.data={...v.data,selected:!0}:v.data={...v.data,selected:!1},v)))}),_=u.useCallback((n,c)=>{if(!(!c||!c.data)&&c.data.name!=="stickyNoteAgentflow"){const h={data:c.data,inputParams:c.data.inputParams.filter(v=>!v.hidden)};R(h),ce(!0)}}),J=u.useCallback(n=>{n.preventDefault(),n.dataTransfer.dropEffect="move"},[]),G=u.useCallback(n=>{n.preventDefault();const c=se.current.getBoundingClientRect();let h=n.dataTransfer.getData("application/reactflow");if(typeof h>"u"||!h)return;h=JSON.parse(h);const v=y.project({x:n.clientX-c.left-100,y:n.clientY-c.top-50}),N=y.getNodes();if(h.name==="startAgentflow"&&N.find(M=>M.data.name==="startAgentflow")){j({message:"Only one start node is allowed",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:M=>t.jsx(ee,{style:{color:"white"},onClick:()=>w(M),children:t.jsx(Q,{})})}});return}const k=wt(h,y.getNodes()),O=Ct(h,N),S={id:k,position:v,data:{...Oe(h,k,!0),label:O}};h.type==="Iteration"?S.type="iteration":h.type==="StickyNote"?S.type="stickyNote":S.type="agentFlow";const Ee=N.filter(M=>M.type==="iteration");let K=null;for(const M of Ee){const B=M.width||300,I=M.height||250,Le=M.position.x,at=Le+B,Pe=M.position.y,st=Pe+I;if(v.x>=Le&&v.x<=at&&v.y>=Pe&&v.y<=st){if(K=M,h.name==="iterationAgentflow"){j({message:"Nested iteration node is not supported yet",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:Ie=>t.jsx(ee,{style:{color:"white"},onClick:()=>w(Ie),children:t.jsx(Q,{})})}});return}if(h.name==="humanInputAgentflow"){j({message:"Human input node is not supported inside Iteration node",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:Ie=>t.jsx(ee,{style:{color:"white"},onClick:()=>w(Ie),children:t.jsx(Q,{})})}});return}break}}K&&(S.parentNode=K.id,S.extent="parent",S.position={x:v.x-K.position.x,y:v.y-K.position.y}),te(S),D(M=>(M??[]).concat(S).map(B=>(B.id===S.id?B.data={...B.data,selected:!0}:B.data={...B.data,selected:!1},B))),setTimeout(()=>X(),0)},[y]),U=()=>{const n=f.componentNodes,c=re.cloneDeep(E),h=re.cloneDeep(F);let v=[];for(let N=0;N<c.length;N++){const k=c[N],O=n.find(S=>S.name===k.data.name);if(O&&O.version>k.data.version){const S=re.cloneDeep(O);c[N].data=jt(S,k.data,!0),v.push(...St(c[N].data,h))}}D(c),$(h.filter(N=>!v.includes(N))),X(),oe(!1)},{reward:pe}=Bo("canvasConfetti","confetti",{elementCount:150,spread:80,lifetime:300,startVelocity:40,zIndex:1e4,decay:.92,position:"fixed"}),me=()=>{setTimeout(()=>{pe()},50)},ue=()=>{l({type:He}),j({message:`${d} saved`,options:{key:new Date().getTime()+Math.random(),variant:"success",action:n=>t.jsx(ee,{style:{color:"white"},onClick:()=>w(n),children:t.jsx(Q,{})})}})},ie=n=>{j({message:n,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:c=>t.jsx(ee,{style:{color:"white"},onClick:()=>w(c),children:t.jsx(Q,{})})}})},X=()=>{l({type:xt})},De=n=>{const c=f.componentNodes;for(let h=0;h<n.length;h++){const v=n[h],N=c.find(k=>k.name===v.data.name);if(N&&N.version>v.data.version){oe(!0);return}}oe(!1)};u.useEffect(()=>{if(W.data){const n=W.data,c=n.flowData?JSON.parse(n.flowData):[];D(c.nodes||[]),$(c.edges||[]),l({type:ye,chatflow:n})}else W.error&&ie(`Failed to retrieve ${d}: ${W.error.response.data.message}`)},[W.data,W.error]),u.useEffect(()=>{if(L.data){const n=L.data;l({type:ye,chatflow:n}),ue(),window.history.replaceState(p,null,`/v2/agentcanvas/${n.id}`)}else L.error&&ie(`Failed to save ${d}: ${L.error.response.data.message}`)},[L.data,L.error]),u.useEffect(()=>{P.data?(l({type:ye,chatflow:P.data}),ue()):P.error&&ie(`Failed to save ${d}: ${P.error.response.data.message}`)},[P.data,P.error]),u.useEffect(()=>{if(b(x.chatflow),x.chatflow){const n=x.chatflow.flowData?JSON.parse(x.chatflow.flowData):[];De(n.nodes||[])}},[x.chatflow]),u.useEffect(()=>(oe(!1),s?W.request(s):(localStorage.getItem("duplicatedFlowData")?(T(localStorage.getItem("duplicatedFlowData")),setTimeout(()=>localStorage.removeItem("duplicatedFlowData"),0)):(D([]),$([])),l({type:ye,chatflow:{name:`Untitled ${d}`}})),Y.request(),()=>{setTimeout(()=>l({type:He}),0)}),[]),u.useEffect(()=>{C(f)},[f]),u.useEffect(()=>{function n(c){const h=c.clipboardData.getData("text");h.includes('{"nodes":[')&&h.includes('],"edges":[')&&T(h)}return window.addEventListener("paste",n),()=>{window.removeEventListener("paste",n)}},[]),u.useEffect(()=>{m&&m.includes('"nodes":[')&&m.includes('],"edges":[')&&T(m)},[m]),Xt("You have unsaved changes! Do you want to navigate away?",x.isDirty);const[Me,Ae]=u.useState(!1);return u.useEffect(()=>{if(!s&&!localStorage.getItem("duplicatedFlowData")&&Y.data&&E.length===0){const n=Y.data.find(c=>c.name==="startAgentflow");if(n){const c=re.cloneDeep(n);c.position={x:100,y:100};const h={id:"startAgentflow_0",type:"agentFlow",position:{x:100,y:100},data:{...Oe(c,"startAgentflow_0",!0),label:"Start"}};D([h]),$([])}}},[Y.data,s]),t.jsxs(t.Fragment,{children:[t.jsx("span",{id:"canvasConfetti",style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"0",height:"0",zIndex:9999,pointerEvents:"none",background:"transparent"}}),t.jsxs(V,{children:[t.jsx(vt,{enableColorOnDark:!0,position:"fixed",color:"inherit",elevation:1,sx:{bgcolor:e.palette.background.default},children:t.jsx(bt,{children:t.jsx(Kt,{chatflow:g,handleSaveFlow:de,handleDeleteFlow:Z,handleLoadFlow:T,isAgentCanvas:!0,isAgentflowV2:!0})})}),t.jsx(V,{sx:{pt:"70px",height:"100vh",width:"100%"},children:t.jsx("div",{className:"reactflow-parent-wrapper",children:t.jsx("div",{className:"reactflow-wrapper",ref:se,children:t.jsxs(Ut,{nodes:E,edges:F,onNodesChange:H,onNodeClick:Se,onNodeDoubleClick:_,onEdgesChange:Ne,onDrop:G,onDragOver:J,onNodeDragStop:X,nodeTypes:Wo,edgeTypes:Vo,onConnect:je,onInit:A,fitView:!0,deleteKeyCode:f.canvasDialogShow?null:["Delete"],minZoom:.5,snapGrid:[25,25],snapToGrid:ae,connectionLineComponent:Lo,children:[t.jsx(Dt,{className:a.isDarkMode?"dark-mode-controls":"",style:{display:"flex",flexDirection:"row",left:"50%",transform:"translate(-50%, -50%)"},children:t.jsx("button",{className:"react-flow__controls-button react-flow__controls-interactive",onClick:()=>{he(!ae)},title:"toggle snapping","aria-label":"toggle snapping",children:ae?t.jsx(Mt,{}):t.jsx(At,{})})}),t.jsx(vo,{nodeStrokeWidth:3,nodeColor:a.isDarkMode?"#2d2d2d":"#e2e2e2",nodeStrokeColor:a.isDarkMode?"#525252":"#fff",maskColor:a.isDarkMode?"rgb(45, 45, 45, 0.6)":"rgb(240, 240, 240, 0.6)",style:{backgroundColor:a.isDarkMode?e.palette.background.default:"#fff"}}),t.jsx(Et,{color:"#aaa",gap:16}),t.jsx(Qt,{isAgentCanvas:!0,isAgentflowv2:!0,nodesData:Y.data,node:le,onFlowGenerated:me}),t.jsx(It,{show:ne,dialogProps:fe,onCancel:()=>ce(!1)}),ke&&t.jsx(so,{sx:{left:60,top:20,color:"white",background:"orange","&:hover":{background:"orange",backgroundImage:"linear-gradient(rgb(0 0 0/10%) 0 0)"}},size:"small","aria-label":"sync",title:"Sync Nodes",onClick:()=>U(),children:t.jsx(eo,{})}),t.jsx(to,{isAgentCanvas:!0,chatflowid:s,onOpenChange:Ae}),!Me&&t.jsx(Ho,{isAgentCanvas:!0,chatflowid:s})]})})})}),t.jsx(no,{})]})]})};export{ja as default};
