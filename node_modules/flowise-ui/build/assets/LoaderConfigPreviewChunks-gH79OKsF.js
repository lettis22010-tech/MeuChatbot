import{af as ke,t as ye,M as Z,R as Ce,u as ve,a as we,b as Se,Q as De,c as N,ak as Ie,r as n,o as Pe,p as Ee,aq as R,ar as X,j as e,S as Ne,B as p,am as Re,l as m,d as _,aa as Me,aj as b,as as w,g as Fe,a1 as Te,ag as Ae,ah as Be,n as S,E as D,J as Oe,K as $e}from"./index-B1XR3Coy.js";import{R as We}from"./main-BBsr8sqY.js";import{B as qe}from"./BackdropLoader-C982mQas.js";import{D as Q}from"./DocStoreInputHandler-9-EYgHTZ.js";import{D as ze}from"./Dropdown-BH_BuIwh.js";import{S as M}from"./StyledFab-BqTal21_.js";import{E as Le}from"./ErrorBoundary-WOMkE_83.js";import{E as Ge}from"./ExpandedChunkDialog-C2wgrYw6.js";import{n as U}from"./nodes-D-x6LTqi.js";import{d as I}from"./documentstore-GQ_lrBF1.js";import{v as V}from"./v4-D8aEg3BZ.js";import{a as He}from"./IconSearch-BzBgax5m.js";import{I as Je}from"./IconDatabaseImport-DtH2cDVP.js";import{T as Ke}from"./TextField-BEeUeVUl.js";import{I as Xe}from"./IconScissors-B1WA5G_Y.js";import{S as u}from"./Skeleton-BQAmmov-.js";import{I as Y}from"./IconEye-5BEWSVYC.js";import"./MultiDropdown-OnTaU3K-.js";import"./Autocomplete-2B99MXTa.js";import"./Close-CA_iFeNy.js";import"./FormControl-Cb0ROeST.js";import"./CredentialInputHandler-NSWgGX5U.js";import"./CredentialListDialog-ooDI7A-3.js";import"./TooltipWithParser-C72LCUcD.js";import"./index-D--Rb2MU.js";import"./Tooltip-9ICsuaYn.js";import"./ConfirmDialog-Bksga_et.js";import"./Input-C2v4FwXn.js";import"./ListItem-C9nlU6HX.js";import"./Switch-BtbcRzr_.js";import"./IconArrowsMaximize-BrsSDZNx.js";import"./IconAlertTriangle-Bdlxpe5D.js";import"./InputAdornment-D6_duzKN.js";import"./Delete-CvnCkEIf.js";import"./IconPlus-DpyX5kZB.js";import"./Grid-DtMOPoeK.js";import"./toPropertyKey-hKuLU48H.js";import"./createStyled-BzRwilhm.js";import"./InputLabel-HPVYUEFn.js";import"./KeyboardArrowRight-KQTKBFVE.js";import"./LastPage-CMvObEkB.js";import"./GridActionsCellItem-C4fgcfe6.js";import"./File-B2PWlg1I.js";import"./CodeEditor-BjDzi2Vy.js";import"./index-DhL3T6x0.js";import"./suggestionOption-CTRD7oqB.js";import"./TabPanel-C2EL9Kp7.js";import"./ExpandMore-BP5oMSwT.js";import"./MemoizedReactMarkdown-CNH2mkE4.js";import"./ExpandTextDialog-Sszv9N4G.js";import"./LoadingButton-BHZSG_sF.js";import"./IconTrash-BvhWIQ6v.js";import"./IconRefresh-B2aTlEaU.js";import"./ToolDialog-hiXiaWJY.js";import"./ExportAsTemplateDialog-CN3tapJC.js";import"./AssistantDialog-BG0DIOgO.js";import"./assistants-C-o7l-z6.js";import"./Stepper-CvQjJ8b9.js";import"./IconLanguage-Dreb5nKM.js";import"./string-3NetaFjT.js";import"./IconBulb-CwCq2_I0.js";import"./IconCopy-BBl1XuSo.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var _e=ke("outline","book","IconBook",[["path",{d:"M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0",key:"svg-0"}],["path",{d:"M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0",key:"svg-1"}],["path",{d:"M3 6l0 13",key:"svg-2"}],["path",{d:"M12 6l0 13",key:"svg-3"}],["path",{d:"M21 6l0 13",key:"svg-4"}]]);const Qe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ue(l){return typeof l=="string"&&Qe.test(l)}const Ve=ye(Z)(({theme:l})=>({background:l.palette.card.main,color:l.darkTextPrimary,overflow:"auto",position:"relative",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 8%)",cursor:"pointer","&:hover":{background:l.palette.card.hover,boxShadow:"0 2px 14px 0 rgb(32 40 45 / 20%)"},maxHeight:"250px",minHeight:"250px",maxWidth:"100%",overflowWrap:"break-word",whiteSpace:"pre-line",padding:1})),ra=()=>{var J,K;const l=Ce(t=>t.customization),P=ve(),ee=we(),{error:F}=Se(),{hasAssignedWorkspace:te}=De(),x=N(U.getSpecificNode),g=N(U.getNodesByCategory),h=N(I.getSpecificDocumentStore),{storeId:E,name:k}=Ie(),[s,T]=n.useState({}),[A,f]=n.useState(!1),[B,O]=n.useState(""),[y,ae]=n.useState([]),[$,se]=n.useState([]),[r,j]=n.useState({}),[c,oe]=n.useState([]),[ie,re]=n.useState(0),[ne,le]=n.useState(0),[W,de]=n.useState(20),[d,pe]=n.useState(),[ce,q]=n.useState(!1),[me,he]=n.useState({}),z=Pe();Ee();const C=(...t)=>z(Oe(...t)),v=(...t)=>z($e(...t)),fe=({inputParam:t,newValue:a})=>{T(o=>{const i={...o};return i.inputs[t.name]=a,i.inputParams=w(i),i})},ue=({inputParam:t,newValue:a})=>{j(o=>{const i={...o};return i.inputs[t.name]=a,i.inputParams=w(i),i})},xe=t=>{const a=(y??[]).find(o=>o.name===t);j(a||{})},ge=(t,a)=>{he({data:{selectedChunk:t,selectedChunkNumber:a}}),q(!0)},L=()=>{let t=!0;const a=[],o=(s.inputParams??[]).filter(i=>!i.hidden);for(const i of o)!i.optional&&(!s.inputs[i.name]||!s.credential)&&(i.type==="credential"&&!s.credential&&!s.inputs.FLOWISE_CREDENTIAL_ID||i.type!=="credential"&&!s.inputs[i.name])&&(t=!1,a.push(i.label||i.name));if(!t){const i=a.join(", ");C({message:`Please fill in the following mandatory fields: ${i}`,options:{key:new Date().getTime()+Math.random(),variant:"warning",action:be=>e.jsx(S,{style:{color:"white"},onClick:()=>v(be),children:e.jsx(D,{})})}})}return t},G=async()=>{if(L()){f(!0);const t=H();t.previewChunkCount=W;try{const a=await I.previewChunks(t);a.data&&(re(a.data.totalChunks),oe(a.data.chunks),le(a.data.previewChunkCount)),f(!1)}catch(a){f(!1),C({message:`Failed to preview chunks: ${typeof a.response.data=="object"?a.response.data.message:a.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:o=>e.jsx(S,{style:{color:"white"},onClick:()=>v(o),children:e.jsx(D,{})})}})}}},je=async()=>{var t;if(L()){f(!0);const a=H();try{const o=await I.saveProcessingLoader(a);f(!1),o.data&&(C({message:"File submitted for processing. Redirecting to Document Store..",options:{key:new Date().getTime()+Math.random(),variant:"success",action:i=>e.jsx(S,{style:{color:"white"},onClick:()=>v(i),children:e.jsx(D,{})})}}),I.processLoader(a,(t=o.data)==null?void 0:t.id),P("/document-stores/"+E))}catch(o){f(!1),C({message:`Failed to process chunking: ${typeof o.response.data=="object"?o.response.data.message:o.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",action:i=>e.jsx(S,{style:{color:"white"},onClick:()=>v(i),children:e.jsx(D,{})})}})}}},H=()=>{const t={};if(d?(t.loaderId=d.loaderId,t.id=d.id):t.loaderId=k,t.storeId=E,t.loaderName=B||(s==null?void 0:s.label),s.inputs&&(t.loaderConfig={},Object.keys(s.inputs).map(a=>{t.loaderConfig[a]=s.inputs[a]})),r.inputs&&r.name&&Object.keys(r).length>0){t.splitterId=r.name,t.splitterConfig={},Object.keys(r.inputs).map(o=>{t.splitterConfig[o]=r.inputs[o]});const a=y.find(o=>o.name===r.name);a&&(t.splitterName=a.label)}return s.credential&&(t.credential=s.credential),t};return n.useEffect(()=>{Ue(k)?h.request(E):x.request(k)},[]),n.useEffect(()=>{if(x.data){const t=R.cloneDeep(X(x.data,V()));d&&d.loaderConfig&&(t.inputs=d.loaderConfig,O(d.loaderName)),T(t),t.inputAnchors.find(o=>o.name==="textSplitter")&&g.request("Text Splitters")}},[x.data]),n.useEffect(()=>{if(g.data){const t=[];for(const o of g.data)t.push(R.cloneDeep(X(o,V())));ae(t);const a=g.data.map(o=>({label:o.label,name:o.name}));if(a.unshift({label:"None",name:"none"}),se(a),d&&d.splitterConfig&&d.splitterId){const o=t.find(i=>i.name===d.splitterId);o?(o.inputs=R.cloneDeep(d.splitterConfig),j(o)):j({})}}},[g.data]),n.useEffect(()=>{var t;if(h.data){const a=h.data.workspaceId;if(!te(a)){P("/unauthorized");return}if(((t=h.data)==null?void 0:t.loaders.length)>0){const o=h.data.loaders.find(i=>i.id===k);o&&(pe(o),x.request(o.loaderId))}}},[h.data]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{children:F?e.jsx(Le,{error:F}):e.jsxs(Ne,{flexDirection:"column",children:[e.jsx(p,{sx:{flexGrow:1,py:1.25,width:"100%"},children:e.jsxs(Re,{disableGutters:!0,sx:{p:0,display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",flexDirection:"row"},children:[e.jsx(M,{size:"small",color:"secondary","aria-label":"back",title:"Back",onClick:()=>P(-1),children:e.jsx(He,{})}),e.jsx(m,{sx:{ml:2,mr:2},variant:"h3",children:s==null?void 0:s.label}),e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"white",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:s!=null&&s.name?e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:(s==null?void 0:s.name)??"docloader",src:`${_}/api/v1/node-icon/${s==null?void 0:s.name}`}):e.jsx(_e,{color:"black"})})]}),e.jsx(p,{children:e.jsx(Me,{variant:"contained",onClick:je,sx:{borderRadius:2,height:"100%"},startIcon:e.jsx(Je,{}),children:"Process"})})]})}),e.jsx(p,{children:e.jsxs(b,{container:!0,spacing:"2",children:[e.jsx(b,{item:!0,xs:4,md:6,lg:6,sm:4,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",paddingRight:15},children:[e.jsx(p,{sx:{p:2},children:e.jsx(Ke,{fullWidth:!0,sx:{mt:1},size:"small",label:(J=s==null?void 0:s.label)!=null&&J.toLowerCase().includes("loader")?s.label+" name":(s==null?void 0:s.label)+" Loader Name",value:B,onChange:t=>O(t.target.value)})}),s&&Object.keys(s).length>0&&w(s).filter(t=>!t.hidden&&t.display!==!1).map((t,a)=>e.jsx(Q,{inputParam:t,data:s,onNodeDataChange:fe},a)),y&&y.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",flexDirection:"row",p:2,mt:5},children:[e.jsx(m,{sx:{mr:2},variant:"h3",children:((K=($??[]).find(t=>t.name===(r==null?void 0:r.name)))==null?void 0:K.label)??"Select Text Splitter"}),e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",backgroundColor:"white",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 14px 0 rgb(32 40 45 / 25%)"},children:r!=null&&r.name?e.jsx("img",{style:{width:"100%",height:"100%",padding:7,borderRadius:"50%",objectFit:"contain"},alt:(r==null?void 0:r.name)??"textsplitter",src:`${_}/api/v1/node-icon/${r==null?void 0:r.name}`}):e.jsx(Xe,{color:"black"})})]}),e.jsxs(p,{sx:{p:2},children:[e.jsx(m,{children:"Splitter"}),e.jsx(ze,{name:"textSplitter",options:$,onSelect:t=>xe(t),value:(r==null?void 0:r.name)??"none"},JSON.stringify(r))]})]}),Object.keys(r).length>0&&w(r).filter(t=>!t.hidden&&t.display!==!1).map((t,a)=>e.jsx(Q,{data:r,inputParam:t,onNodeDataChange:ue},a))]})}),e.jsxs(b,{item:!0,xs:8,md:6,lg:6,sm:8,children:[!c||c.length===0&&e.jsxs("div",{style:{position:"relative"},children:[e.jsxs(p,{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:Fe,children:[e.jsx(u,{animation:!1,sx:{bgcolor:l.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:l.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:l.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:l.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:l.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160}),e.jsx(u,{animation:!1,sx:{bgcolor:l.isDarkMode?"#23262c":"#fafafa"},variant:"rounded",height:160})]}),e.jsx("div",{style:{position:"absolute",top:0,right:0,width:"100%",height:"100%",backdropFilter:"blur(1px)",background:"transparent",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(M,{color:"secondary","aria-label":"preview",title:"Preview",variant:"extended",onClick:G,children:[e.jsx(Y,{style:{marginRight:"5px"}}),"Preview Chunks"]})})]}),c&&c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{sx:{wordWrap:"break-word",textAlign:"left",mb:2},variant:"h3",children:[ne," of ",ie," Chunks"]}),e.jsxs(p,{sx:{mb:3},children:[e.jsx(m,{children:"Show Chunks in Preview"}),e.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[e.jsx(Te,{size:"small",multiline:!1,sx:{mt:1,flex:1,mr:2},type:"number",onChange:t=>de(t.target.value),value:W??25},"previewChunkCount"),e.jsxs(M,{color:"secondary","aria-label":"preview",title:"Preview",variant:"extended",onClick:G,children:[e.jsx(Y,{style:{marginRight:"5px"}}),"Preview"]})]})]}),e.jsx("div",{style:{height:"800px",overflow:"scroll",padding:"5px"},children:e.jsx(b,{container:!0,spacing:2,children:c==null?void 0:c.map((t,a)=>e.jsx(b,{item:!0,lg:6,md:6,sm:6,xs:6,children:e.jsx(Ve,{content:!1,onClick:()=>ge(t,a+1),sx:{border:1,borderColor:ee.palette.grey[900]+25,borderRadius:2},children:e.jsx(Ae,{children:e.jsxs(Be,{sx:{p:1},children:[e.jsx(m,{sx:{wordWrap:"break-word",mb:1},variant:"h5",children:`#${a+1}. Characters: ${t.pageContent.length}`}),e.jsx(m,{sx:{wordWrap:"break-word"},variant:"body2",children:t.pageContent}),e.jsx(We,{theme:l.isDarkMode?"ocean":"rjv-default",style:{paddingTop:10},src:t.metadata,name:null,quotesOnKeys:!1,enableClipboard:!1,displayDataTypes:!1,collapsed:1})]})})})},a))})})]})]})]})})]})}),e.jsx(Ge,{show:ce,isReadOnly:!0,dialogProps:me,onCancel:()=>q(!1)}),A&&e.jsx(qe,{open:A})]})};export{ra as default};
