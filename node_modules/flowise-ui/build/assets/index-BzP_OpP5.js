import{P,o as oe,b7 as De,p as le,r as a,c as M,R as _,q as ve,H as re,j as e,D as Ie,h as Se,k as Re,B as E,l as A,a1 as ie,m as Oe,n as B,aa as Ae,s as Ne,E as U,J as ce,K as de,t as he,L as Te,N as ne,O as q,a as te,b as me,M as Ve,S as L,e as Be,U as xe,V as ue,W as fe,X as pe,Y as je,av as We,az as Pe,$,a_ as be,ac as D}from"./index-B1XR3Coy.js";import{C as ye,u as Ue}from"./ConfirmDialog-Bksga_et.js";import{V as ze}from"./ViewHeader-jo2V0q71.js";import{E as $e}from"./ErrorBoundary-WOMkE_83.js";import{a as Ce}from"./auth-w0XUAhtD.js";import{I as Le,r as F}from"./role-BJZr6s4d.js";import{I as _e}from"./IconPlus-DpyX5kZB.js";import{S as R}from"./Skeleton-BQAmmov-.js";import{I as ae}from"./IconEye-5BEWSVYC.js";import{I as qe}from"./IconEyeOff-BOYq-4iX.js";import{I as Fe}from"./IconSearch-BzBgax5m.js";import{I as Me}from"./IconTrash-BvhWIQ6v.js";import"./StyledFab-BqTal21_.js";import"./IconCopy-BBl1XuSo.js";const ge=({show:r,dialogProps:i,onCancel:j,onConfirm:v,setError:b})=>{const w=document.getElementById("portal"),y=oe(),{isEnterpriseLicensed:C}=De();le();const m=(...s)=>y(ce(...s)),x=(...s)=>y(de(...s)),[d,u]=a.useState(""),[k,f]=a.useState(""),[h,p]=a.useState({}),[O,H]=a.useState({}),[N,J]=a.useState({}),I=M(Ce.getAllPermissions),W=_(s=>s.auth.user),G=s=>{u(s.target.value)},Y=s=>{f(s.target.value)},K=(s,t)=>{p(l=>{var g;const n={...l[s],[t]:!((g=l[s])!=null&&g[t])};if(s==="templates")t!=="templates:marketplace"&&t!=="templates:custom"&&(n["templates:marketplace"]=!0,n["templates:custom"]=!0);else{const V=`${s}:view`;t!==V?Object.keys(n).some(([Q,ee])=>Q!==V&&ee)&&(n[V]=!0):Object.keys(n).some(([Q,ee])=>Q===V&&ee)&&(n[t]=!0)}return{...l,[s]:n}})},X=(s,t,l)=>{if(t==="templates"){if(l==="templates:marketplace"||l==="templates:custom")return Object.entries(s[t]||{}).some(([n,g])=>n!=="templates:marketplace"&&n!=="templates:custom"&&g)}else{const n=`${t}:view`;if(l===n)return Object.entries(s[t]||{}).some(([g,V])=>g!==n&&V)}return!1},z=s=>{const t=O[s].every(l=>{var n;return(n=h[s])==null?void 0:n[l.key]});p(l=>({...l,[s]:Object.fromEntries(O[s].map(n=>[n.key,!t]))}))};a.useEffect(()=>((i.type==="EDIT"||i.type==="VIEW")&&i.data&&J(i.data),I.request(),()=>{u(""),f(""),p({})}),[i]),a.useEffect(()=>{I.error&&b(I.error)},[I.error]),a.useEffect(()=>(y(r?{type:ve}:{type:re}),()=>y({type:re})),[r,y]),a.useEffect(()=>{if(I.data){u(N.name),f(N.description);const s=I.data;if(C||(Object.keys(s).forEach(t=>{s[t]=s[t].filter(l=>!l.isEnterprise)}),Object.keys(s).forEach(t=>{s[t].length===0&&delete s[t]})),H(s),(i.type==="EDIT"||i.type==="VIEW")&&i.data){const t=JSON.parse(N.permissions);t&&t.length>0&&(Object.keys(s).forEach(l=>{Object.keys(s[l]).forEach(n=>{t.forEach(g=>{g===s[l][n].key&&(h[l]||(h[l]={}),h[l][g]=!0)})})}),p(h))}}},[I.data]);const o=async()=>{try{if(d.indexOf(" ")>-1){m({message:"Role Name cannot contain spaces.",options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:n=>e.jsx(B,{style:{color:"white"},onClick:()=>x(n),children:e.jsx(U,{})})}});return}const s={name:d,description:k,createdBy:W.id,organizationId:W.activeOrganizationId},t=Object.keys(h).map(n=>Object.keys(h[n]).map(g=>{if(h[n][g])return g})).flat();s.permissions=JSON.stringify(t);let l;i.type==="EDIT"?(s.id=i.data.id,s.updatedBy=W.id,l=await F.updateRole(s)):l=await F.createRole(s),l.data&&(m({message:i.type==="EDIT"?"Role Updated Successfully":"New Role Created!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:n=>e.jsx(B,{style:{color:"white"},onClick:()=>x(n),children:e.jsx(U,{})})}}),v(l.data.id))}catch(s){m({message:`Failed : ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:t=>e.jsx(B,{style:{color:"white"},onClick:()=>x(t),children:e.jsx(U,{})})}}),j()}},S=()=>i.type==="VIEW"||!d||d===""||!Object.keys(h).length||!Z(h),Z=s=>{for(const t in s)if(typeof s[t]=="object"&&s[t]!==null){if(Z(s[t]))return!0}else if(s[t]===!0)return!0;return!1},T=r?e.jsxs(Ie,{fullWidth:!0,maxWidth:"md",open:r,onClose:j,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Se,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(Le,{style:{marginRight:"10px"}}),i.type==="EDIT"?"Edit Role":i.type==="VIEW"?"View Role":"Create New Role"]})}),e.jsx(Re,{sx:{backgroundColor:"transparent"},children:e.jsxs("div",{className:"role-editor",children:[e.jsxs(E,{children:[e.jsxs(A,{sx:{mb:1},variant:"h5",children:[e.jsx("span",{style:{color:"red"},children:"*  "}),"Role Name"]}),e.jsx(ie,{id:"roleName",type:"string",size:"small",fullWidth:!0,disabled:i.type==="EDIT"||i.type==="VIEW",placeholder:"Enter role name",value:d,name:"roleName",onChange:G})]}),e.jsxs(E,{children:[e.jsx(A,{sx:{mb:1},variant:"h5",children:"Role Description"}),e.jsx(ie,{id:"roleDesc",type:"string",size:"small",fullWidth:!0,disabled:i.type==="VIEW",placeholder:"Description of the role",value:k,name:"roleDesc",onChange:Y})]}),e.jsxs("div",{className:"permissions-container",children:[e.jsx("p",{children:"Permissions"}),e.jsx("div",{className:"permissions-list-wrapper",children:O&&Object.keys(O).map(s=>e.jsxs("div",{className:"permission-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsx("h3",{children:s.replace(/([A-Z])/g," $1").trim().toUpperCase()}),e.jsx("button",{type:"button",hidden:i.type==="VIEW",onClick:()=>z(s),children:"Select All"})]}),e.jsx("div",{className:"permissions-list",children:O[s].map((t,l)=>{var n;return e.jsx("div",{className:`permission-item ${l%2===0?"left-column":"right-column"}`,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:((n=h[s])==null?void 0:n[t.key])||!1,disabled:i.type==="VIEW"||X(h,s,t.key),onChange:()=>K(s,t.key)}),t.value]})},t.key)})})]},s))})]})]})}),e.jsxs(Oe,{children:[e.jsx(B,{variant:"outlined",onClick:j,children:i.type!=="VIEW"?"Cancel":"Close"}),i.type!=="VIEW"&&e.jsx(Ae,{disabled:S(),variant:"contained",onClick:o,children:i.type!=="EDIT"?"Create Role":"Update Role"})]}),e.jsx(ye,{})]}):null;return Ne.createPortal(T,w)};ge.propTypes={show:P.bool,dialogProps:P.object,onCancel:P.func,onConfirm:P.func,setError:P.func};const He="/assets/roles_empty-C_7bj2dC.svg",c=he(Te)(({theme:r})=>({borderColor:r.palette.grey[900]+25,[`&.${ne.head}`]:{color:r.palette.grey[900]},[`&.${ne.body}`]:{fontSize:14,height:48}})),se=he(q)(()=>({"&:last-child td, &:last-child th":{border:0}}));function ke(r){const i=te(),[j,v]=a.useState({}),[b,w]=a.useState({}),{setError:y}=me(),C=M(Ce.getAllPermissions);return a.useEffect(()=>(r.open&&C.request(),()=>{w({})}),[r.open]),a.useEffect(()=>{C.error&&y(C.error)},[C.error]),a.useEffect(()=>{if(C.data){const m=C.data;v(m);const x=JSON.parse(r.role.permissions);x&&x.length>0&&(Object.keys(m).forEach(d=>{Object.keys(m[d]).forEach(u=>{x.forEach(k=>{k===m[d][u].key&&(b[d]||(b[d]={}),b[d][k]=!0)})})}),w(b))}},[C.data]),e.jsx(be,{anchor:"right",open:r.open,onClose:()=>r.setOpen(!1),sx:{minWidth:320},children:e.jsxs(E,{sx:{p:4,height:"auto",width:650},children:[e.jsx(A,{sx:{textAlign:"left",mb:1},variant:"h2",children:r.role.name}),r.role.description&&e.jsx(A,{sx:{textAlign:"left",mb:4},variant:"body1",children:r.role.description}),e.jsxs(E,{sx:{overflowY:"auto"},children:[e.jsx(A,{sx:{mb:1},variant:"h3",children:"Permissions"}),e.jsx(E,{children:j&&Object.keys(j).map(m=>e.jsxs(E,{sx:{mb:2,border:1,borderColor:i.palette.grey[900]+25,borderRadius:2,padding:2},children:[e.jsx(E,{sx:{mb:2,borderBottom:1,borderColor:i.palette.grey[900]+25},children:e.jsx(A,{sx:{mb:2},variant:"h4",children:m.replace(/([A-Z])/g," $1").trim().toUpperCase()})}),e.jsx(E,{sx:{display:"flex",flexWrap:"wrap",mt:2},children:j[m].map((x,d)=>{var u;return e.jsx("div",{className:`permission-item ${d%2===0?"left-column":"right-column"}`,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:((u=b[m])==null?void 0:u[x.key])||!1,disabled:!0}),x.value]})},x.key)})})]},m))})]})]})})}ke.propTypes={open:D.bool,setOpen:D.func,role:D.any};function Ee(r){const[i,j]=a.useState(!1),[v,b]=a.useState(!1),[w,y]=a.useState(""),[C,m]=a.useState([]),x=te(),d=_(f=>f.customization),u=M(We.getUserByRoleId),k=f=>{j(!0),y(f)};return a.useEffect(()=>{u.data&&m(u.data)},[u.data]),a.useEffect(()=>{open&&w?u.request(w):(j(!1),y(""),m([]))},[i]),e.jsxs(e.Fragment,{children:[e.jsxs(se,{hover:!0,sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(c,{children:r.role.name}),e.jsx(c,{children:r.role.description}),e.jsx(c,{sx:{width:"50%"},children:e.jsxs(L,{sx:{flexDirection:"row"},children:[e.jsx(A,{variant:"subtitle2",color:"textPrimary",sx:{width:"80%",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:"2",WebkitBoxOrient:"vertical"},children:JSON.parse(r.role.permissions).map((f,h)=>e.jsxs(Pe.Fragment,{children:[f,", "]},h))}),e.jsx($,{permissionId:"roles:manage",title:"View",color:"primary",onClick:()=>b(!v),children:e.jsx(ae,{})})]})}),e.jsxs(c,{sx:{textAlign:"center"},children:[r.role.userCount,r.role.userCount>0&&e.jsx($,{permissionId:"roles:manage","aria-label":"expand row",size:"small",color:"inherit",onClick:()=>k(r.role.id),children:r.role.userCount>0&&i?e.jsx(qe,{}):e.jsx(ae,{})})]}),e.jsxs(c,{children:[e.jsx($,{permissionId:"roles:manage",title:"Edit",color:"primary",onClick:()=>r.onEditClick(r.role),children:e.jsx(Fe,{})}),e.jsx($,{permissionId:"roles:manage",disabled:r.role.userCount>0,color:"error",title:r.role.userCount>0?"Remove users with the role from Workspace first":"Delete",onClick:()=>r.onDeleteClick(r.role),children:e.jsx(Me,{})})]})]},r.key),e.jsx(be,{anchor:"right",open:i,onClose:()=>j(!1),sx:{minWidth:320},children:e.jsxs(E,{sx:{p:4,height:"auto",width:650},children:[e.jsx(A,{sx:{textAlign:"left",mb:2},variant:"h2",children:"Assigned Users"}),e.jsx(xe,{style:{display:"flex",flexDirection:"row"},sx:{border:1,borderColor:x.palette.grey[900]+25,borderRadius:2},component:ue,children:e.jsxs(fe,{"aria-label":"assigned users table",children:[e.jsx(pe,{sx:{backgroundColor:d.isDarkMode?x.palette.common.black:x.palette.grey[100],height:56},children:e.jsxs(q,{children:[e.jsx(c,{sx:{width:"50%"},children:"User"}),e.jsx(c,{sx:{width:"50%"},children:"Workspace"})]})}),e.jsx(je,{children:C.map((f,h)=>e.jsxs(q,{children:[e.jsx(c,{children:f.user.name||f.user.email}),e.jsx(c,{children:f.workspace.name})]},h))})]})})]})}),e.jsx(ke,{open:v,setOpen:b,role:r.role})]})}Ee.propTypes={key:D.any,role:D.any,onViewClick:D.func,onEditClick:D.func,onDeleteClick:D.func,open:D.bool,theme:D.any};const os=()=>{const r=te(),i=_(o=>o.customization),j=oe();le();const{error:v,setError:b}=me(),w=(...o)=>j(ce(...o)),y=(...o)=>j(de(...o)),[C,m]=a.useState(!0),[x,d]=a.useState(!1),[u,k]=a.useState({}),{confirm:f}=Ue(),h=_(o=>o.auth.user),p=M(F.getAllRolesByOrganizationId),[O,H]=a.useState([]),[N,J]=a.useState(""),I=o=>{J(o.target.value)};function W(o){return o.name&&o.name.toLowerCase().indexOf(N.toLowerCase())>-1||o.description&&o.description.toLowerCase().indexOf(N.toLowerCase())>-1}const G=()=>{k({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Invite",data:{}}),d(!0)},Y=o=>{const S={type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Invite",data:{...o}};k(S),d(!0)},K=o=>{const S={type:"VIEW",cancelButtonName:"Cancel",confirmButtonName:"Invite",data:{...o}};k(S),d(!0)},X=async o=>{const S={title:"Delete",description:`Delete Role ${o.name}?`,confirmButtonName:"Delete",cancelButtonName:"Cancel"};if(await f(S))try{(await F.deleteRole(o.id,h.activeOrganizationId)).data&&(w({message:"Role deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:s=>e.jsx(B,{style:{color:"white"},onClick:()=>y(s),children:e.jsx(U,{})})}}),z())}catch(T){w({message:`Failed to delete Role: ${typeof T.response.data=="object"?T.response.data.message:T.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:s=>e.jsx(B,{style:{color:"white"},onClick:()=>y(s),children:e.jsx(U,{})})}})}},z=()=>{d(!1),p.request(h.activeOrganizationId)};return a.useEffect(()=>{p.request(h.activeOrganizationId)},[]),a.useEffect(()=>{m(p.loading)},[p.loading]),a.useEffect(()=>{p.error&&b(p.error)},[p.error,b]),a.useEffect(()=>{p.data&&H(p.data)},[p.data]),e.jsxs(e.Fragment,{children:[e.jsx(Ve,{children:v?e.jsx($e,{error:v}):e.jsxs(L,{flexDirection:"column",sx:{gap:3},children:[e.jsx(ze,{onSearchChange:I,search:!0,searchPlaceholder:"Search Roles",title:"Roles",children:e.jsx(Be,{permissionId:"roles:manage",variant:"contained",sx:{borderRadius:2,height:"100%"},onClick:G,startIcon:e.jsx(_e,{}),id:"btn_createUser",children:"Add Role"})}),!C&&O.length===0?e.jsxs(L,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(E,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"20vh",width:"auto"},src:He,alt:"roles_emptySVG"})}),e.jsx("div",{children:"No Roles Yet"})]}):e.jsx(e.Fragment,{children:e.jsx(L,{flexDirection:"row",children:e.jsx(E,{sx:{p:2,height:"auto",width:"100%"},children:e.jsx(xe,{style:{display:"flex",flexDirection:"row"},sx:{border:1,borderColor:r.palette.grey[900]+25,borderRadius:2},component:ue,children:e.jsxs(fe,{sx:{minWidth:650},"aria-label":"users table",children:[e.jsx(pe,{sx:{backgroundColor:i.isDarkMode?r.palette.common.black:r.palette.grey[100],height:56},children:e.jsxs(q,{children:[e.jsx(c,{children:"Name"}),e.jsx(c,{children:"Description"}),e.jsx(c,{children:"Permissions"}),e.jsx(c,{children:"Assigned Users"}),e.jsx(c,{children:" "})]})}),e.jsx(je,{children:C?e.jsxs(e.Fragment,{children:[e.jsxs(se,{children:[e.jsx(c,{children:e.jsx(R,{variant:"text"})}),e.jsx(c,{children:e.jsx(R,{variant:"text"})}),e.jsx(c,{children:e.jsx(R,{variant:"text"})}),e.jsx(c,{children:e.jsx(R,{variant:"text"})}),e.jsx(c,{children:e.jsx(R,{variant:"text"})})]}),e.jsxs(se,{children:[e.jsx(c,{children:e.jsx(R,{variant:"text"})}),e.jsx(c,{children:e.jsx(R,{variant:"text"})}),e.jsx(c,{children:e.jsx(R,{variant:"text"})}),e.jsx(c,{children:e.jsx(R,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:O.filter(W).map((o,S)=>e.jsx(Ee,{role:o,onEditClick:Y,onViewClick:K,onDeleteClick:X},S))})})]})})})})})]})}),x&&e.jsx(ge,{show:x,dialogProps:u,onCancel:()=>d(!1),onConfirm:z,setError:b}),e.jsx(ye,{})]})};export{os as default};
